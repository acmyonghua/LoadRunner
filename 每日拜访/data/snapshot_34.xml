<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="34">
  <HTTPTask id="58" hostname="180.153.154.42" path="/Lib/Javascript/Jit/jit-all-dev.js" url="http://180.153.154.42/Lib/Javascript/Jit/jit-all-dev.js" ip="180.153.154.42" port="80" connectionId="10" origin="Primary" frame="1" startTime="14089589" endTime="14089604">
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Accept" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YXBwbGljYXRpb24vamF2YXNjcmlwdCwgKi8qO3E9MC44</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Referer" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cDovLzE4MC4xNTMuMTU0LjQyL2RlZmF1bHQuYXNweA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>emgtQ04=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKGNvbXBhdGlibGU7IE1TSUUgOS4wOyBXaW5kb3dzIE5UIDYuMTsgV09XNjQ7IFRyaWRlbnQvNS4wKQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Host" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MTgwLjE1My4xNTQuNDI=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>S2VlcC1BbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Q0NDSktMRkFKVUlPUlc9azFNK0w5QlcrZHlBQlROdzF6d0p6UT09OyBDV1JXUUZBSktMVU9JTD0vdERYSmMvWVJ5dGx4N24vR0dnNmdnPT07IEFTUC5ORVRfU2Vzc2lvbklkPWVqMWMwemx6YjQyNHR5ZDVib25hd3ptMA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC9MaWIvSmF2YXNjcmlwdC9KaXQvaml0LWFsbC1kZXYuanMgSFRUUC8xLjENCkFjY2VwdDogYXBwbGljYXRpb24vamF2YXNjcmlwdCwgKi8qO3E9MC44DQpSZWZlcmVyOiBodHRwOi8vMTgwLjE1My4xNTQuNDIvZGVmYXVsdC5hc3B4DQpBY2NlcHQtTGFuZ3VhZ2U6IHpoLUNODQpVc2VyLUFnZW50OiBNb3ppbGxhLzUuMCAoY29tcGF0aWJsZTsgTVNJRSA5LjA7IFdpbmRvd3MgTlQgNi4xOyBXT1c2NDsgVHJpZGVudC81LjApDQpBY2NlcHQtRW5jb2Rpbmc6IGd6aXAsIGRlZmxhdGUNCkhvc3Q6IDE4MC4xNTMuMTU0LjQyDQpDb25uZWN0aW9uOiBLZWVwLUFsaXZlDQpDb29raWU6IENDQ0pLTEZBSlVJT1JXPWsxTStMOUJXK2R5QUJUTncxendKelE9PTsgQ1dSV1FGQUpLTFVPSUw9L3REWEpjL1lSeXRseDduL0dHZzZnZz09OyBBU1AuTkVUX1Nlc3Npb25JZD1lajFjMHpsemI0MjR0eWQ1Ym9uYXd6bTANCg0K</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="CCCJKLFAJUIORW" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>azFNK0w5QlcrZHlBQlROdzF6d0p6UT09</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="CWRWQFAJKLUOIL" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>L3REWEpjL1lSeXRseDduL0dHZzZnZz09</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ASP.NET_SessionId" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZWoxYzB6bHpiNDI0dHlkNWJvbmF3em0w</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Content-Type" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YXBwbGljYXRpb24veC1qYXZhc2NyaXB0</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Encoding" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Last-Modified" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>VGh1LCAyNyBKdW4gMjAxMyAwNzoxNjoyNSBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Ranges" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ynl0ZXM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>IjVlNzVmZDNiNjczY2UxOjAi</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Vary" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWNjZXB0LUVuY29kaW5n</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Server" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TWljcm9zb2Z0LUlJUy83LjU=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-Powered-By" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QVNQLk5FVA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW9uLCAwOCBKdWwgMjAxMyAxMDozMzoyMSBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Length" index="9">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MjM4OTg=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL3gtamF2YXNjcmlwdA0KQ29udGVudC1FbmNvZGluZzogZ3ppcA0KTGFzdC1Nb2RpZmllZDogVGh1LCAyNyBKdW4gMjAxMyAwNzoxNjoyNSBHTVQNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpFVGFnOiAiNWU3NWZkM2I2NzNjZTE6MCINClZhcnk6IEFjY2VwdC1FbmNvZGluZw0KU2VydmVyOiBNaWNyb3NvZnQtSUlTLzcuNQ0KWC1Qb3dlcmVkLUJ5OiBBU1AuTkVUDQpEYXRlOiBNb24sIDA4IEp1bCAyMDEzIDEwOjMzOjIxIEdNVA0KQ29udGVudC1MZW5ndGg6IDIzODk4DQoNCg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>77u/RXh0LmRlZmluZSgnSml0LmFwcC5Db250cm9sbGVyJywgew0KICAgIGV4dGVuZDogJ0V4dC5hcHAuQ29udHJvbGxlcicNCiAgICAsIGNvbmZpZzogew0KICAgICAgICAvKg0KICAgICAgICBAdmlldyAgIOW9k+WJjeeahOinhuWbvg0KICAgICAgICAqLw0KICAgICAgICB2aWV3OiBudWxsDQogICAgICAgIC8qDQogICAgICAgIEBtZW51SUQg5b2T5YmN6aG16Z2i55qE6I+c5Y2VSUQNCiAgICAgICAgKi8NCiAgICAgICAgLG1lbnVJRDpudWxsDQogICAgICAgIC8qDQogICAgICAgIEBhY3Rpb25zIOW9k+WJjXZpZXfmiYDmlK/mjIHnmoTmiYDmnIlhY3Rpb25zDQogICAgICAgICovDQogICAgICAgICwgYWN0aW9uczogbnVsbA0KICAgIH0NCiAgICAsIGNvbnN0cnVjdG9yOiBmdW5jdGlvbiAoY2ZnKSB7DQogICAgICAgIC8v5a6a5LmJ6buY6K6k6YWN572u6aG5DQogICAgICAgIHZhciBkZWZhdWx0Q29uZmlnID0gew0KICAgICAgICAgICAgdmlldzogbnVsbA0KICAgICAgICAgICAgLCBtZW51SUQ6IG51bGwNCiAgICAgICAgICAgICwgYWN0aW9uczogbnVsbA0KICAgICAgICB9Ow0KICAgICAgICAvL+WQiOW5tumFjee9rumhuQ0KICAgICAgICBFeHQuYXBwbHlJZihjZmcsIGRlZmF1bHRDb25maWcpOw0KICAgICAgICAvL+WIneWni+WMlumFjee9rumhuQ0KICAgICAgICB0aGlzLmluaXRDb25maWcoY2ZnKTsNCiAgICAgICAgLy/osIPnlKjniLbnsbvov5vooYzliJ3lp4vljJYNCiAgICAgICAgdGhpcy5jYWxsUGFyZW50KGFyZ3VtZW50cyk7DQogICAgfQ0KICAgICwgaW5pdDogZnVuY3Rpb24gKGFwcGxpY2F0aW9uKSB7DQogICAgICAgIC8v5bCGYXBwbGljYXRpb27nmoTlj4LmlbDmi7fotJ3liLBjb250cm9sbGVy5LitDQogICAgICAgIEV4dC5hcHBseUlmKHRoaXMsIGFwcGxpY2F0aW9uLnBhcmFtcyB8fCB7fSk7DQogICAgICAgIC8v5qOA5p+l5piv5ZCm6YWN572u5LqG5Y+C5pWwDQogICAgICAgIGlmICh0aGlzLmFqYXhIYW5kbGVyUGF0aCA9PSBudWxsKSB7DQogICAgICAgICAgICBFeHQuRXJyb3IucmFpc2UoIuWcqGFwcGxpY2F0aW9u5Lit5b+F6aG76YWN572uYWpheEhhbmRsZXJQYXRoLiIpOw0KICAgICAgICB9DQogICAgICAgIGlmICh0aGlzLm1lbnVJRCA9PSBudWxsKSB7DQogICAgICAgICAgICBFeHQuRXJyb3IucmFpc2UoIuWcqGFwcGxpY2F0aW9u5Lit5b+F6aG76YWN572ubWVudUlELiIpOw0KICAgICAgICB9DQogICAgfQ0KICAgIC8qDQogICAg5bel5YW35pa55rOVIC0g5qC55o2u6ZSu6I635Y+W5aSa6K+t6KiA6LWE5rqQDQogICAgQGtleSAgICDlpJror63oqIDotYTmupDpobnnmoTplK4NCiAgICDov5Tlm57lpJror63oqIDotYTmupDpobnnmoTlgLwNCiAgICAqLw0KICAgICwgZ2V0UmVzb3VyY2U6IGZ1bmN0aW9uIChrZXkpIHsNCiAgICAgICAgaWYgKGtleSAhPSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sYW5ndWFnZVJlc291cmNlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmxhbmd1YWdlUmVzb3VyY2VzW2ldLmtleSA9PSBrZXkpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFuZ3VhZ2VSZXNvdXJjZXNbaV0udmFsdWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuICdFUlJPUic7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoNCiAgICDlt6Xlhbfmlrnms5UgLSDmoLnmja7plK7ojrflj5blpJror63oqIDotYTmupANCiAgICBAdmlldyAgIOinhuWbvg0KICAgIEBhY3Rpb24g5pON5L2cDQogICAg6L+U5ZueYWpheOivt+axgueahHVybA0KICAgICovDQogICAgLCBnZXRBamF4VXJsOiBmdW5jdGlvbiAodmlldywgYWN0aW9uKSB7DQogICAgICAgIC8v5aSE55CGdmlldyZhY3Rpb24NCiAgICAgICAgdmFyIGN1cnJlbnQgPSB7DQogICAgICAgICAgICB2aWV3OiB2aWV3DQogICAgICAgICAgICAsIGFjdGlvbjogYWN0aW9uDQogICAgICAgIH07DQogICAgICAgIGN1cnJlbnQgPSBFeHQuYXBwbHlJZihjdXJyZW50LCB7DQogICAgICAgICAgICB2aWV3OiB0aGlzLnZpZXcNCiAgICAgICAgICAgICwgYWN0aW9uOiB0aGlzLmFjdGlvbg0KICAgICAgICB9KTsNCiAgICAgICAgLy/mi7zmjqXmn6Xor6LlrZfnrKbkuLINCiAgICAgICAgdmFyIHVybCA9IHRoaXMuYWpheEhhbmRsZXJQYXRoICsgJz8nOw0KICAgICAgICB1cmwgKz0gJyZtZW51PScgKyAodGhpcy5tZW51ID09IG51bGwgPyAnJyA6IHRoaXMubWVudSk7DQogICAgICAgIHVybCArPSAnJnZpZXc9JyArIChjdXJyZW50LnZpZXcgPT0gbnVsbCA/ICcnIDogY3VycmVudC52aWV3LnRvU3RyaW5nKCkpOw0KICAgICAgICB1cmwgKz0gJyZhY3Rpb249JyArIChjdXJyZW50LmFjdGlvbiA9PSBudWxsID8gJycgOiBjdXJyZW50LmFjdGlvbi50b1N0cmluZygpKTsNCiAgICAgICAgLy8NCiAgICAgICAgcmV0dXJuIHVybDsNCiAgICB9DQp9KTsNCkV4dC5kZWZpbmUoJ0ppdC5idXR0b24uQnV0dG9uJywgew0KICAgIGV4dGVuZDogJ0V4dC5idXR0b24uQnV0dG9uJw0KICAgICwgYWxpYXM6ICd3aWRnZXQuaml0YnV0dG9uJw0KICAgICwgY29uZmlnOiB7DQogICAgICAgIC8qDQogICAgICAgIEBzaXplICAg5bC65a+45YiG5Li6c21hbGwsYmln5Lik56eNDQogICAgICAgICovDQogICAgICAgIGppdFNpemU6ICdzbWFsbCcNCiAgICAgICAgLyoNCiAgICAgICAgQGlzSGlnaGxpZ2h0ICAgIOaYr+WQpuS4uumrmOS6rg0KICAgICAgICAqLw0KICAgICAgICAsIGppdElzSGlnaGxpZ2h0OiBmYWxzZQ0KICAgICAgICAsIGppdElzRGVmYXVsdENTUzogZmFsc2UNCiAgICB9DQogICAgLCBjb25zdHJ1Y3RvcjogZnVuY3Rpb24gKGNmZykgew0KICAgICAgICAvL+WumuS5iem7mOiupOmFjee9rg0KICAgICAgICB2YXIgZGVmYXVsdENvbmZpZyA9IHsNCiAgICAgICAgICAgIGhlaWdodDogMjUsDQogICAgICAgICAgICBtYXJnaW46ICcwIDAgMCAxMCcNCiAgICAgICAgfTsNCiAgICAgICAgLy/oh6rlt7HnmoTphY3nva7pobnlpITnkIYNCiAgICAgICAgdmFyIGNmZyA9IEV4dC5hcHBseUlmKGNmZywgew0KICAgICAgICAgICAgaml0U2l6ZTogJ3NtYWxsJw0KICAgICAgICAgICAgLCBqaXRJc0hpZ2hsaWdodDogZmFsc2UNCiAgICAgICAgICAgICwgaml0SXNEZWZhdWx0Q1NTOiBmYWxzZQ0KICAgICAgICB9KTsNCg0KICAgICAgICBpZiAoY2ZnLmppdElzRGVmYXVsdENTUyAhPSBudWxsICYmIGNmZy5qaXRJc0RlZmF1bHRDU1MpIHsNCiAgICAgICAgICAgIGlmIChjZmcudGV4dCAhPSBudWxsICYmIGNmZy50ZXh0ICE9ICIiKSB7DQogICAgICAgICAgICAgICAgY2ZnLmJ1dHRvblRleHQgPSBjZmcudGV4dC50b1N0cmluZygpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2ZnLnBhZGRpbmcgPSAnMCAwIDAgMCc7DQogICAgICAgICAgICBpZiAoY2ZnLmRpc2FibGVkICE9IG51bGwgJiYgY2ZnLmRpc2FibGVkKSB7DQogICAgICAgICAgICAgICAgaWYgKGNmZy5qaXRTaXplLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSA9PSAiYmlnIikNCiAgICAgICAgICAgICAgICAgICAgY2ZnLmNscyA9ICdidXR0b25kaXNhYmxlZF9iaWcnOw0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgY2ZnLmNscyA9ICdidXR0b25kaXNhYmxlZCc7DQogICAgICAgICAgICAgICAgY2ZnLnRleHQgPSAnPGZvbnQgc3R5bGU9ImNvbG9yOiMwMDAwMDA7Zm9udC13ZWlnaHQ6Ym9sZCI+JyArIGNmZy5idXR0b25UZXh0ICsgJzwvZm9udD4nOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBpZiAoY2ZnLmppdElzSGlnaGxpZ2h0KSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChjZmcuaml0U2l6ZS50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkgPT0gImJpZyIpDQogICAgICAgICAgICAgICAgICAgICAgICBjZmcuY2xzID0gJ2J1dHRvbmhpZ2hsaWdodF9iaWcnOw0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICBjZmcuY2xzID0gJ2J1dHRvbmhpZ2hsaWdodCc7DQogICAgICAgICAgICAgICAgICAgIGNmZy50ZXh0ID0gJzxmb250IHN0eWxlPSJjb2xvcjojZmZmZmZmO2ZvbnQtd2VpZ2h0OmJvbGQiPicgKyBjZmcuYnV0dG9uVGV4dCArICc8L2ZvbnQ+JzsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBpZiAoY2ZnLmppdFNpemUudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpID09ICJiaWciKQ0KICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLmNscyA9ICdidXR0b25jdXJyZW50X2JpZyc7DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5jbHMgPSAnYnV0dG9uY3VycmVudCc7IA0KICAgICAgICAgICAgICAgICAgICBjZmcudGV4dCA9ICc8Zm9udCBzdHlsZT0iY29sb3I6IzQ4NDk0Nztmb250LXdlaWdodDpib2xkIj4nICsgY2ZnLmJ1dHRvblRleHQgKyAnPC9mb250Pic7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSANCiAgICAgICAgICAgIGlmIChjZmcuaml0U2l6ZS50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkgPT0gImJpZyIpDQogICAgICAgICAgICAgICAgY2ZnLmRpc2FibGVkQ2xzID0gJ2J1dHRvbmRpc2FibGVkX2JpZyc7DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgY2ZnLmRpc2FibGVkQ2xzID0gJ2J1dHRvbmRpc2FibGVkJzsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoY2ZnLmppdFNpemUpIHsNCiAgICAgICAgICAgIHZhciBzaXplID0gY2ZnLmppdFNpemUudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpOw0KICAgICAgICAgICAgc3dpdGNoIChzaXplKSB7DQogICAgICAgICAgICAgICAgY2FzZSAnc21hbGwnOg0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0Q29uZmlnLndpZHRoID0gODA7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSAnYmlnJzoNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdENvbmZpZy53aWR0aCA9IDEwMDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBjZmcuc2V0RGlzYWJsZWQgPSBmdW5jdGlvbiAoZGlzYWJsZWQpIHsNCiAgICAgICAgICAgIGlmIChjZmcuaml0SXNEZWZhdWx0Q1NTICE9IG51bGwgJiYgY2ZnLmppdElzRGVmYXVsdENTUykgew0KICAgICAgICAgICAgICAgIGlmIChkaXNhYmxlZCkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFRleHQoJzxmb250IHN0eWxlPSJjb2xvcjojMDAwMDAwO2ZvbnQtd2VpZ2h0OmJvbGQiPicgKyBjZmcuYnV0dG9uVGV4dCArICc8L2ZvbnQ+Jyk7DQogICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2xzKGNmZy5jbHMpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChjZmcuaml0SXNIaWdobGlnaHQgIT0gbnVsbCAmJiBjZmcuaml0SXNIaWdobGlnaHQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjZmcuaml0U2l6ZS50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkgPT0gImJpZyIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLmNscyA9ICdidXR0b25oaWdobGlnaHRfYmlnJzsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZmcuY2xzID0gJ2J1dHRvbmhpZ2hsaWdodCc7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFRleHQoJzxmb250IHN0eWxlPSJjb2xvcjojZmZmZmZmO2ZvbnQtd2VpZ2h0OmJvbGQiPicgKyBjZmcuYnV0dG9uVGV4dCArICc8L2ZvbnQ+Jyk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2ZnLmppdFNpemUudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpID09ICJiaWciKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5jbHMgPSAnYnV0dG9uY3VycmVudF9iaWcnOw0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5jbHMgPSAnYnV0dG9uY3VycmVudCc7IA0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRUZXh0KCc8Zm9udCBzdHlsZT0iY29sb3I6IzQ4NDk0Nztmb250LXdlaWdodDpib2xkIj4nICsgY2ZnLmJ1dHRvblRleHQgKyAnPC9mb250PicpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkQ2xzKGNmZy5jbHMpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiB0aGlzW2Rpc2FibGVkID8gJ2Rpc2FibGUnIDogJ2VuYWJsZSddKCk7DQogICAgICAgIH0NCiAgICAgICAgLy/lkIjlubbphY3nva7pobkNCiAgICAgICAgY2ZnID0gRXh0LmFwcGx5SWYoY2ZnLCBkZWZhdWx0Q29uZmlnKTsNCiAgICAgICAgLy/liJ3lp4vljJbphY3nva7pobkNCiAgICAgICAgdGhpcy5pbml0Q29uZmlnKGNmZyk7DQogICAgICAgIC8v6LCD55So54i257G76L+b6KGM5Yid5aeL5YyWDQogICAgICAgIHRoaXMuY2FsbFBhcmVudChhcmd1bWVudHMpOw0KICAgIH0NCn0pOw0KDQpFeHQuZGVmaW5lKCdKaXQuYnV0dG9uLkNvbGxhcHNlQnV0dG9uJywgew0KICAgIGV4dGVuZDogJ0V4dC5idXR0b24uQnV0dG9uJw0KICAgICwgYWxpYXM6ICd3aWRnZXQuSml0Q29sbGFwc2VCdXR0b24nDQogICAgLCBjb25maWc6IHsNCiAgICAgICAgLy/pu5jorqTmmK/lkKbkuLrlsZXlvIDnirbmgIENCiAgICAgICAgZXhwYW5kZWQ6IGZhbHNlDQogICAgICAgICwgaGFuZGxlcjogbnVsbA0KICAgICAgICAvKg0KICAgICAgICBAc2l6ZSAgIOWwuuWvuOWIhuS4unNtYWxsLGJpZ+S4pOenjQ0KICAgICAgICAqLw0KICAgICAgICAgLCBqaXRTaXplOiAnc21hbGwnDQogICAgfQ0KICAgICAgICAsIGNvbnN0cnVjdG9yOiBmdW5jdGlvbiAoY2ZnKSB7DQoNCiAgICAgICAgICAgIHZhciBtZSA9IHRoaXM7DQogICAgICAgICAgICAvL+WumuS5iem7mOiupOmFjee9rg0KICAgICAgICAgICAgdmFyIGRlZmF1bHRDb25maWcgPSB7DQogICAgICAgICAgICAgICAgaGVpZ2h0OiAyNSwNCiAgICAgICAgICAgICAgICBtYXJnaW46ICcwIDAgMCAxMCcNCiAgICAgICAgICAgICAgICAsIGJvcmRlcjogMA0KICAgICAgICAgICAgICAgICAsIGppdFNpemU6ICdzbWFsbCcNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICAvL+iHquW3seeahOmFjee9rumhueWkhOeQhg0KICAgICAgICAgICAgLy8gICAgICAgICAgICB2YXIgY2ZnID0gRXh0LmFwcGx5SWYoY2ZnLCB7IH0pOw0KICAgICAgICAgICAgLy/lkIjlubbphY3nva7pobkNCiAgICAgICAgICAgIGNmZyA9IEV4dC5hcHBseUlmKGNmZywgZGVmYXVsdENvbmZpZyk7DQogICAgICAgICAgICBpZiAoY2ZnLmppdFNpemUpIHsNCiAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IGNmZy5qaXRTaXplLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKTsNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKHNpemUpIHsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAnc21hbGwnOg0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNmZy53aWR0aCA9IDgwOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JpZyc6DQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2ZnLndpZHRoID0gMTAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLy/liJ3lp4vljJbphY3nva7pobkNCiAgICAgICAgICAgIHRoaXMuaW5pdENvbmZpZyhjZmcpOw0KICAgICAgICAgICAgLy/osIPnlKjniLbnsbvov5vooYzliJ3lp4vljJYNCiAgICAgICAgICAgIHRoaXMuY2FsbFBhcmVudChhcmd1bWVudHMpOw0KDQogICAgICAgICAgICBtZS5hZGRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgaWYgKGNmZy5yZWFkT25seSA9PSBmYWxzZSB8fCBjZmcucmVhZE9ubHkgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICAvL+WIh+aNouaMiemSruWkluingg0KICAgICAgICAgICAgICAgICAgICB0aGlzLmZuU3dpdGNoQ29sbGFwc2UoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIC8v5ZGI546w6buY6K6k54q25oCBDQogICAgICAgICAgICB0aGlzLmV4cGFuZGVkID0gIXRoaXMuZXhwYW5kZWQ7DQogICAgICAgICAgICB0aGlzLmZuU3dpdGNoQ29sbGFwc2UoKTsNCiAgICAgICAgfSwNCiAgICBmblN3aXRjaENvbGxhcHNlOiBmdW5jdGlvbiAoKSB7DQogICAgICAgIGlmICh0aGlzLmV4cGFuZGVkKSB7DQogICAgICAgICAgICB0aGlzLnNldFRleHQoIiZuYnNwOyZuYnNwOyZuYnNwOyZuYnNwO+WxlSZuYnNwOyZuYnNwO+W8gCIpOw0KICAgICAgICAgICAgdGhpcy5yZW1vdmVDbHMoImFycm93dXAiKTsNCiAgICAgICAgICAgIHRoaXMuYWRkQ2xzKCJhcnJvd2Rvd24iKTsNCiAgICAgICAgICAgIHRoaXMuc2hvdyA9IGZhbHNlOw0KICAgICAgICAgICAgdGhpcy5leHBhbmRlZCA9IGZhbHNlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdGhpcy5zZXRUZXh0KCImbmJzcDsmbmJzcDsmbmJzcDsmbmJzcDvmlLYmbmJzcDsmbmJzcDvotbciKTsNCiAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2xzKCJhcnJvd2Rvd24iKTsNCiAgICAgICAgICAgIHRoaXMuYWRkQ2xzKCJhcnJvd3VwIik7DQogICAgICAgICAgICB0aGlzLnNob3cgPSB0cnVlOw0KICAgICAgICAgICAgdGhpcy5leHBhbmRlZCA9IHRydWU7DQogICAgICAgIH0NCiAgICB9DQp9KTsNCi8qDQrlhoXlrZjliIbpobXnmoRTdG9yZQ0KKi8NCkV4dC5kZWZpbmUoJ0ppdC5kYXRhLlBhZ2luZ01lbW9yeVN0b3JlJywgew0KICAgIGV4dGVuZDogJ0V4dC5kYXRhLlN0b3JlJw0KICAgICwgYWxpYXM6ICd3aWRnZXQuaml0UGFnaW5nTWVtb3J5U3RvcmUnDQogICAgLyoNCiAgICDmnoTpgKDlh73mlbANCiAgICAqLw0KICAgICwgY29uc3RydWN0b3I6IGZ1bmN0aW9uIChjb25maWcpIHsNCiAgICAgICAgY29uZmlnID0gY29uZmlnIHx8IHt9Ow0KICAgICAgICB0aGlzLmNhbGxQYXJlbnQoW2NvbmZpZ10pOw0KICAgIH0NCiAgICAvKg0KICAgIOimhuWGmWZpbHRlckJ55pa55rOV77yM5Lul5a6e546w5LuO5YyF5ZCr5omA5pyJ5pWw5o2u55qE5pWw5o2u6ZuG5Lit6I635Y+W5b2T6aG15pWw5o2uDQogICAgKi8NCiAgICAsIGZpbHRlckJ5OiBmdW5jdGlvbiAoZm4sIHNjb3BlKSB7DQogICAgICAgIHZhciBtZSA9IHRoaXM7DQogICAgICAgIC8v5LuOcHJveHnkuK3ojrflj5bmiYDmnInnmoTmlbDmja7ov5vooYznrZvpgIkNCiAgICAgICAgdmFyIGFsbERhdGFzID0gRXh0LmNyZWF0ZSgnRXh0LnV0aWwuTWl4ZWRDb2xsZWN0aW9uJywgZmFsc2UsIGZ1bmN0aW9uIChyZWNvcmQpIHsgcmV0dXJuIHJlY29yZC5pbnRlcm5hbElkOyB9KTsNCiAgICAgICAgYWxsRGF0YXMuYWRkQWxsKG1lLnByb3h5LmdldFJlYWRlcigpLnJlYWRSZWNvcmRzKG1lLnByb3h5LmRhdGEpLnJlY29yZHMpOw0KICAgICAgICB2YXIgZmlsdGVyZWREYXRhcyA9IGFsbERhdGFzLmZpbHRlckJ5KGZuLCBzY29wZSB8fCBtZSk7DQogICAgICAgIGZpbHRlcmVkRGF0YXMuc29ydChtZS5zb3J0ZXJzLml0ZW1zKTsNCiAgICAgICAgLy/ojrflj5blvZPpobXmlbDmja4NCiAgICAgICAgdmFyIHBhZ2VTaXplID0gbWUucGFnZVNpemU7DQogICAgICAgIHZhciB0b3RhbFJvd0NvdW50ID0gZmlsdGVyZWREYXRhcy5sZW5ndGggfHwgMDsNCiAgICAgICAgdmFyIHRvdGFsUGFnZUNvdW50ID0gTWF0aC5jZWlsKHRvdGFsUm93Q291bnQgLyBwYWdlU2l6ZSk7DQoNCiAgICAgICAgaWYgKG1lLmN1cnJlbnRQYWdlID4gdG90YWxQYWdlQ291bnQgJiYgbWUuY3VycmVudFBhZ2UgIT0gMSkgew0KICAgICAgICAgICAgbWUuY3VycmVudFBhZ2UgPSB0b3RhbFBhZ2VDb3VudA0KICAgICAgICB9DQogICAgICAgIHZhciBjdXJyZW50UGFnZUluZGV4ID0gbWUuY3VycmVudFBhZ2UgLSAxOw0KDQogICAgICAgIHZhciBzdGFydCA9IGN1cnJlbnRQYWdlSW5kZXggKiBwYWdlU2l6ZTsNCiAgICAgICAgdmFyIGxpbWl0ID0gKGN1cnJlbnRQYWdlSW5kZXggKyAxKSAqIHBhZ2VTaXplOw0KICAgICAgICB2YXIgcGFnZWREYXRhID0gbmV3IEFycmF5KCk7DQogICAgICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IGZpbHRlcmVkRGF0YXMubGVuZ3RoICYmIGkgPCBsaW1pdDsgaSsrKSB7DQogICAgICAgICAgICBwYWdlZERhdGEucHVzaChmaWx0ZXJlZERhdGFzLml0ZW1zW2ldKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBkYXRhID0gRXh0LmNyZWF0ZSgnRXh0LnV0aWwuTWl4ZWRDb2xsZWN0aW9uJywgZmFsc2UsIGZ1bmN0aW9uIChyZWNvcmQpIHsgcmV0dXJuIHJlY29yZC5pbnRlcm5hbElkOyB9KTsNCiAgICAgICAgZGF0YS5hZGRBbGwocGFnZWREYXRhKTsNCiAgICAgICAgbWUuc25hcHNob3QgPSBtZS5zbmFwc2hvdCB8fCBkYXRhOw0KICAgICAgICBtZS5kYXRhID0gZGF0YTsNCg0KICAgICAgICAvL+mHjeaWsOiuvue9rnN0b3Jl55qE5LiA5Lqb5bGe5oCn5Lul5L6/5LqO5YiG6aG15o6n5Lu26YeN5paw6K6h566XDQogICAgICAgIG1lLnRvdGFsQ291bnQgPSB0b3RhbFJvd0NvdW50Ow0KICAgICAgICBtZS5maXJlRXZlbnQoJ2RhdGFjaGFuZ2VkJywgbWUpOw0KICAgIH0NCn0pOw0KRXh0LmRlZmluZSgnSml0LmZvcm0uZmllbGQuQ2hlY2tib3gnLCB7DQogICAgZXh0ZW5kOiAnRXh0LmZvcm0uZmllbGQuQ2hlY2tib3gnDQogICAgLCBhbGlhczogJ3dpZGdldC5qaXRjaGVja2JveCcNCiAgICAsIGNvbnN0cnVjdG9yOiBmdW5jdGlvbiAoY2ZnKSB7DQogICAgICAgIC8v5a6a5LmJ6buY6K6k6YWN572uDQogICAgICAgIHZhciBkZWZhdWx0Q29uZmlnID0gew0KICAgICAgICAgICAgbGFiZWxTZXBhcmF0b3I6ICcnDQogICAgICAgICAgICAsIGxhYmVsUGFkOiAxMA0KICAgICAgICAgICAgLCBsYWJlbEFsaWduOiAncmlnaHQnDQogICAgICAgICAgICAsIG1hcmdpbjogJzAgMTAgMTAgMTAnDQogICAgICAgICAgICAsIHdpZHRoOiAxODMNCiAgICAgICAgICAgICwgbGFiZWxXaWR0aDogNzMNCiAgICAgICAgICAgICwgaGVpZ2h0OiAyMg0KICAgICAgICB9DQoNCiAgICAgICAgLy/lkIjlubbphY3nva7pobkNCiAgICAgICAgY2ZnID0gRXh0LmFwcGx5SWYoY2ZnLCBkZWZhdWx0Q29uZmlnKTsNCiAgICAgICAgLy/liJ3lp4vljJbphY3nva7pobkNCiAgICAgICAgdGhpcy5pbml0Q29uZmlnKGNmZyk7DQogICAgICAgIC8v6LCD55So54i257G76L+b6KGM5Yid5aeL5YyWDQogICAgICAgIHRoaXMuY2FsbFBhcmVudChhcmd1bWVudHMpOw0KICAgIH0sDQogICAgaml0R2V0VmFsdWU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWUoKTsNCiAgICB9LA0KICAgIGppdFNldFZhbHVlOiBmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZSk7DQogICAgfQ0KfSk7DQpFeHQuZGVmaW5lKCdKaXQuZm9ybS5maWVsZC5Db21ib0JveCcsIHsNCiAgICBleHRlbmQ6ICdFeHQuZm9ybS5Db21ib0JveCcsDQogICAgYWxpYXM6ICd3aWRnZXQuaml0Y29tYm9ib3gnLA0KICAgIGFsbFNlbGVjdG9yOiBmYWxzZSwNCiAgICBqaXRBbGxUZXh0OiAnQWxsJywNCiAgICAvKuaehOmAoOWHveaVsCovDQogICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uIChjZmcpIHsNCiAgICAgICAgLy/lrprkuYnpu5jorqTphY3nva4NCiAgICAgICAgdmFyIGRlZmF1bHRDb25maWcgPSB7DQogICAgICAgICAgICBtdWx0aVNlbGVjdDogZmFsc2UNCiAgICAgICAgICAgICwgbGFiZWxTZXBhcmF0b3I6ICcnDQogICAgICAgICAgICAsIGxhYmVsUGFkOiAxMA0KICAgICAgICAgICAgLCBsYWJlbEFsaWduOiAncmlnaHQnDQogICAgICAgICAgICAsIHF1ZXJ5TW9kZTogJ2xvY2FsJw0KICAgICAgICAgICAgLCBtYXJnaW46ICcwIDEwIDEwIDEwJw0KICAgICAgICAgICAgLCBlZGl0YWJsZTogZmFsc2UNCiAgICAgICAgICAgICwgd2lkdGg6IDE4Mw0KICAgICAgICAgICAgLCBsYWJlbFdpZHRoOiA3Mw0KICAgICAgICAgICAgLCBoZWlnaHQ6IDIyDQogICAgICAgICAgICAsIG1hdGNoRmllbGRXaWR0aDogZmFsc2UNCiAgICAgICAgICAgICwgbGlzdENvbmZpZzogew0KICAgICAgICAgICAgICAgIG1pbldpZHRoOiAxMDANCiAgICAgICAgICAgICAgICAsIG1heFdpZHRoOiAzMDANCiAgICAgICAgICAgICAgICAsIGNsczogJ0NvbWJvQm94Jw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCg0KICAgICAgICAvL+WQiOW5tumFjee9rumhuQ0KICAgICAgICBjZmcgPSBFeHQuYXBwbHlJZihjZmcsIGRlZmF1bHRDb25maWcpOw0KICAgICAgICBpZiAoY2ZnLndpZHRoICE9IG51bGwgJiYgY2ZnLndpZHRoICE9ICIiKSB7DQogICAgICAgICAgICBjZmcubGlzdENvbmZpZyA9IHsNCiAgICAgICAgICAgICAgICBtaW5XaWR0aDogY2ZnLndpZHRoIC0gKGNmZy5sYWJlbFdpZHRoICsgY2ZnLmxhYmVsUGFkKQ0KICAgICAgICAgICAgICAgICwgbWF4V2lkdGg6IDMwMA0KICAgICAgICAgICAgICAgICwgY2xzOiAnQ29tYm9Cb3gnDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgLy/liKTmlq3mmK/lkKblj6/ku6VDaGVja0JveOWkmumAiQ0KICAgICAgICBpZiAoY2ZnLm11bHRpU2VsZWN0KSB7DQogICAgICAgICAgICBjZmcuYWRkQWxsU2VsZWN0b3IgPSB0cnVlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgY2ZnLmFkZEFsbFNlbGVjdG9yID0gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgLy/liJ3lp4vljJbphY3nva7pobkNCiAgICAgICAgdGhpcy5pbml0Q29uZmlnKGNmZyk7DQogICAgICAgIC8v6LCD55So54i257G76L+b6KGM5Yid5aeL5YyWDQogICAgICAgIHRoaXMuY2FsbFBhcmVudChhcmd1bWVudHMpOw0KICAgIH0sDQogICAgaml0R2V0VmFsdWU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWUoKTsNCiAgICB9LA0KICAgIGppdFNldFZhbHVlOiBmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZSk7DQogICAgfSwNCiAgICBjcmVhdGVQaWNrZXI6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIG1lID0gdGhpcywNCiAgICAgICAgICAgcGlja2VyLA0KICAgICAgICAgICBtZW51Q2xzID0gRXh0LmJhc2VDU1NQcmVmaXggKyAnbWVudScsDQogICAgICAgICAgIG9wdHMgPSBFeHQuYXBwbHkoew0KICAgICAgICAgICAgICAgcGlja2VyRmllbGQ6IG1lLA0KICAgICAgICAgICAgICAgc2VsTW9kZWw6IHsNCiAgICAgICAgICAgICAgICAgICBtb2RlOiBtZS5tdWx0aVNlbGVjdCA/ICdTSU1QTEUnIDogJ1NJTkdMRScNCiAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICBmbG9hdGluZzogdHJ1ZSwNCiAgICAgICAgICAgICAgIGhpZGRlbjogdHJ1ZSwNCiAgICAgICAgICAgICAgIG93bmVyQ3Q6IG1lLm93bmVyQ3QsDQogICAgICAgICAgICAgICBjbHM6IG1lLmVsLnVwKCcuJyArIG1lbnVDbHMpID8gbWVudUNscyA6ICcnLA0KICAgICAgICAgICAgICAgc3RvcmU6IG1lLnN0b3JlLA0KICAgICAgICAgICAgICAgZGlzcGxheUZpZWxkOiBtZS5kaXNwbGF5RmllbGQsDQogICAgICAgICAgICAgICBmb2N1c09uVG9Gcm9udDogZmFsc2UsDQogICAgICAgICAgICAgICBwYWdlU2l6ZTogbWUucGFnZVNpemUsDQogICAgICAgICAgICAgICB0cGw6IG1lLm11bHRpU2VsZWN0ID8NCiAgICAgICAgICAgIFsNCiAgICAgICAgICAgICAgICAnPHVsPjx0cGwgZm9yPSIuIj4nLA0KICAgICAgICAgICAgICAgICAgICAnPGxpIHJvbGU9Im9wdGlvbiIgY2xhc3M9IicgKyBFeHQuYmFzZUNTU1ByZWZpeCArICdib3VuZGxpc3QtaXRlbSI+PHNwYW4gY2xhc3M9IngtY29tYm8tY2hlY2tlciI+Jm5ic3A7PC9zcGFuPiB7JyArIG1lLmRpc3BsYXlGaWVsZCArICd9PC9saT4nLA0KICAgICAgICAgICAgICAgICc8L3RwbD48L3VsPicNCiAgICAgICAgICAgIF0gOiAnJw0KICAgICAgICAgICB9LCBtZS5saXN0Q29uZmlnLCBtZS5kZWZhdWx0TGlzdENvbmZpZyk7DQoNCiAgICAgICAgcGlja2VyID0gbWUucGlja2VyID0gRXh0LmNyZWF0ZSgnRXh0LnZpZXcuQm91bmRMaXN0Jywgb3B0cyk7DQogICAgICAgIGlmIChtZS5wYWdlU2l6ZSkgew0KICAgICAgICAgICAgcGlja2VyLnBhZ2luZ1Rvb2xiYXIub24oJ2JlZm9yZWNoYW5nZScsIG1lLm9uUGFnZUNoYW5nZSwgbWUpOw0KICAgICAgICB9DQoNCiAgICAgICAgbWUubW9uKHBpY2tlciwgew0KICAgICAgICAgICAgaXRlbWNsaWNrOiBtZS5vbkl0ZW1DbGljaywNCiAgICAgICAgICAgIHJlZnJlc2g6IG1lLm9uTGlzdFJlZnJlc2gsDQogICAgICAgICAgICBzY29wZTogbWUNCiAgICAgICAgfSk7DQoNCiAgICAgICAgbWUubW9uKHBpY2tlci5nZXRTZWxlY3Rpb25Nb2RlbCgpLCB7DQogICAgICAgICAgICAnYmVmb3Jlc2VsZWN0JzogbWUub25CZWZvcmVTZWxlY3QsDQogICAgICAgICAgICAnYmVmb3JlZGVzZWxlY3QnOiBtZS5vbkJlZm9yZURlc2VsZWN0LA0KICAgICAgICAgICAgJ3NlbGVjdGlvbmNoYW5nZSc6IG1lLm9uTGlzdFNlbGVjdGlvbkNoYW5nZSwNCiAgICAgICAgICAgIHNjb3BlOiBtZQ0KICAgICAgICB9KTsNCg0KICAgICAgICByZXR1cm4gcGlja2VyOw0KICAgIH0sDQogICAgZ2V0U3VibWl0VmFsdWU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWUoKTsNCiAgICB9LA0KICAgIGV4cGFuZDogZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgbWUgPSB0aGlzLA0KICAgICAgICAgICBib2R5RWwsIHBpY2tlciwgY29sbGFwc2VJZjsNCg0KICAgICAgICBpZiAobWUucmVuZGVyZWQgJiYgIW1lLmlzRXhwYW5kZWQgJiYgIW1lLmlzRGVzdHJveWVkKSB7DQogICAgICAgICAgICBib2R5RWwgPSBtZS5ib2R5RWw7DQogICAgICAgICAgICBwaWNrZXIgPSBtZS5nZXRQaWNrZXIoKTsNCiAgICAgICAgICAgIGNvbGxhcHNlSWYgPSBtZS5jb2xsYXBzZUlmOw0KICAgICAgICAgICAgLy/mmL7npLoNCiAgICAgICAgICAgIHBpY2tlci5zaG93KCk7DQogICAgICAgICAgICBtZS5pc0V4cGFuZGVkID0gdHJ1ZTsNCiAgICAgICAgICAgIG1lLmFsaWduUGlja2VyKCk7DQogICAgICAgICAgICBib2R5RWwuYWRkQ2xzKG1lLm9wZW5DbHMpOw0KDQogICAgICAgICAgICBpZiAobWUuYWRkQWxsU2VsZWN0b3IgPT0gdHJ1ZSkgew0KICAgICAgICAgICAgICAgIGlmIChwaWNrZXIuZ2V0RWwoKS5nZXRIZWlnaHQoKSA9PSAzMDApIHsNCiAgICAgICAgICAgICAgICAgICAgcGlja2VyLmdldEVsKCkuc2V0SGVpZ2h0KDMzMCkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChtZS5hZGRBbGxTZWxlY3RvciA9PSB0cnVlICYmIG1lLmFsbFNlbGVjdG9yID09IGZhbHNlKSB7DQogICAgICAgICAgICAgICAgbWUuYWxsU2VsZWN0b3IgPSBwaWNrZXIuZ2V0RWwoKS5pbnNlcnRIdG1sKCdhZnRlckJlZ2luJywgJzxkaXYgY2xhc3M9IngtYm91bmRsaXN0LWl0ZW0iIHJvbGU9Im9wdGlvbiI+PHNwYW4gY2xhc3M9IngtY29tYm8tY2hlY2tlciI+Jm5ic3A7PC9zcGFuPiAnICsgbWUuaml0QWxsVGV4dCArICc8L2Rpdj4nLCB0cnVlKTsNCiAgICAgICAgICAgICAgICBtZS5hbGxTZWxlY3Rvci5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAobWUuYWxsU2VsZWN0b3IuaGFzQ2xzKCd4LWJvdW5kbGlzdC1zZWxlY3RlZCcpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBtZS5hbGxTZWxlY3Rvci5yZW1vdmVDbHMoJ3gtYm91bmRsaXN0LXNlbGVjdGVkJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBtZS5zZXRWYWx1ZSgnJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBtZS5maXJlRXZlbnQoJ3NlbGVjdCcsIG1lLCBbXSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVjb3JkcyA9IFtdOw0KICAgICAgICAgICAgICAgICAgICAgICAgbWUuc3RvcmUuZWFjaChmdW5jdGlvbiAocmVjb3JkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3Jkcy5wdXNoKHJlY29yZCk7DQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIG1lLmFsbFNlbGVjdG9yLmFkZENscygneC1ib3VuZGxpc3Qtc2VsZWN0ZWQnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIG1lLnNlbGVjdChyZWNvcmRzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIG1lLmZpcmVFdmVudCgnc2VsZWN0JywgbWUsIHJlY29yZHMpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvLyDnm5HlkKwgDQogICAgICAgICAgICBtZS5tb24oRXh0LmdldERvYygpLCB7DQogICAgICAgICAgICAgICAgbW91c2V3aGVlbDogY29sbGFwc2VJZiwNCiAgICAgICAgICAgICAgICBtb3VzZWRvd246IGNvbGxhcHNlSWYsDQogICAgICAgICAgICAgICAgc2NvcGU6IG1lDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIEV4dC5FdmVudE1hbmFnZXIub25XaW5kb3dSZXNpemUobWUuYWxpZ25QaWNrZXIsIG1lKTsNCiAgICAgICAgICAgIG1lLmZpcmVFdmVudCgnZXhwYW5kJywgbWUpOw0KICAgICAgICAgICAgbWUub25FeHBhbmQoKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAsIG9uTGlzdFNlbGVjdGlvbkNoYW5nZTogZnVuY3Rpb24gKGxpc3QsIHNlbGVjdGVkUmVjb3Jkcykgew0KICAgICAgICB2YXIgbWUgPSB0aGlzOw0KDQogICAgICAgIGlmICghbWUuaWdub3JlU2VsZWN0aW9uICYmIG1lLmlzRXhwYW5kZWQpIHsNCiAgICAgICAgICAgIGlmICghbWUubXVsdGlTZWxlY3QpIHsNCiAgICAgICAgICAgICAgICBFeHQuZGVmZXIobWUuY29sbGFwc2UsIDEsIG1lKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIG1lLnNldFZhbHVlKHNlbGVjdGVkUmVjb3JkcywgZmFsc2UpOw0KICAgICAgICAgICAgaWYgKHNlbGVjdGVkUmVjb3Jkcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgbWUuZmlyZUV2ZW50KCdzZWxlY3QnLCBtZSwgc2VsZWN0ZWRSZWNvcmRzKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIG1lLmlucHV0RWwuZm9jdXMoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChtZS5hZGRBbGxTZWxlY3RvciA9PSB0cnVlICYmIG1lLmFsbFNlbGVjdG9yICE9IGZhbHNlKSB7DQogICAgICAgICAgICBpZiAoc2VsZWN0ZWRSZWNvcmRzLmxlbmd0aCA9PSBtZS5zdG9yZS5nZXRDb3VudCgpKSBtZS5hbGxTZWxlY3Rvci5hZGRDbHMoJ3gtYm91bmRsaXN0LXNlbGVjdGVkJyk7DQogICAgICAgICAgICBlbHNlIG1lLmFsbFNlbGVjdG9yLnJlbW92ZUNscygneC1ib3VuZGxpc3Qtc2VsZWN0ZWQnKTsNCiAgICAgICAgfQ0KICAgIH0NCn0pOyANCkV4dC5kZWZpbmUoJ0ppdC5mb3JtLmZpZWxkLkNvbWJvVHJlZScsIHsNCiAgICBleHRlbmQ6ICdFeHQuZm9ybS5maWVsZC5QaWNrZXInDQogICAgLCBhbGlhczogJ3dpZGdldC5qaXRjb21ib3RyZWUnDQogICAgLyroh6rlrprkuYnlsZ7mgKcqLw0KICAgICwgY29uZmlnOiB7DQogICAgICAgIC8q5Y2V6YCJb3LlpJrpgIkqLw0KICAgICAgICBtdWx0aVNlbGVjdDogZmFsc2UNCiAgICAgICAgLyrojrflj5bmlbDmja7nmoR1cmwqLw0KICAgICAgICAsIHVybDogbnVsbA0KICAgICAgICAvKuaYr+WQpuaYvuekuuagueiKgueCuSovDQogICAgICAgICwgaXNSb290VmlzaWJsZTogZmFsc2UNCiAgICAgICAgLyrmoLnoioLngrnnmoTmlofmnKwqLw0KICAgICAgICAsIHJvb3RUZXh0OiAncm9vdCcNCiAgICAgICAgLyrmoLnoioLngrnnmoRJRCovDQogICAgICAgICwgcm9vdElEOiAncm9vdCcNCiAgICAgICAgLyrmmK/lkKblj6rog73pgInmi6nlj7blrZDoioLngrkqLw0KICAgICAgICAsIGlzU2VsZWN0TGVhZk9ubHk6IGZhbHNlDQogICAgICAgIC8q5Yid5aeL6YCJ5Lit55qE6aG5LOivpeWPguaVsOS4uuS4gOS4quaVsOe7hO+8jOaVsOe7hOS4reeahOavj+S4quWFg+e0oOmDveWMheWQq2lk5ZKMdGV4dOWxnuaApyovDQogICAgICAgICwgaW5pdFNlbGVjdGVkSXRlbXM6IG51bGwNCiAgICAgICAgLyrpgInmi6nkuovku7YqLw0KICAgICAgICAsIG9uU2VsZWN0OiBudWxsDQogICAgICAgIC8q5qCRcGlja2Vy55qE6YWN572u6aG5Ki8NCiAgICAgICAgLCBwaWNrZXJDZmc6IHsNCiAgICAgICAgICAgIEhlaWdodDogMzAwDQogICAgICAgICAgICAsIG1heEhlaWdodDogMzAwDQogICAgICAgIH0NCg0KICAgIH0NCiAgICAvKuengeacieWtl+autSovDQogICAgLyrlvZPliY3pnaLmnb/lhoXlt7Lnu4/pgInkuK3nmoTpobkqLw0KICAgICwgc2VsZWN0ZWRWYWx1ZXM6IG5ldyBBcnJheSgpDQogICAgLyrliJ3lp4vlgLws5Yid5aeL5YC85Y+v6IO95LiN5Zyo5b2T5YmN6Z2i5p2/5YaFKi8NCiAgICAsIGluaXRWYWx1ZXM6IG5ldyBBcnJheSgpDQogICAgLyrmmK/lkKblt7Lnu4/liJvlu7pwaWNrZXIqLw0KICAgICwgaGFzQ3JlYXRlZFBpY2tlcjogZmFsc2UNCiAgICAvKuaehOmAoOWHveaVsCovDQogICAgLCBjb25zdHJ1Y3RvcjogZnVuY3Rpb24gKGNmZykgew0KICAgICAgICB2YXIgZGVmYXVsdENvbmZpZyA9IHsNCiAgICAgICAgICAgIGVkaXRhYmxlOiBmYWxzZQ0KICAgICAgICAgICAgLCBsYWJlbFNlcGFyYXRvcjogJycNCiAgICAgICAgICAgICwgbGFiZWxQYWQ6IDEwDQogICAgICAgICAgICAsIGxhYmVsQWxpZ246ICdyaWdodCcNCiAgICAgICAgICAgICwgbWFyZ2luOiAnMCAxMCAxMCAxMCcNCiAgICAgICAgICAgICwgd2lkdGg6IDE4Mw0KICAgICAgICAgICAgLCBsYWJlbFdpZHRoOiA3Mw0KICAgICAgICAgICAgLCBoZWlnaHQ6IDIyDQogICAgICAgICAgICAsIG1hdGNoRmllbGRXaWR0aDogZmFsc2UNCiAgICAgICAgfTsNCiAgICAgICAgLy/lpITnkIbliJ3lp4vlgLwNCiAgICAgICAgaWYgKGNmZy5pbml0U2VsZWN0ZWRJdGVtcyAhPSBudWxsKSB7DQogICAgICAgICAgICBpZiAoIUV4dC5pc0FycmF5KGNmZy5pbml0U2VsZWN0ZWRJdGVtcykpIHsNCiAgICAgICAgICAgICAgICBFeHQuRXJyb3IucmFpc2UoIumFjee9rumhuWluaXRTZWxlY3RlZEl0ZW1z55qE5YC85b+F6aG75piv5LiA5Liq5pWw57uELOS4lOaVsOe7hOWGheeahOavj+S4quWFg+e0oOmDveWMheWQq2lk5ZKMdGV4dOWxnuaApy4iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoaXMuaW5pdFZhbHVlcyA9IG5ldyBBcnJheSgpOw0KICAgICAgICAgICAgdmFyIHRleHQgPSAnJzsNCiAgICAgICAgICAgIHZhciBpc0ZpcnN0SXRlbSA9IHRydWU7DQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNmZy5pbml0U2VsZWN0ZWRJdGVtcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIHZhciBpdGVtID0gY2ZnLmluaXRTZWxlY3RlZEl0ZW1zW2ldOw0KICAgICAgICAgICAgICAgIGlmIChpdGVtLmlkICE9IG51bGwgJiYgaXRlbS50ZXh0ICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbml0VmFsdWVzLnB1c2goeyBpZDogaXRlbS5pZCwgdGV4dDogaXRlbS50ZXh0IH0pOw0KICAgICAgICAgICAgICAgICAgICBpZiAoaXNGaXJzdEl0ZW0pIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgKz0gaXRlbS50ZXh0Ow0KICAgICAgICAgICAgICAgICAgICAgICAgaXNGaXJzdEl0ZW0gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgKz0gJywnICsgaXRlbS50ZXh0Ow0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBkZWZhdWx0Q29uZmlnLnZhbHVlID0gdGV4dDsNCiAgICAgICAgfQ0KICAgICAgICAvL+WQiOW5tumFjee9rumhuQ0KICAgICAgICBjZmcgPSBFeHQuYXBwbHlJZihjZmcsIGRlZmF1bHRDb25maWcpOw0KICAgICAgICAvL+WIneWni+WMlumFjee9rumhuQ0KICAgICAgICB0aGlzLmluaXRDb25maWcoY2ZnKTsNCiAgICAgICAgLy/osIPnlKjniLbnsbvov5vooYzliJ3lp4vljJYNCiAgICAgICAgdGhpcy5jYWxsUGFyZW50KGFyZ3VtZW50cyk7DQogICAgfQ0KICAgIC8qDQogICAgQHByaXZhdGUNCiAgICDph43lhpljcmVhdGVQaWNrZXLmlrnms5Us55Sx5Yib5bu6Ym91bmRsaXN05pS55Li65Yib5bu65qCR6Z2i5p2/DQogICAgKi8NCiAgICAsIGNyZWF0ZVBpY2tlcjogZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgbWUgPSB0aGlzOw0KICAgICAgICBFeHQubG9nKCdjYWxsIGNyZWF0ZVBpY2tlciBtZXRob2QuJyk7DQogICAgICAgIC8v5Yib5bu65pWw5o2u6ZuGDQogICAgICAgIG1lLnN0b3JlID0gRXh0LmNyZWF0ZSgnRXh0LmRhdGEuVHJlZVN0b3JlJywgew0KICAgICAgICAgICAgcHJveHk6IHsNCiAgICAgICAgICAgICAgICB0eXBlOiAnYWpheCcNCiAgICAgICAgICAgICAgICAsIHVybDogdGhpcy51cmwNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICwgcm9vdDogew0KICAgICAgICAgICAgICAgIGV4cGFuZGVkOiB0cnVlDQogICAgICAgICAgICAgICAgLCB0ZXh0OiB0aGlzLnJvb3RUZXh0DQogICAgICAgICAgICAgICAgLCBpZDogdGhpcy5yb290SUQNCiAgICAgICAgICAgICAgICAsIGNoZWNrZWQ6ICh0aGlzLm11bHRpU2VsZWN0ICYmIHRoaXMuaXNTZWxlY3RMZWFmT25seSA9PSBmYWxzZSkgPyBmYWxzZSA6IG51bGwNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICwgbGlzdGVuZXJzOiB7DQogICAgICAgICAgICAgICAgbG9hZDogew0KICAgICAgICAgICAgICAgICAgICAvKg0KICAgICAgICAgICAgICAgICAgICDliqDovb3mlbDmja4NCiAgICAgICAgICAgICAgICAgICAgQHN0b3JlICAgICAg5b2T5YmN55qEVHJlZVN0b3Jl5a6e5L6LDQogICAgICAgICAgICAgICAgICAgIEBub2RlICAgICAgIOmcgOimgeWKoOi9veaVsOaNrueahOiKgueCuQ0KICAgICAgICAgICAgICAgICAgICBAcmVjb3JkcyAgICDku47lkI7lj7Dojrflj5bnmoTmlbDmja7orrDlvZUNCiAgICAgICAgICAgICAgICAgICAgQGlzU3VjY2VzcyAg5piv5ZCm5oiQ5YqfDQogICAgICAgICAgICAgICAgICAgIEBvcHRpb25zICAgIOiwg+eUqOiAheS8oOmAkui/h+adpeeahOWPr+mAieWPguaVsOmhuQ0KICAgICAgICAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgICAgICAgICBmbjogZnVuY3Rpb24gKHN0b3JlLCBub2RlLCByZWNvcmRzLCBpc1N1Y2Nlc3MsIG9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIEV4dC5sb2coJ2ZpcmUgbG9hZCBldmVudC4nKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNTdWNjZXNzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRXh0LkVycm9yLnJhaXNlKCLojrflj5bmoJHoioLngrnmlbDmja7lpLHotKUuIik7DQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v5aaC5p6c6K6+572u5LqG5Yid5aeL5YC877yM5YiZ5LiA5pem5Yqg6L295LqG5Yid5aeL5YC85ZCO77yM5bCx5LiN5Zyo5L+d55WZ5Li65Yid5aeL5YC8DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBpY2tlciA9IG1lLmdldFBpY2tlcigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtZS5pbml0VmFsdWVzICE9IG51bGwgJiYgbWUuaW5pdFZhbHVlcy5sZW5ndGggPiAwICYmIHJlY29yZHMgIT0gbnVsbCAmJiByZWNvcmRzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZS5pbml0VmFsdWVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsID0gbWUuaW5pdFZhbHVlc1tpXS5pZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcmVjb3Jkcy5sZW5ndGg7IGorKykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZWNvcmQgPSByZWNvcmRzW2pdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWwgPT0gcmVjb3JkLmdldCgnaWQnKSkgey8v5b2T5YmN6IqC54K5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v56e75Yiw6YCJ5Lit6aG55LitDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lLnNlbGVjdGVkVmFsdWVzLnB1c2gobWUuaW5pdFZhbHVlc1tpXSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lLmluaXRWYWx1ZXMuc3BsaWNlKGksIDEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLS07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v5aaC5p6c5piv5Y2V6YCJ77yM6K6+572u6YCJ5Lit5qC35byPDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtZS5tdWx0aVNlbGVjdCA9PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGlja2VyLmdldFNlbGVjdGlvbk1vZGVsKCkuc2VsZWN0KHJlY29yZCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugey8v5YW25a2Q6IqC54K5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjaGlsZCA9IHJlY29yZC5maW5kQ2hpbGQoJ2lkJywgdmFsLCB0cnVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v56e75Yiw6YCJ5Lit6aG55LitDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZS5zZWxlY3RlZFZhbHVlcy5wdXNoKG1lLmluaXRWYWx1ZXNbaV0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWUuaW5pdFZhbHVlcy5zcGxpY2UoaSwgMSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLS07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL+WmguaenOaYr+WNlemAie+8jOiuvue9rumAieS4reagt+W8jw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1lLm11bHRpU2VsZWN0ID09IGZhbHNlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGlja2VyLmdldFNlbGVjdGlvbk1vZGVsKCkuc2VsZWN0KHJlY29yZCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLCBiZWZvcmVsb2FkOiB7DQogICAgICAgICAgICAgICAgICAgIC8qDQogICAgICAgICAgICAgICAgICAgIOWKoOi9veaVsOaNruS5i+WJjQ0KICAgICAgICAgICAgICAgICAgICBAc3RvcmUgICAgICDlvZPliY3nmoTmoJHoioLngrlzdG9yZQ0KICAgICAgICAgICAgICAgICAgICBAb3BlcmF0aW9uICDmk43kvZwNCiAgICAgICAgICAgICAgICAgICAgQG9wdGlvbnMgICAg5ZCR5ZCO5Lyg6YCS55qE5Y+v6YCJ5Y+C5pWwDQogICAgICAgICAgICAgICAgICAgICovDQogICAgICAgICAgICAgICAgICAgIGZuOiBmdW5jdGlvbiAoc3RvcmUsIG9wZXJhdGlvbiwgb3B0aW9ucykgew0KICAgICAgICAgICAgICAgICAgICAgICAgRXh0LmxvZygnZmlyZSBiZWZvcmVsb2FkIGV2ZW50LicpOw0KICAgICAgICAgICAgICAgICAgICAgICAgb3BlcmF0aW9uLnBhcmFtcy5tdWx0aVNlbGVjdCA9IG1lLm11bHRpU2VsZWN0OyAgLy/lkYror4nlkI7lj7DmmK/lkKbkuLrlpJrpgIkNCiAgICAgICAgICAgICAgICAgICAgICAgIG9wZXJhdGlvbi5wYXJhbXMuaXNTZWxlY3RMZWFmT25seSA9IG1lLmlzU2VsZWN0TGVhZk9ubHk7ICAgIC8v5ZGK6K+J5ZCO5Y+w5piv5ZCm5Li65Y+q6YCJ5oup5Y+25a2Q6IqC54K5DQogICAgICAgICAgICAgICAgICAgICAgICAvL+WQkeWQjuWPsOWPkemAgeWIneWni+WAvA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1lLmluaXRWYWx1ZXMgIT0gbnVsbCAmJiBtZS5pbml0VmFsdWVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRpb24ucGFyYW1zLmluaXRWYWx1ZXMgPSBFeHQuSlNPTi5lbmNvZGUobWUuaW5pdFZhbHVlcyk7ICAgIC8v5ZGK6K+J5ZCO5Y+w5Yid5aeL5YC8DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICAvLw0KICAgICAgICB2YXIgZGVmYXVsdFRyZWVDZmcgPSB7DQogICAgICAgICAgICB3aWR0aDogMjAwDQogICAgICAgICAgICAsIG1pbkhlaWdodDogMzAwDQogICAgICAgICAgICAsIGF1dG9TY3JvbGw6IHRydWUNCiAgICAgICAgICAgICwgZmxvYXRpbmc6IHRydWUNCiAgICAgICAgfTsNCiAgICAgICAgdmFyIHRyZWVDZmcgPSBFeHQuYXBwbHlJZihtZS5waWNrZXJDZmcgfHwge30sIGRlZmF1bHRUcmVlQ2ZnKTsNCiAgICAgICAgdHJlZUNmZy5zdG9yZSA9IG1lLnN0b3JlOw0KICAgICAgICB0cmVlQ2ZnLm11bHRpU2VsZWN0ID0gbWUubXVsdGlTZWxlY3Q7DQogICAgICAgIHRyZWVDZmcucm9vdFZpc2libGUgPSBtZS5pc1Jvb3RWaXNpYmxlOw0KICAgICAgICAvL+WIm+W7uuagkemdouadvw0KICAgICAgICB2YXIgdHJlZSA9IEV4dC5jcmVhdGUoJ0V4dC50cmVlLlBhbmVsJywgdHJlZUNmZyk7DQogICAgICAgIHRoaXMuaGFzQ3JlYXRlZFBpY2tlciA9IHRydWU7DQogICAgICAgIC8v5oyC6L295LqL5Lu25aSE55CGDQogICAgICAgIGlmIChFeHQuaXNJRTcgfHwgRXh0LmlzSUU4KSB7DQogICAgICAgICAgICB0cmVlLm9uKCdjaGVja2NoYW5nZScNCiAgICAgICAgICAgICAgICAsIGZ1bmN0aW9uIChyZWNvcmQsIGNoZWNrZWQsIG9wdGlvbnMpIHsNCiAgICAgICAgICAgICAgICAgICAgbWUuY2hvaWNlKHJlY29yZCwgZmFsc2UpOw0KICAgICAgICAgICAgICAgIH0sIHRoaXMpOw0KICAgICAgICB9DQogICAgICAgIHRyZWUub24oJ2l0ZW1jbGljaycsIGZ1bmN0aW9uIChjb21ib3RyZWVWaWV3LCByZWNvcmQsIGl0ZW0sIGluZGV4LCBlLCBvcHRpb25zKSB7DQogICAgICAgICAgICBtZS5jaG9pY2UocmVjb3JkLCB0cnVlKTsNCiAgICAgICAgfSwgdGhpcyk7DQogICAgICAgIC8vDQogICAgICAgIHJldHVybiB0cmVlOw0KICAgIH0NCiAgICAvKg0KICAgIEBwdWJsaWMNCiAgICDojrflj5blt7Lnu4/pgInkuK3nmoTlgLwNCiAgICBAcmV0dXJuICAgICDpgInkuK3lgLznmoTmlbDnu4Qs5aaC5p6c5Li65Y2V6YCJ5YiZ5pWw57uE5Lit5Y+q5pyJ5LiA5Liq5YWD57Sg77yM5ZCm5YiZ5Lya5pyJ5aSa5LiqDQogICAgKi8NCiAgICAsIGdldFZhbHVlczogZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgdmFsdWVzID0gbmV3IEFycmF5KCk7DQogICAgICAgIC8v5bCG5LuN54S25rKh5pyJ5Yqg6L295Yiw5b2T5YmN6Z2i5p2/55qE5Yid5aeL5YC85Yqg5YWl5YC85pWw57uEDQogICAgICAgIGlmICh0aGlzLmluaXRWYWx1ZXMgIT0gbnVsbCAmJiB0aGlzLmluaXRWYWx1ZXMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgdmFsdWVzID0gdmFsdWVzLmNvbmNhdChFeHQuY2xvbmUodGhpcy5pbml0VmFsdWVzKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRWYWx1ZXMgIT0gbnVsbCkgew0KICAgICAgICAgICAgdmFsdWVzID0gdmFsdWVzLmNvbmNhdChFeHQuY2xvbmUodGhpcy5zZWxlY3RlZFZhbHVlcykpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiB2YWx1ZXM7DQogICAgfQ0KICAgIC8qDQogICAgQHB1YmxpYw0KICAgIOiuvue9ruWAvA0KICAgIEBwU2VsZWN0ZWRJdGVtcyAgICAg6YCJ5Lit55qE6aG5LOWPguaVsOexu+Wei+S4uuaVsOe7hO+8jOaVsOe7hOS4reeahOavj+S4quWFg+e0oOmDveaYr+S4gOS4quWMheWQq2lk5ZKMdGV4dOWxnuaAp+eahOWvueixoeOAgg0KICAgIGlk5YC85piv5b+F6aG755qE77yMdGV4dOWAvOS4uuWPr+mAieOAguS9huaYr++8jOWmguaenOmAieS4reeahOmhueS4jeWcqOW9k+WJjeagkeiKgueCueWGhe+8jOWmguaenHRleHTkuLrnqboNCiAgICDliJnmmL7npLrnmoTpgInkuK3lgLzmlofmnKzkvJrkuI3lr7njgIINCiAgICBAcElzQXBwZW5kICAgICAgICAgIOaYr+WQpua3u+WKoCzlj4LmlbDnsbvlnovkuLpib29sLuWmguaenOWAvOS4unRydWUs5YiZ5L+d55WZ546w5pyJ55qE5YC8LOWQpuWImemmluWFiOa4hemZpOeOsOacieeahOWAvC4NCiAgICDpu5jorqTkuLpmYWxzZS4NCiAgICAqLw0KICAgICwgc2V0VmFsdWVzOiBmdW5jdGlvbiAocFNlbGVjdGVkSXRlbXMsIHBJc0FwcGVuZCkgew0KICAgICAgICBFeHQubG9nKCdjYWxsIHNldFZhbHVlcyBtZXRob2QuJyk7DQogICAgICAgIC8v5Y+C5pWw5aSE55CGDQogICAgICAgIGlmIChwU2VsZWN0ZWRJdGVtcyA9PSBudWxsKQ0KICAgICAgICAgICAgcFNlbGVjdGVkSXRlbXMgPSBuZXcgQXJyYXkoKTsNCiAgICAgICAgaWYgKHRoaXMubXVsdGlTZWxlY3QgPT0gZmFsc2UgJiYgcFNlbGVjdGVkSXRlbXMubGVuZ3RoID4gMSkgey8v5Y2V6YCJ5pe25LiN6IO96K6+572u5aSa5YC8DQogICAgICAgICAgICBFeHQuRXJyb3IucmFpc2UoJ+WNlemAieaXtuS4jeiDveiuvue9ruWkmuWAvC4nKTsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgaXRlbXMgPSBuZXcgQXJyYXkoKTsNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwU2VsZWN0ZWRJdGVtcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgdmFyIGl0ZW0gPSBwU2VsZWN0ZWRJdGVtc1tpXTsNCiAgICAgICAgICAgIGlmIChpdGVtLnRleHQgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIGl0ZW0udGV4dCA9ICIiOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGl0ZW0uaWQgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIEV4dC5FcnJvci5yYWlzZSgncFNlbGVjdGVkSXRlbXPmlbDnu4TkuK3nmoTmr4/kuKrlhYPntKDpg73lv4XpobvljIXlkKtpZOWSjHRleHTlsZ7mgKcuJyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpdGVtcy5wdXNoKHsgaWQ6IGl0ZW0uaWQsIHRleHQ6IGl0ZW0udGV4dCB9KTsNCiAgICAgICAgfQ0KICAgICAgICAvL0V4dC5kYXRhLlRyZWVTdG9yZeS4gOaXpuWIm+W7uuWQju+8jOS8muiHquWKqOWQkeWQjuWPsOWPkemAgeivt+axgu+8jOiOt+WPluiKgueCueaVsOaNrg0KICAgICAgICAvL+WboOatpO+8jOS4uuS6humBv+WFjeWvuWluaXRWYWx1ZXPnmoTlubblj5Horr/pl64s5YiGMuenjeaDheWGtei/m+ihjOWkhOeQhg0KICAgICAgICBpZiAodGhpcy5oYXNDcmVhdGVkUGlja2VyID09IGZhbHNlKSB7Ly/lpoLmnpzmnKrosIPnlKjov4djcmVhdGVQaWNrZXLmlrnms5UNCiAgICAgICAgICAgIHRoaXMuaW5pdFZhbHVlcyA9IGl0ZW1zOw0KICAgICAgICB9IGVsc2Ugey8v6LCD55So6L+HY3JlYXRlUGlja2Vy5pa55rOVLOm7mOiupOiupOS4uuaVsOaNruW3sue7j+WKoOi9veWujOavlQ0KICAgICAgICAgICAgdmFyIHBpY2tlciA9IHRoaXMuZ2V0UGlja2VyKCk7DQogICAgICAgICAgICB2YXIgc3RvcmUgPSBwaWNrZXIuc3RvcmU7DQogICAgICAgICAgICAvL+a4hemZpOeOsOacieeahOmAieS4remhuQ0KICAgICAgICAgICAgaWYgKCFwSXNBcHBlbmQpIHsNCiAgICAgICAgICAgICAgICB2YXIgY2hlY2tlZEl0ZW1zID0gcGlja2VyLmdldENoZWNrZWQoKTsNCiAgICAgICAgICAgICAgICBpZiAoY2hlY2tlZEl0ZW1zICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGVja2VkSXRlbXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWRJdGVtc1tpXS5zZXQoJ2NoZWNrZWQnLCBmYWxzZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy/muIXpmaTlgLwNCiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkVmFsdWVzID0gbmV3IEFycmF5KCk7DQogICAgICAgICAgICAgICAgdGhpcy5pbml0VmFsdWVzID0gbmV3IEFycmF5KCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvL+WkhOeQhumAieS4reWAvA0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIHZhciBpdGVtID0gaXRlbXNbaV07DQogICAgICAgICAgICAgICAgLy8NCiAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IHN0b3JlLmdldE5vZGVCeUlkKGl0ZW0uaWQpOw0KICAgICAgICAgICAgICAgIGlmIChub2RlICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgLy/lnKjlvZPliY3moJHkuK3lj5HnjrDmjIflrprnmoToioLngrkNCiAgICAgICAgICAgICAgICAgICAgLy/lpoLmnpzoioLngrnnmoTpgInkuK3nirbmgIHkuLrmnKrpgInkuK0s5YiZ6K6+572u6YCJ5Lit54q25oCB5Li66YCJ5LitDQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm11bHRpU2VsZWN0ID09IHRydWUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbm9kZS5nZXQoJ2NoZWNrZWQnKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuc2V0KCdjaGVja2VkJywgdHJ1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBwaWNrZXIuZ2V0U2VsZWN0aW9uTW9kZWwoKS5zZWxlY3Qobm9kZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFZhbHVlcy5wdXNoKHsgaWQ6IG5vZGUuZ2V0KCdpZCcpLCB0ZXh0OiBub2RlLmdldCgndGV4dCcpIH0pOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIC8v5Zyo5b2T5YmN5qCR5Lit5pyq5Y+R546w5oyH5a6a55qE6IqC54K577yM57uE5Lu25bCG6K+l6IqC54K55b2T5L2c5piv5Yid5aeL6YCJ5Lit6aG555yL5b6FDQogICAgICAgICAgICAgICAgICAgIHRoaXMuaW5pdFZhbHVlcy5wdXNoKHsgaWQ6IGl0ZW0uaWQsIHRleHQ6IGl0ZW0udGV4dCB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgLy/mm7TmlrDlvZPliY3nmoTmlofmnKwNCiAgICAgICAgdGhpcy5yZWZyZXNoVGV4dCgpOw0KICAgIH0sDQogICAgaml0R2V0VmFsdWU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIHNlbGVjdGVkVmFsdWVzID0gdGhpcy5nZXRWYWx1ZXMoKTsNCiAgICAgICAgdmFyIGlkcyA9IG5ldyBBcnJheSgpOw0KICAgICAgICBpZiAoc2VsZWN0ZWRWYWx1ZXMgIT0gbnVsbCkgew0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWxlY3RlZFZhbHVlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIGlkcy5wdXNoKHNlbGVjdGVkVmFsdWVzW2ldWyJpZCJdKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gaWRzLmpvaW4oJywnKTsNCiAgICB9LA0KICAgIC8qDQogICAg5qC55o2uaWTlgLwNCiAgICAqLw0KICAgIGppdEdldEJ5SUQ6IGZ1bmN0aW9uIChwSUQpIHsNCiAgICAgICAgdmFyIHN0b3JlID0gdGhpcy5zdG9yZTsNCiAgICAgICAgdmFyIGl0ZW0gPSBudWxsOw0KICAgICAgICBpZiAoc3RvcmUgIT0gbnVsbCkgew0KICAgICAgICAgICAgdmFyIHJvb3QgPSBzdG9yZS5nZXRSb290Tm9kZSgpOw0KICAgICAgICAgICAgaWYgKHJvb3QgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHZhciBub2RlID0gcm9vdC5maW5kQ2hpbGQoJ2lkJywgcElELCB0cnVlKTsNCiAgICAgICAgICAgICAgICBpZiAobm9kZSAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIGl0ZW0gPSB7ICJpZCI6IG5vZGUuZGF0YS5pZCwgInRleHQiOiBub2RlLmRhdGEudGV4dCB9Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gaXRlbTsNCiAgICB9LA0KICAgIGppdFNldFZhbHVlVGV4dDogZnVuY3Rpb24gKHZhbHVlLCB2YWx1ZVRleHQpIHsNCiAgICAgICAgaWYgKEV4dC5pc0FycmF5KHZhbHVlKSkgew0KICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZXModmFsdWUsIGZhbHNlKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHZhciBpbml0VmFsdWVzID0gbmV3IEFycmF5KCk7DQogICAgICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCAmJiB2YWx1ZSAhPSAiIikgew0KICAgICAgICAgICAgICAgIHZhciB2YWx1ZXMgPSB2YWx1ZS50b1N0cmluZygpLnNwbGl0KCIsIik7DQogICAgICAgICAgICAgICAgdmFyIHZhbHVlVGV4dHMgPSB2YWx1ZVRleHQudG9TdHJpbmcoKS5zcGxpdCgiLCIpOw0KICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFsdWVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZXNbaV0gIT0gIiIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGluaXRWYWx1ZXMucHVzaCh7IGlkOiB2YWx1ZXNbaV0sIHRleHQ6IHZhbHVlVGV4dHNbaV0gfSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLnNldFZhbHVlcyhpbml0VmFsdWVzLCBmYWxzZSk7DQogICAgICAgIH0NCiAgICB9LA0KICAgIGppdFNldFZhbHVlOiBmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgdGhpcy5zZXRWYWx1ZXModmFsdWUsIGZhbHNlKTsNCiAgICB9DQogICAgLyoNCiAgICBAcHJpdmF0ZQ0KICAgIOW3peWFt+aWueazlSAtIOagueaNrumAieS4remhueWIt+aWsOaWh+acrA0KICAgICovDQogICAgLCByZWZyZXNoVGV4dDogZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgdGV4dCA9ICcnOw0KICAgICAgICB2YXIgaXNGaXJzdE5vZGUgPSB0cnVlOw0KICAgICAgICBpZiAodGhpcy5zZWxlY3RlZFZhbHVlcyAhPSBudWxsICYmIHRoaXMuc2VsZWN0ZWRWYWx1ZXMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNlbGVjdGVkVmFsdWVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgaWYgKGlzRmlyc3ROb2RlKSB7DQogICAgICAgICAgICAgICAgICAgIHRleHQgPSB0aGlzLnNlbGVjdGVkVmFsdWVzW2ldLnRleHQ7DQogICAgICAgICAgICAgICAgICAgIGlzRmlyc3ROb2RlID0gZmFsc2U7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgdGV4dCArPSAnLCcgKyB0aGlzLnNlbGVjdGVkVmFsdWVzW2ldLnRleHQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmICh0aGlzLmluaXRWYWx1ZXMgIT0gbnVsbCAmJiB0aGlzLmluaXRWYWx1ZXMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmluaXRWYWx1ZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICBpZiAoaXNGaXJzdE5vZGUpIHsNCiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRoaXMuaW5pdFZhbHVlc1tpXS50ZXh0Ow0KICAgICAgICAgICAgICAgICAgICBpc0ZpcnN0Tm9kZSA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHRleHQgKz0gJywnICsgdGhpcy5pbml0VmFsdWVzW2ldLnRleHQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIC8v6K6+572u5paH5pysDQogICAgICAgIHRoaXMuc2V0VmFsdWUodGV4dCk7DQogICAgfQ0KICAgIC8qDQogICAgQHByaXZhdGUNCiAgICDlt6Xlhbfmlrnms5UgLSDpgInkuK3lpITnkIYNCiAgICBAY29tYm90cmVlVmlldyAgIOW9k+WJjeeahOaOp+S7tueahHZpZXcNCiAgICBAcmVjb3JkICAgICDpgInkuK3pobnnmoTmlbDmja4NCiAgICBAaXRlbSAgICAgICDpgInkuK3pobnnmoRIVE1MDQogICAgQGluZGV4ICAgICAg6YCJ5Lit6aG555qE57Si5byVDQogICAgQGUgICAgICAgICAg5Y6f5aeL55qE5LqL5Lu25a+56LGhDQogICAgQG9wdGlvbnMgICAg5LuO5YmN6Z2i5Lyg6YCS6L+H5p2l55qE5Y+v6YCJ5Y+C5pWwDQogICAgKi8NCiAgICAsIGNob2ljZTogZnVuY3Rpb24gKHJlY29yZCwgdHlwZSkgew0KICAgICAgICB2YXIgcGlja2VyID0gdGhpcy5nZXRQaWNrZXIoKTsNCiAgICAgICAgLy8NCiAgICAgICAgaWYgKHRoaXMuaXNTZWxlY3RMZWFmT25seSAmJiByZWNvcmQuZ2V0KCdsZWFmJykgPT0gZmFsc2UpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgZGVmYXVsdFNlbGVjdFZhbHVlID0gdGhpcy5qaXRHZXRWYWx1ZSgpOw0KICAgICAgICBpZiAodGhpcy5tdWx0aVNlbGVjdCkgey8v5aSa6YCJ5qih5byPDQogICAgICAgICAgICAvL+WkjeWGmSBwaWNrZXIuZ2V0VmlldygpLm9uQ2hlY2tDaGFuZ2UocmVjb3JkKSzkuI3osIPnlKgnY2hlY2tjaGFuZ2Un5LqL5Lu2DQogICAgICAgICAgICBpZiAodHlwZSkgew0KICAgICAgICAgICAgICAgIHZhciBjaGVja2VkID0gcmVjb3JkLmdldCgnY2hlY2tlZCcpOw0KICAgICAgICAgICAgICAgIGlmIChFeHQuaXNCb29sZWFuKGNoZWNrZWQpKSB7DQogICAgICAgICAgICAgICAgICAgIGNoZWNrZWQgPSAhY2hlY2tlZDsNCiAgICAgICAgICAgICAgICAgICAgcmVjb3JkLnNldCgnY2hlY2tlZCcsIGNoZWNrZWQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vICAgICAgICAgICAgaWYgKHR5cGUpIHsNCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgIHBpY2tlci5nZXRWaWV3KCkub25DaGVja0NoYW5nZShyZWNvcmQpOyAvL+eCueWHu+mAiemhueaXtuWwhuWLvumAieahhuWLvumAieS4ig0KICAgICAgICAgICAgLy8gICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vDQogICAgICAgICAgICB2YXIgc2VsZWN0ZWRJdGVtcyA9IHBpY2tlci5nZXRDaGVja2VkKCk7DQogICAgICAgICAgICB2YXIgc2VsZWN0ZWRWYWx1ZXMgPSBuZXcgQXJyYXkoKTsNCiAgICAgICAgICAgIGlmIChzZWxlY3RlZEl0ZW1zICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGVjdGVkSXRlbXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBzZWxlY3RlZEl0ZW1zW2ldOw0KICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZFZhbHVlcy5wdXNoKHsgaWQ6IGl0ZW0uZ2V0KCdpZCcpLCB0ZXh0OiBpdGVtLmdldCgndGV4dCcpIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRWYWx1ZXMgPSBzZWxlY3RlZFZhbHVlczsNCiAgICAgICAgfSBlbHNlIHsvL+WNlemAieaooeW8jyAgICAgICAgICAgDQogICAgICAgICAgICB0aGlzLnNlbGVjdGVkVmFsdWVzID0gbmV3IEFycmF5KCk7DQogICAgICAgICAgICB0aGlzLnNlbGVjdGVkVmFsdWVzLnB1c2goeyBpZDogcmVjb3JkLmdldCgnaWQnKSwgdGV4dDogcmVjb3JkLmdldCgndGV4dCcpIH0pOw0KDQogICAgICAgICAgICB0aGlzLmNvbGxhcHNlKCk7DQogICAgICAgIH0NCiAgICAgICAgLy/liLfmlrDmlofmnKwNCiAgICAgICAgdGhpcy5yZWZyZXNoVGV4dCgpOw0KICAgICAgICBpZiAodGhpcy5vblNlbGVjdCAhPSBudWxsKSB7DQogICAgICAgICAgICBpZiAoZGVmYXVsdFNlbGVjdFZhbHVlICE9IHRoaXMuaml0R2V0VmFsdWUoKSkgew0KICAgICAgICAgICAgICAgIHRoaXMub25TZWxlY3QoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCn0pOw0KRXh0LmRlZmluZSgnSml0LmZvcm0uZmllbGQuRGF0ZScsIHsNCiAgICBleHRlbmQ6ICdFeHQuZm9ybS5maWVsZC5EYXRlJw0KICAgICwgYWxpYXM6ICd3aWRnZXQuaml0ZGF0ZWZpZWxkJw0KICAgICwgY29uc3RydWN0b3I6IGZ1bmN0aW9uIChjZmcpIHsNCiAgICAgICAgLy/lrprkuYnpu5jorqTphY3nva4NCiAgICAgICAgdmFyIGRlZmF1bHRDb25maWcgPSB7DQogICAgICAgICAgICBsYWJlbFNlcGFyYXRvcjogJycNCiAgICAgICAgICAgICwgbGFiZWxQYWQ6IDEwDQogICAgICAgICAgICAsIGxhYmVsQWxpZ246ICdyaWdodCcNCiAgICAgICAgICAgICwgbWFyZ2luOiAnMCAxMCAxMCAxMCcNCiAgICAgICAgICAgICwgbGFiZWxXaWR0aDogNzMNCiAgICAgICAgICAgICwgaGVpZ2h0OiAyMg0KICAgICAgICAgICAgLCB3aWR0aDogMTgzDQogICAgICAgICAgICAsIGVkaXRhYmxlOiBmYWxzZQ0KICAgICAgICAgICAgLCBmb3JtYXQ6ICJZLW0tZCINCiAgICAgICAgfQ0KDQogICAgICAgIC8v5ZCI5bm26YWN572u6aG5DQogICAgICAgIGNmZyA9IEV4dC5hcHBseUlmKGNmZywgZGVmYXVsdENvbmZpZyk7DQogICAgICAgIC8v5Yid5aeL5YyW6YWN572u6aG5DQogICAgICAgIHRoaXMuaW5pdENvbmZpZyhjZmcpOw0KICAgICAgICAvL+iwg+eUqOeItuexu+i/m+ihjOWIneWni+WMlg0KICAgICAgICB0aGlzLmNhbGxQYXJlbnQoYXJndW1lbnRzKTsNCiAgICB9LA0KICAgIGppdEdldFZhbHVlOiBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciB0aW1lVGV4dCA9IHRoaXMuZ2V0VmFsdWUoKTsNCiAgICAgICAgaWYgKHRpbWVUZXh0ICE9IG51bGwpIHsNCiAgICAgICAgICAgIHJldHVybiBFeHQuRGF0ZS5mb3JtYXQodGltZVRleHQsICdZLW0tZCcpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAiIjsNCiAgICB9LA0KICAgIGppdFNldFZhbHVlOiBmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlICE9IG51bGwgJiYgdmFsdWUgIT0gIiIpIHsNCiAgICAgICAgICAgIC8v5YW85a65SUU45bm25LiU5pu/5o2iMjAxMy8xMi8xMuS4ujIwMTMtMTItMTINCiAgICAgICAgICAgIGlmICh0eXBlb2YgKHZhbHVlKSAhPSAnb2JqZWN0JyAmJiB2YWx1ZS5jb25zdHJ1Y3RvciAhPSBEYXRlKSB7DQogICAgICAgICAgICAgICAgaWYgKHZhbHVlLnRvU3RyaW5nKCkuaW5kZXhPZigiLyIpID4gLTEpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9cLy9nLCAiLSIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB0aGlzLnNldFZhbHVlKEV4dC5EYXRlLmZvcm1hdChFeHQuRGF0ZS5wYXJzZSh2YWx1ZSwgJ2MnKSwgJ1ktbS1kJykpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB0aGlzLnNldFZhbHVlKEV4dC5EYXRlLmZvcm1hdCh2YWx1ZSwgJ1ktbS1kJykpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZSgiIik7DQogICAgICAgIH0NCiAgICB9LA0KICAgIGppdEdldFZhbHVlVGV4dDogZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgdGltZVRleHQgPSB0aGlzLmdldFZhbHVlKCk7DQogICAgICAgIGlmICh0aW1lVGV4dCAhPSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gRXh0LkRhdGUuZm9ybWF0KHRpbWVUZXh0LCAnWS1tLWQnKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gIiI7DQogICAgfQ0KfSk7DQpFeHQuZGVmaW5lKCdKaXQuZm9ybS5maWVsZC5Nb250aCcsIHsNCiAgICBleHRlbmQ6ICdFeHQuZm9ybS5maWVsZC5QaWNrZXInDQogICAgLCBhbGlhczogJ3dpZGdldC5qaXRtb250aGZpZWxkJw0KICAgICwgdHJpZ2dlckNsczogRXh0LmJhc2VDU1NQcmVmaXggKyAnZm9ybS1kYXRlLXRyaWdnZXInDQogICAgLCBtYXRjaEZpZWxkV2lkdGg6IGZhbHNlDQogICAgLyrlgLzmoLzlvI/kuI3mraPnoa7nmoTplJnor6/kv6Hmga8qLw0KICAgICwgdmFsdWVGb3JtYXRFcnJvck1lc3NhZ2U6J3ZhbHVl5YC85b+F6aG75Li65ZCI5rOV55qE5pel5pyf5a+56LGh5oiW5qC85byP5q2j56Gu55qE5pel5pyf5a2X56ym5LiyLicNCiAgICAvKuWGhemDqOeahOaXpeacn+WAvCovDQogICAgLCBpbm5lckRhdGVWYWx1ZTogbnVsbA0KICAgIC8q5p6E6YCg5Ye95pWwKi8NCiAgICAsIGNvbnN0cnVjdG9yOiBmdW5jdGlvbiAoY2ZnKSB7DQogICAgICAgIC8v5a6a5LmJ6buY6K6k6YWN572uDQogICAgICAgIHZhciBkZWZhdWx0Q29uZmlnID0gew0KICAgICAgICAgICAgbGFiZWxTZXBhcmF0b3I6ICcnDQogICAgICAgICAgICAsIGxhYmVsUGFkOiAxMA0KICAgICAgICAgICAgLCBsYWJlbEFsaWduOiAncmlnaHQnDQogICAgICAgICAgICAsIG1hcmdpbjogJzAgMTAgMTAgMTAnDQogICAgICAgICAgICAsIGxhYmVsV2lkdGg6IDczDQogICAgICAgICAgICAsIGhlaWdodDogMjINCiAgICAgICAgICAgICwgd2lkdGg6IDE4Mw0KICAgICAgICAgICAgLCBlZGl0YWJsZTogZmFsc2UNCiAgICAgICAgICAgICwgZm9ybWF0OiAiWS1tIg0KICAgICAgICB9DQogICAgICAgIC8v5ZCI5bm26YWN572u6aG5DQogICAgICAgIGNmZyA9IEV4dC5hcHBseUlmKGNmZywgZGVmYXVsdENvbmZpZyk7DQogICAgICAgIC8v6K6+572u5YaF6YOo55qE5pel5pyf5YC8DQogICAgICAgIGlmIChjZmcudmFsdWUpIHsNCiAgICAgICAgICAgIGlmIChFeHQuaXNEYXRlKGNmZy52YWx1ZSkpIHsNCiAgICAgICAgICAgICAgICAvL2RvIG5vdGhpbmcNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoRXh0LmlzU3RyaW5nKGNmZy52YWx1ZSkpIHsNCiAgICAgICAgICAgICAgICB2YXIgdGVtcCA9IEV4dC5EYXRlLnBhcnNlKGNmZy52YWx1ZSwgY2ZnLmZvcm1hdCk7DQogICAgICAgICAgICAgICAgaWYgKHRlbXAgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgY2ZnLnZhbHVlID0gdGVtcDsNCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIEV4dC5FcnJvci5yYWlzZSh0aGlzLnZhbHVlRm9ybWF0RXJyb3JNZXNzYWdlKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgRXh0LkVycm9yLnJhaXNlKHRoaXMudmFsdWVGb3JtYXRFcnJvck1lc3NhZ2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgY2ZnLnZhbHVlID0gbmV3IERhdGUoKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmlubmVyRGF0ZVZhbHVlID0gY2ZnLnZhbHVlOw0KICAgICAgICAvL+WIneWni+WMlumFjee9rumhuQ0KICAgICAgICB0aGlzLmluaXRDb25maWcoY2ZnKTsNCiAgICAgICAgLy/osIPnlKjniLbnsbvov5vooYzliJ3lp4vljJYNCiAgICAgICAgdGhpcy5jYWxsUGFyZW50KGFyZ3VtZW50cyk7DQogICAgfQ0KICAgIC8q5Yid5aeL5YyW5o6n5Lu2Ki8NCiAgICAsIGluaXRDb21wb25lbnQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIG1lID0gdGhpczsNCiAgICAgICAgbWUuZGlzYWJsZWREYXRlc1JFID0gbnVsbDsNCiAgICAgICAgbWUuY2FsbFBhcmVudCgpOw0KICAgIH0NCiAgICAvKg0KICAgIOWwhuaWh+acrOahhuS4reeahOi+k+WFpeWGheWuuei9rOaNouS4uuaXpeacn+WAvA0KICAgICovDQogICAgLCByYXdUb1ZhbHVlOiBmdW5jdGlvbiAocmF3VmFsdWUpIHsNCiAgICAgICAgcmV0dXJuIEV4dC5EYXRlLnBhcnNlKHJhd1ZhbHVlLCB0aGlzLmZvcm1hdCk7DQogICAgfQ0KICAgIC8qDQogICAg5qC85byP5YyW5pel5pyf5bm25pi+56S65Zyo5paH5pys5qGG5LitDQogICAgKi8NCiAgICAsIHZhbHVlVG9SYXc6IGZ1bmN0aW9uICh2YWx1ZSkgew0KICAgICAgICByZXR1cm4gRXh0LkRhdGUuZGF0ZUZvcm1hdCh2YWx1ZSwgdGhpcy5mb3JtYXQpOw0KICAgIH0NCiAgICAvKuWIm+W7ulBpY2tlcuWvueixoSovDQogICAgLCBjcmVhdGVQaWNrZXI6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIG1lID0gdGhpczsNCiAgICAgICAgLy/pu5jorqTnmoTphY3nva7pobkNCiAgICAgICAgdmFyIGRlZmF1bHRQaWNrZXJDZmcgPSB7DQogICAgICAgICAgICBwaWNrZXJGaWVsZDogbWUNCiAgICAgICAgICAgICwgcmVuZGVyVG86IG1lLnJlbmRlclRvDQogICAgICAgICAgICAsIG93bmVyQ3Q6IG1lLm93bmVyQ3QNCiAgICAgICAgICAgICwgZmxvYXRpbmc6IHRydWUNCiAgICAgICAgICAgICwgc2hhZG93OiBmYWxzZQ0KICAgICAgICAgICAgLCBmb2N1c09uU2hvdzogdHJ1ZQ0KICAgICAgICAgICAgLCBsaXN0ZW5lcnM6IHsNCiAgICAgICAgICAgICAgICBzY29wZTogbWUNCiAgICAgICAgICAgICAgICAsIGNhbmNlbGNsaWNrOiBtZS5vbkNhbmNlbENsaWNrDQogICAgICAgICAgICAgICAgLCBva2NsaWNrOiBtZS5vbk9LQ2xpY2sNCiAgICAgICAgICAgICAgICAsIHllYXJkYmxjbGljazogbWUub25PS0NsaWNrDQogICAgICAgICAgICAgICAgLCBtb250aGRibGNsaWNrOiBtZS5vbk9LQ2xpY2sNCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgLy/lkIjlubbphY3nva7pobkNCiAgICAgICAgdmFyIGNmZyA9IEV4dC5hcHBseUlmKG1lLnBpY2tlckNmZyB8fCB7fSwgZGVmYXVsdFBpY2tlckNmZyk7DQogICAgICAgIC8v5Yib5bu6UGlja2VyDQogICAgICAgIHJldHVybiBFeHQuY3JlYXRlKCdFeHQucGlja2VyLk1vbnRoJywgY2ZnKTsNCiAgICB9DQogICAgLyoNCiAgICDmjqfku7blsZXlvIANCiAgICAqLw0KICAgICwgb25FeHBhbmQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5waWNrZXIuc2V0VmFsdWUodGhpcy5pbm5lckRhdGVWYWx1ZSk7DQogICAgfQ0KICAgIC8qDQogICAg5bel5YW35Ye95pWwIC0g55So5LqO5aSE55CGUGlja2Vy55qET0vmjInpkq7ngrnlh7vlkI7nmoTkuovku7YNCiAgICBAcFBpY2tlciAgICDlvZPliY3nmoRQaWNrZXLlr7nosaENCiAgICBAcFZhbHVlICAgICDnlKjmiLfpgInkuK3nmoTlgLzmlbDnu4QNCiAgICAqLw0KICAgICwgb25PS0NsaWNrOiBmdW5jdGlvbiAocFBpY2tlciwgcFZhbHVlKSB7DQogICAgICAgIHZhciBtZSA9IHRoaXMsDQogICAgICAgICAgICBtb250aCA9IHBWYWx1ZVswXSwNCiAgICAgICAgICAgIHllYXIgPSBwVmFsdWVbMV0sDQogICAgICAgICAgICBkYXRlID0gbmV3IERhdGUoeWVhciwgbW9udGgsIDEpOw0KICAgICAgICBtZS5zZXRWYWx1ZShkYXRlKTsNCiAgICAgICAgbWUuaW5uZXJEYXRlVmFsdWUgPSBkYXRlOw0KICAgICAgICBwUGlja2VyLmhpZGUoKTsNCiAgICB9DQogICAgLyoNCiAgICDlt6Xlhbflh73mlbAgLSDnlKjkuo7lpITnkIZQaWNrZXLnmoRDYW5jZWzmjInpkq7ngrnlh7vlkI7nmoTkuovku7YNCiAgICAqLw0KICAgICwgb25DYW5jZWxDbGljazogZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLnBpY2tlci5oaWRlKCk7DQogICAgfQ0KICAgIC8qDQogICAgSklU5qCH5YeG55qE6I635Y+W5YC85pa55rOVDQogICAgKi8NCiAgICAsIGppdEdldFZhbHVlOiBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciB2YWwgPSB0aGlzLmdldFZhbHVlKCk7DQogICAgICAgIGlmICh2YWwgIT0gbnVsbCkgew0KICAgICAgICAgICAgcmV0dXJuIEV4dC5EYXRlLmZvcm1hdCh2YWwsIHRoaXMuZm9ybWF0KTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gIiI7DQogICAgfQ0KICAgIC8qDQogICAgSklU5qCH5YeG55qE6K6+572u5YC85pa55rOVDQogICAgKi8NCiAgICAsIGppdFNldFZhbHVlOiBmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlKSB7DQogICAgICAgICAgICBpZihFeHQuaXNEYXRlKHZhbHVlKSl7DQogICAgICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZSk7DQogICAgICAgICAgICAgICAgdGhpcy5pbm5lckRhdGVWYWx1ZSA9IHZhbHVlOw0KICAgICAgICAgICAgfWVsc2UgaWYoRXh0LmlzU3RyaW5nKHZhbHVlKSl7DQogICAgICAgICAgICAgICAgdmFyIHRlbXAgPSBFeHQuRGF0ZS5wYXJzZSh2YWx1ZSwgdGhpcy5mb3JtYXQpOw0KICAgICAgICAgICAgICAgIGlmICh0ZW1wICE9IG51bGwpew0KICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFZhbHVlKHRlbXApOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLmlubmVyRGF0ZVZhbHVlID0gdGVtcDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZXsNCiAgICAgICAgICAgICAgICAgICAgRXh0LkVycm9yLnJhaXNlKHRoaXMudmFsdWVGb3JtYXRFcnJvck1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgICAgIEV4dC5FcnJvci5yYWlzZSh0aGlzLnZhbHVlRm9ybWF0RXJyb3JNZXNzYWdlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMuc2V0VmFsdWUobnVsbCk7DQogICAgICAgICAgICB0aGlzLmlubmVyRGF0ZVZhbHVlID0gbnVsbDsNCiAgICAgICAgfQ0KICAgIH0NCn0pOw0KRXh0LmRlZmluZSgnSml0LmZvcm0uZmllbGQuTnVtYmVyJywgew0KICAgIGV4dGVuZDogJ0V4dC5mb3JtLmZpZWxkLk51bWJlcicNCiAgICAsIGFsaWFzOiAnd2lkZ2V0LmppdG51bWJlcmZpZWxkJw0KICAgICwgY29uc3RydWN0b3I6IGZ1bmN0aW9uIChjZmcpIHsNCiAgICAgICAgLy/lrprkuYnpu5jorqTphY3nva4NCiAgICAgICAgdmFyIGRlZmF1bHRDb25maWcgPSB7DQogICAgICAgICAgICBsYWJlbFNlcGFyYXRvcjogJycNCiAgICAgICAgICAgICwgbGFiZWxQYWQ6IDEwDQogICAgICAgICAgICAsIGxhYmVsQWxpZ246ICdyaWdodCcNCiAgICAgICAgICAgICwgbWFyZ2luOiAnMCAxMCAxMCAxMCcNCiAgICAgICAgICAgICwgbGFiZWxXaWR0aDogNzMNCiAgICAgICAgICAgICwgaGVpZ2h0OiAyMg0KICAgICAgICAgICAgLCB3aWR0aDoxODMNCiAgICAgICAgICAgICwgYWxsb3dEZWNpbWFsczogZmFsc2UNCiAgICAgICAgICAgICwgZGVjaW1hbFByZWNpc2lvbjogMA0KICAgICAgICAgICAgLCBtYXhWYWx1ZTo5OTk5OTk5OTkNCiAgICAgICAgICAgICwgbWluVmFsdWU6MA0KICAgICAgICB9Ow0KICAgICAgICAvL+WIpOaWreaYr+WQpuWPr+S7pei+k+WFpeWwj+aVsA0KICAgICAgICBpZiAoY2ZnLmFsbG93RGVjaW1hbHMpIHsNCiAgICAgICAgICAgIGRlZmF1bHRDb25maWcuYWxsb3dEZWNpbWFscyA9IGNmZy5hbGxvd0RlY2ltYWxzOw0KICAgICAgICAgICAgaWYgKGNmZy5kZWNpbWFsUHJlY2lzaW9uKSB7DQogICAgICAgICAgICAgICAgZGVmYXVsdENvbmZpZy5kZWNpbWFsUHJlY2lzaW9uID0gY2ZnLmRlY2ltYWxQcmVjaXNpb24NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgZGVmYXVsdENvbmZpZy5kZWNpbWFsUHJlY2lzaW9uID0gMjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy/lkIjlubbphY3nva7pobkNCiAgICAgICAgY2ZnID0gRXh0LmFwcGx5SWYoY2ZnLCBkZWZhdWx0Q29uZmlnKTsNCiAgICAgICAgLy/liJ3lp4vljJbphY3nva7pobkNCiAgICAgICAgdGhpcy5pbml0Q29uZmlnKGNmZyk7DQogICAgICAgIC8v6LCD55So54i257G76L+b6KGM5Yid5aeL5YyWDQogICAgICAgIHRoaXMuY2FsbFBhcmVudChhcmd1bWVudHMpOw0KICAgIH0sDQogICAgaml0R2V0VmFsdWU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWUoKTsNCiAgICB9LA0KICAgIGppdFNldFZhbHVlOiBmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZSk7DQogICAgfQ0KfSk7DQpFeHQuZGVmaW5lKCdKaXQuZm9ybS5maWVsZC5SYWRpbycsIHsNCiAgICBleHRlbmQ6ICdFeHQuZm9ybS5maWVsZC5SYWRpbycsDQogICAgYWxpYXM6IFsnd2lkZ2V0LmppdHJhZGlvZmllbGQnLCAnd2lkZ2V0LmppdHJhZGlvJ10sDQoNCiAgICBjb25zdHJ1Y3RvcjogZnVuY3Rpb24gKGNmZykgew0KICAgICAgICAvL+WumuS5iem7mOiupOmFjee9rg0KICAgICAgICB2YXIgZGVmYXVsdENvbmZpZyA9IHsNCiAgICAgICAgICAgIGxhYmVsU2VwYXJhdG9yOiAnJw0KICAgICAgICAgICAgLCBsYWJlbFBhZDogMTANCiAgICAgICAgICAgICwgbGFiZWxBbGlnbjogJ3JpZ2h0Jw0KICAgICAgICAgICAgLCBtYXJnaW46ICcwIDEwIDEwIDEwJw0KCQkJLCBzdHlsZTogJ2ZvbnQtY29sb3I6IzMzMzMzMztmb250LXNpemU6MTJweCcNCiAgICAgICAgICAgICwgd2lkdGg6IDE4Mw0KICAgICAgICAgICAgLCBsYWJlbFdpZHRoOiA3Mw0KICAgICAgICAgICAgLCBoZWlnaHQ6IDIyICANCiAgICAgICAgfTsNCiAgICANCiAgICAgICAgLy/lkIjlubbphY3nva7pobkNCiAgICAgICAgY2ZnID0gRXh0LmFwcGx5SWYoY2ZnLCBkZWZhdWx0Q29uZmlnKTsNCiAgICAgICAgLy/liJ3lp4vljJbphY3nva7pobkNCiAgICAgICAgdGhpcy5pbml0Q29uZmlnKGNmZyk7DQogICAgICAgIC8v6LCD55So54i257G76L+b6KGM5Yid5aeL5YyWDQogICAgICAgIHRoaXMuY2FsbFBhcmVudChhcmd1bWVudHMpOw0KICAgIH0sDQogICAgaml0R2V0VmFsdWU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWUoKTsNCiAgICB9LA0KICAgIGppdFNldFZhbHVlOiBmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZSk7DQogICAgfQ0KDQp9KTsNCkV4dC5kZWZpbmUoJ0ppdC5mb3JtLmZpZWxkLlNlbGVjdFRleHRCb3gnLCB7DQogICAgZXh0ZW5kOiAnRXh0LnBhbmVsLlBhbmVsJw0KICAgICwgYWxpYXM6ICd3aWRnZXQuSklUU2VsZWN0VGV4dEJveCcNCiAgICAsIGNvbmZpZzogew0KICAgICAgICBmaWVsZExhYmVsOiBudWxsLA0KICAgICAgICBWYWx1ZTogbnVsbCwNCiAgICAgICAgVGV4dDogbnVsbCwNCiAgICAgICAgd2lkdGg6IG51bGwNCiAgICAgICAgLyoNCiAgICAgICAgQHNpemUg5Y+v6YCJ55qE5YC85pyJc21hbGwsYmlnDQogICAgICAgICovDQogICAgICAgICxqaXRTaXplOiAnc21hbGwnDQogICAgfQ0KICAgICwgY29uc3RydWN0b3I6IGZ1bmN0aW9uIChjZmcpIHsNCiAgICAgICAgaWYgKGNmZy5qaXRTaXplID09IG51bGwpDQogICAgICAgICAgICBjZmcuaml0U2l6ZSA9ICdzbWFsbCc7DQogICAgICAgIGlmIChjZmcuaml0U2l6ZSkgew0KICAgICAgICAgICAgdmFyIHNpemUgPSBjZmcuaml0U2l6ZS50b1N0cmluZygpLnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICBzd2l0Y2ggKHNpemUpIHsNCiAgICAgICAgICAgICAgICBjYXNlICdzbWFsbCc6DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNmZy53aWR0aCA9IDE4MzsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlICdiaWcnOg0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBjZmcud2lkdGggPSAyMzM7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgdmFyIGRlZmF1bHRDb25maWcgPSB7DQogICAgICAgICAgICBtYXJnaW46ICcwIDEwIDEwIDEwJywNCiAgICAgICAgICAgIGhlaWdodDogMjIsDQogICAgICAgICAgICBsYXlvdXQ6ICdjb2x1bW4nLA0KICAgICAgICAgICAgYm9yZGVyOiAwDQogICAgICAgIH07DQogICAgICAgIHZhciBtZSA9IHRoaXM7DQogICAgICAgIC8v5re75Yqg6Ieq5a6a5LmJ5LqL5Lu2DQogICAgICAgIHRoaXMuYWRkRXZlbnRzKHsNCiAgICAgICAgICAgICJvblNlbGVjdCI6IHRydWUNCiAgICAgICAgfSk7DQogICAgICAgIC8v6Ieq5bex55qE6YWN572u6aG55aSE55CGDQogICAgICAgIC8v5Yib5bu65paH5pys5qGGDQogICAgICAgIG1lLnNlbGVjdFRleHQgPSBFeHQuY3JlYXRlKCdKaXQuZm9ybS5maWVsZC5UZXh0JywNCiAgICAgICAgew0KICAgICAgICAgICAgZmllbGRMYWJlbDogY2ZnLmZpZWxkTGFiZWwsDQogICAgICAgICAgICBoZWlnaHQ6IDIyLA0KICAgICAgICAgICAgbWFyZ2luOiAnMCAwIDAgMCcNCiAgICAgICAgICAgICAsIGxhYmVsV2lkdGg6IDUzDQogICAgICAgICAsIGxhYmVsUGFkOiAxMA0KICAgICAgICAgLCBsYWJlbEFsaWduOiAnbGVmdCcNCiAgICAgICAgICAgICwgd2lkdGg6IGNmZy53aWR0aCAtIDE3DQogICAgICAgIH0pOw0KICAgICAgICAvL+WIm+W7uuaMiemSrg0KICAgICAgICBtZS5zZWxlY3RCdG4gPSBFeHQuY3JlYXRlKCdKaXQuYnV0dG9uLkJ1dHRvbicsDQogICAgICAgICB7DQogICAgICAgICAgICAgbWFyZ2luOiAnMCAwIDAgMCcNCiAgICAgICAgICAgICAgICAsIGhlaWdodDogMjINCiAgICAgICAgICAgICAgICAsIHdpZHRoOiAxNw0KICAgICAgICAgICAgICAgICwgYm9yZGVyOiAwDQogICAgICAgICAgICAgICAgLCBuYW1lOiAnc2VsZWN0QnRuJw0KICAgICAgICAgICAgICAgICwgY2xzOiAnc2VsZWN0aGlnaGxpZ2h0Jw0KICAgICAgICAgICAgICAgLCBoYW5kbGVyOiBmdW5jdGlvbiAoKSB7IC8v5byV5Y+R6Ieq5a6a5LmJ5LqL5Lu2ICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICBtZS5maXJlRXZlbnQoIm9uU2VsZWN0IiwgbWUpOw0KICAgICAgICAgICAgICAgfQ0KICAgICAgICAgfSk7DQoNCiAgICAgICAgbWUuc2VsZWN0VGV4dC5hZGRMaXN0ZW5lcignZm9jdXMnLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAvL+W8leWPkeiHquWumuS5ieS6i+S7tiAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICBtZS5maXJlRXZlbnQoIm9uU2VsZWN0IiwgbWUpOw0KICAgICAgICB9KTsNCg0KICAgICAgICBkZWZhdWx0Q29uZmlnLml0ZW1zID0gW21lLnNlbGVjdFRleHQsIG1lLnNlbGVjdEJ0bl07DQogICAgICAgIC8v5ZCI5bm26YWN572u6aG5DQogICAgICAgIGNmZyA9IEV4dC5hcHBseUlmKGNmZywgZGVmYXVsdENvbmZpZyk7DQogICAgICAgIC8v5Yid5aeL5YyW6YWN572u6aG5DQogICAgICAgIHRoaXMuaW5pdENvbmZpZyhjZmcpOw0KICAgICAgICAvL+iwg+eUqOeItuexu+i/m+ihjOWIneWni+WMlg0KICAgICAgICB0aGlzLmNhbGxQYXJlbnQoYXJndW1lbnRzKTsNCiAgICB9DQogICAgLCBqaXRTZXRUZXh0OiBmdW5jdGlvbiAodGV4dCkgew0KICAgICAgICB2YXIgbWUgPSB0aGlzOw0KICAgICAgICBtZS5UZXh0ID0gdGV4dDsNCiAgICAgICAgbWUuc2VsZWN0VGV4dC5zZXRWYWx1ZShtZS5UZXh0KTsNCiAgICB9DQogICAgLCBqaXRTZXRWYWx1ZTogZnVuY3Rpb24gKFZhbHVlKSB7DQogICAgICAgIHZhciBtZSA9IHRoaXM7DQogICAgICAgIG1lLlZhbHVlID0gVmFsdWU7DQogICAgfQ0KICAgICwgaml0R2V0VGV4dDogZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgbWUgPSB0aGlzOw0KICAgICAgICByZXR1cm4gbWUuVGV4dDsNCiAgICB9DQogICAgLCBqaXRHZXRWYWx1ZTogZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgbWUgPSB0aGlzOw0KICAgICAgICByZXR1cm4gbWUuVmFsdWU7DQogICAgfQ0KDQp9DQopOw0KDQoNCg0KRXh0LmRlZmluZSgnSml0LmZvcm0uZmllbGQuVGV4dCcsIHsNCiAgICBleHRlbmQ6ICdFeHQuZm9ybS5maWVsZC5UZXh0Jw0KICAgICwgYWxpYXM6ICd3aWRnZXQuaml0dGV4dGZpZWxkJw0KICAgICwgY29uZmlnOiB7DQogICAgICAgIC8qDQogICAgICAgIEBzaXplIOWPr+mAieeahOWAvOaciXNtYWxsLGJpZw0KICAgICAgICAqLw0KICAgICAgICBqaXRTaXplOiBudWxsDQogICAgfQ0KICAgICwgY29uc3RydWN0b3I6IGZ1bmN0aW9uIChjZmcpIHsNCiAgICAgICAgLy/lrprkuYnpu5jorqTphY3nva4NCiAgICAgICAgdmFyIGRlZmF1bHRDb25maWcgPSB7DQogICAgICAgICAgICBsYWJlbFNlcGFyYXRvcjogJycNCiAgICAgICAgICAgICwgbGFiZWxQYWQ6IDEwDQogICAgICAgICAgICAsIGxhYmVsQWxpZ246ICdyaWdodCcNCiAgICAgICAgICAgICwgbWFyZ2luOiAnMCAxMCAxMCAxMCcNCiAgICAgICAgICAgICwgbGFiZWxXaWR0aDogNzMNCiAgICAgICAgICAgICwgaGVpZ2h0OiAyMg0KICAgICAgICB9Ow0KICAgICAgICAvL+iHquW3seeahOmFjee9rumhueWkhOeQhg0KICAgICAgICB2YXIgY2ZnID0gRXh0LmFwcGx5SWYoY2ZnLCB7DQogICAgICAgICAgICBqaXRTaXplOiAnc21hbGwnDQogICAgICAgIH0pOw0KICAgICAgICBpZiAoY2ZnLmppdFNpemUpIHsNCiAgICAgICAgICAgIHZhciBzaXplID0gY2ZnLmppdFNpemUudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpOw0KICAgICAgICAgICAgc3dpdGNoIChzaXplKSB7DQogICAgICAgICAgICAgICAgY2FzZSAnc21hbGwnOg0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0Q29uZmlnLndpZHRoID0gMTgzOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgJ2JpZyc6DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRDb25maWcud2lkdGggPSAyMzM7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICBqaXRHZXRWYWx1ZToNCiAgICAgICAgLy/lkIjlubbphY3nva7pobkNCiAgICAgICAgY2ZnID0gRXh0LmFwcGx5SWYoY2ZnLCBkZWZhdWx0Q29uZmlnKTsNCiAgICAgICAgLy/liJ3lp4vljJbphY3nva7pobkNCiAgICAgICAgdGhpcy5pbml0Q29uZmlnKGNmZyk7DQogICAgICAgIC8v6LCD55So54i257G76L+b6KGM5Yid5aeL5YyWDQogICAgICAgIHRoaXMuY2FsbFBhcmVudChhcmd1bWVudHMpOw0KICAgIH0sDQogICAgaml0R2V0VmFsdWU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWUoKTsNCiAgICB9LA0KICAgIGppdFNldFZhbHVlOiBmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZSk7DQogICAgfQ0KfSk7DQpFeHQuZGVmaW5lKCdKaXQuZm9ybS5maWVsZC5UZXh0QXJlYScsIHsNCiAgICBleHRlbmQ6ICdFeHQuZm9ybS5maWVsZC5UZXh0QXJlYScNCiAgICAsIGFsaWFzOiAnd2lkZ2V0LmppdHRleHRhcmVhJw0KICAgICwgY29uc3RydWN0b3I6IGZ1bmN0aW9uIChjZmcpIHsNCiAgICAgICAgLy/lrprkuYnpu5jorqTphY3nva4NCiAgICAgICAgdmFyIGRlZmF1bHRDb25maWcgPSB7DQogICAgICAgICAgICBsYWJlbFNlcGFyYXRvcjogJycNCiAgICAgICAgICAgICwgbGFiZWxQYWQ6IDEwDQogICAgICAgICAgICAsIGxhYmVsQWxpZ246ICdyaWdodCcNCiAgICAgICAgICAgICwgbWFyZ2luOiAnMTAnDQogICAgICAgICAgICAsIHdpZHRoOiA0ODINCiAgICAgICAgICAgICwgbGFiZWxXaWR0aDogNzINCiAgICAgICAgICAgICwgaGVpZ2h0OiA4NCAgICAgICAgICAgDQogICAgICAgICAgICAsIGdyb3c6IHRydWUNCiAgICAgICAgICAgICwgbWF0Y2hGaWVsZFdpZHRoOiBmYWxzZQ0KICAgICAgICAgICAgLCBjb21wb25lbnRDbHM6ICdUZXh0QXJlYScNCiAgICAgICAgfTsNCiAgICAgICAgLy/lkIjlubbphY3nva7pobkNCiAgICAgICAgY2ZnID0gRXh0LmFwcGx5SWYoY2ZnLCBkZWZhdWx0Q29uZmlnKTsNCiAgICAgICAgLy/liJ3lp4vljJbphY3nva7pobkNCiAgICAgICAgdGhpcy5pbml0Q29uZmlnKGNmZyk7DQogICAgICAgIC8v6LCD55So54i257G76L+b6KGM5Yid5aeL5YyWDQogICAgICAgIHRoaXMuY2FsbFBhcmVudChhcmd1bWVudHMpOw0KICAgIH0sDQogICAgaml0R2V0VmFsdWU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWUoKTsNCiAgICB9LA0KICAgIGppdFNldFZhbHVlOiBmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZSk7DQogICAgfQ0KfSk7DQpFeHQuZGVmaW5lKCdKaXQuZm9ybS5maWVsZC5UaW1lJywgew0KICAgIGV4dGVuZDogJ0V4dC5mb3JtLmZpZWxkLlRpbWUnDQogICAgLCBhbGlhczogJ3dpZGdldC5qaXR0aW1lZmllbGQnDQogICAgLCBjb25zdHJ1Y3RvcjogZnVuY3Rpb24gKGNmZykgew0KICAgICAgICAvL+WumuS5iem7mOiupOmFjee9rg0KICAgICAgICB2YXIgZGVmYXVsdENvbmZpZyA9IHsNCiAgICAgICAgICAgIGxhYmVsU2VwYXJhdG9yOiAnJw0KICAgICAgICAgICAgLCBsYWJlbFBhZDogMTANCiAgICAgICAgICAgICwgbGFiZWxBbGlnbjogJ3JpZ2h0Jw0KICAgICAgICAgICAgLCBtYXJnaW46ICcwIDEwIDEwIDEwJw0KICAgICAgICAgICAgLCBsYWJlbFdpZHRoOiA3Mw0KICAgICAgICAgICAgLCBoZWlnaHQ6IDIyDQogICAgICAgICAgICAsIHdpZHRoOiAxODMNCiAgICAgICAgICAgICwgZWRpdGFibGU6IGZhbHNlICAgICAgICAgICAgDQogICAgICAgIH0gICAgICANCiAgICAgICAgLy/lkIjlubbphY3nva7pobkNCiAgICAgICAgY2ZnID0gRXh0LmFwcGx5SWYoY2ZnLCBkZWZhdWx0Q29uZmlnKTsNCiAgICAgICAgLy/liJ3lp4vljJbphY3nva7pobkNCiAgICAgICAgdGhpcy5pbml0Q29uZmlnKGNmZyk7DQogICAgICAgIC8v6LCD55So54i257G76L+b6KGM5Yid5aeL5YyWDQogICAgICAgIHRoaXMuY2FsbFBhcmVudChhcmd1bWVudHMpOw0KICAgIH0sDQogICAgaml0R2V0VmFsdWU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWUoKTsNCiAgICB9LA0KICAgIGppdFNldFZhbHVlOiBmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZSk7DQogICAgfQ0KfSk7DQpFeHQuZGVmaW5lKCdKaXQuZ3JpZC5jb2x1bW4uQ29sdW1uJywgew0KICAgIGV4dGVuZDogJ0V4dC5ncmlkLmNvbHVtbi5Db2x1bW4nDQogICAgLCBhbGlhczogJ3dpZGdldC5qaXRjb2x1bW4nDQogICAgLCBjb25maWc6IHsNCiAgICAgICAgLypAaml0RGF0YVR5cGUgaml055qE5pWw5o2u57G75Z6LKi8NCiAgICAgICAgaml0RGF0YVR5cGU6IG51bGwNCiAgICAgICAgLypAaml0VGltZXNwYW5Gb3JtYXR0ZXIg5pe26Ze055qE5qC85byP5YyWKi8NCiAgICAgICAgLCBqaXRUaW1lc3BhbkZvcm1hdHRlcjogbnVsbA0KICAgIH0NCiAgICAsIHN0YXRpY3M6IHsNCiAgICAgICAgLypAaml0WWVzVGV4dCDlvZNqaXREYXRhVHlwZT1Cb29sZWFu5pe277yM5YC85Li6dHJ1ZeeahOaWh+acrCovDQogICAgICAgIGppdFllc1RleHQ6ICfmmK8nDQogICAgICAgIC8qQGppdE5vVGV4dCDlvZNqaXREYXRhVHlwZT1Cb29sZWFu5pe277yM5YC85Li6ZmFsc2XnmoTmlofmnKwqLw0KICAgICAgICAsIGppdE5vVGV4dDogJ+WQpicNCiAgICAgICAgLypAaml0VGltZXNwYW5Gb3JtYXR0ZXIg5pe26Ze06Leo5bqm55qE5qC85byP5a2X56ym5LiyKi8NCiAgICAgICAgLCBqaXRUaW1lc3BhbkZvcm1hdHRlcjogew0KICAgICAgICAgICAgZGF5VGV4dDogJ+WkqScNCiAgICAgICAgICAgICwgaG91clRleHQ6ICflsI/ml7YnDQogICAgICAgICAgICAsIG1pbnV0ZVRleHQ6ICfliIYnDQogICAgICAgICAgICAsIHNlY29uZFRleHQ6ICfnp5InDQogICAgICAgIH0NCiAgICB9DQogICAgLypAY29uc3RydWN0b3Ig5p6E6YCg5Ye95pWwKi8NCiAgICAsIGNvbnN0cnVjdG9yOiBmdW5jdGlvbiAoY2ZnKSB7DQogICAgICAgIC8v5a6a5LmJ6buY6K6k6YWN572uDQogICAgICAgIHZhciBkZWZhdWx0Q29uZmlnID0gew0KICAgICAgICAgICAgaml0RGF0YVR5cGU6ICdpbnQnDQogICAgICAgICAgICAsIHNvcnRhYmxlOiB0cnVlDQogICAgICAgICAgICAsIGhpZGVhYmxlOiBmYWxzZQ0KICAgICAgICB9Ow0KICAgICAgICAvL+WkhOeQhumFjee9rumhuSAgICAgIA0KICAgICAgICB2YXIgY2ZnID0gRXh0LmFwcGx5SWYoY2ZnLCBkZWZhdWx0Q29uZmlnKTsNCiAgICAgICAgdmFyIGRhdGFUeXBlID0gY2ZnLmppdERhdGFUeXBlLnRvTG93ZXJDYXNlKCk7DQogICAgICAgIHN3aXRjaCAoZGF0YVR5cGUpIHsNCiAgICAgICAgICAgIGNhc2UgJ2ludCc6IC8vIOaVtOaVsO+8jOaVsOWAvOmdoOWPs+Wvuem9kA0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgY2ZnLmFsaWduID0gJ3JpZ2h0JzsNCiAgICAgICAgICAgICAgICAgICAgY2ZnLnJlbmRlcmVyID0gdGhpcy5yZW5kZXJJbnQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnZGVjaW1hbCc6IC8v5a6a54K55bCP5pWw77yM5pWw5YC86Z2g5Y+z5a+56b2Q77yM5bCP5pWw54K55ZCO5Y+q5L+d55WZ5Lik5L2NDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjZmcuYWxpZ24gPSAncmlnaHQnOw0KICAgICAgICAgICAgICAgICAgICBjZmcucmVuZGVyZXIgPSB0aGlzLnJlbmRlckRlY2ltYWw7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnYm9vbGVhbic6IC8v5biD5bCU77yM5aaC5p6c5pivdHJ1ZeWImeS4uuaYr++8jOS4umZhbHNl5YiZ5Li65ZCm77yM5ZCm5YiZ5Li656m644CCDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjZmcuYWxpZ24gPSAnY2VudGVyJzsNCiAgICAgICAgICAgICAgICAgICAgY2ZnLnJlbmRlcmVyID0gdGhpcy5yZW5kZXJCb29sZWFuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6IC8v5a2X56ym5Liy77yM5paH5pys6Z2g5bem5a+56b2Q44CCDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjZmcuYWxpZ24gPSAnbGVmdCc7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnZGF0ZSc6IC8v5pel5pyf77yM5pWw5o2u57G75Z6L5Li6RGF0ZeOAguagvOW8j+WMluS4unl5eXktTU0tZGTvvIzljbM05L2N5bm0KzLkvY3mnIgrMuS9jeaXpQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgY2ZnLmFsaWduID0gJ3JpZ2h0JzsNCiAgICAgICAgICAgICAgICAgICAgY2ZnLnJlbmRlcmVyID0gdGhpcy5yZW5kZXJEYXRlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ2RhdGV0aW1lJzogLy/ml6XmnJ/ml7bpl7TvvIzmlbDmja7nsbvlnovkuLpEYXRl44CC5qC85byP5YyW5Li6IHl5eXktTU0tZGQgSEg6bWk6c3PvvIzljbM05L2N5bm0KzLkvY3mnIgrMuS9jeaXpSsy5L2NMjTlsI/ml7bliLbnmoTlsI/ml7YrMuS9jeWIhisy5L2N56eS44CCDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjZmcuYWxpZ24gPSAncmlnaHQnOw0KICAgICAgICAgICAgICAgICAgICBjZmcucmVuZGVyZXIgPSB0aGlzLnJlbmRlckRhdGVUaW1lOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ21vbnRoZGF5aG91cm1pbnV0ZSc6DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjZmcuYWxpZ24gPSAncmlnaHQnOw0KICAgICAgICAgICAgICAgICAgICBjZmcucmVuZGVyZXIgPSB0aGlzLnJlbmRlck1vbnRoRGF5SG91ck1pbnV0ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICd0aW1lJzogLy/ml7bpl7TvvIzmlbDmja7nsbvlnovkuLpEYXRl44CC5qC85byP5YyW5Li6SEg6bWk6c3PvvIzljbMy5L2NMjTlsI/ml7bliLbnmoTlsI/ml7YrMuS9jeWIhisy5L2N56eS44CCDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjZmcuYWxpZ24gPSAnbGVmdCc7DQogICAgICAgICAgICAgICAgICAgIGNmZy5yZW5kZXJlciA9IHRoaXMucmVuZGVyVGltZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICd0aW1lc3Bhbic6DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAvKiDml7bpl7Tot6jluqbvvIzmlbDmja7kuLppbnTvvIzlgLzkuLrml7bpl7Tot6jluqbnmoTnp5LmlbDjgILmjIkgeHh45aSpeHh45bCP5pe2eHh45YiGeHh456eS55qE5pa55byP5qC85byP5YyW77yM5pyA5ZCO5Y+q5L+d55WZMuiKguOAgg0KICAgICAgICAgICAgICAgICAgICDkvovlpoINCiAgICAgICAgICAgICAgICAgICAg74O8CTHlpKkxNOWwj+aXtg0KICAgICAgICAgICAgICAgICAgICDvg7wJMeWwj+aXtjE05YiGDQogICAgICAgICAgICAgICAgICAgIO+DvAk1OOWIhjM456eSDQogICAgICAgICAgICAgICAgICAgIO+DvAk0NOenkg0KICAgICAgICAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgICAgICAgICBjZmcuYWxpZ24gPSAnbGVmdCc7DQogICAgICAgICAgICAgICAgICAgIGNmZy5yZW5kZXJlciA9IHRoaXMucmVuZGVyVGltZXNwYW47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAnY29vcmRpbmF0ZSc6IC8v5Zyw5Zu+5YiXDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBjZmcuYWxpZ24gPSAnY2VudGVyJzsNCiAgICAgICAgICAgICAgICAgICAgdmFyIG1lID0gdGhpczsNCiAgICAgICAgICAgICAgICAgICAgY2ZnLnJlbmRlcmVyID0gZnVuY3Rpb24gKHZhbCwgbWV0YURhdGEsIHJlY29yZCwgcm93SW5kZXgsIGNvbEluZGV4LCBzdG9yZSwgdmlldykgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lLnJlbmRlckNvb3JkaW5hdGUodmFsLCBtZXRhRGF0YSwgcmVjb3JkLCByb3dJbmRleCwgY29sSW5kZXgsIHN0b3JlLCB2aWV3LCBjZmcuZ2V0TWFwVGl0bGUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAncGhvdG8nOiAvL+WbvueJh+WIlw0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgY2ZnLmFsaWduID0gJ2NlbnRlcic7DQogICAgICAgICAgICAgICAgICAgIGNmZy5yZW5kZXJlciA9IHRoaXMucmVuZGVyUGhvdG87DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgIEV4dC5FcnJvci5yYWlzZSgi5peg5pWI55qEaml0RGF0YVR5cGXnmoTlgLw6IiArIGRhdGFUeXBlICsgJy4nKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgICAgICAvL+WIneWni+WMlumFjee9rumhuQ0KICAgICAgICB0aGlzLmluaXRDb25maWcoY2ZnKTsNCiAgICAgICAgLy/osIPnlKjniLbnsbvov5vooYzliJ3lp4vljJYNCiAgICAgICAgdGhpcy5jYWxsUGFyZW50KGFyZ3VtZW50cyk7DQogICAgfQ0KICAgIC8qDQogICAg5ZGI546w5pW05pWwDQogICAgKi8NCiAgICAsIHJlbmRlckludDogZnVuY3Rpb24gKHZhbCwgbWV0YURhdGEsIHJlY29yZCwgcm93SW5kZXgsIGNvbEluZGV4LCBzdG9yZSwgdmlldykgew0KICAgICAgICBpZiAodmFsID09IG51bGwgfHwgdmFsID09ICIiKSB7DQogICAgICAgICAgICByZXR1cm4gIjAiOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgdmFyIGEgPSB2YWwudG9TdHJpbmcoKTsNCiAgICAgICAgICAgIHZhciBmdWhhbyA9IGEuaW5kZXhPZigiLSIpDQogICAgICAgICAgICBpZiAoZnVoYW8gPiAtMSkgew0KICAgICAgICAgICAgICAgIGEgPSBhLnN1YnN0cmluZygxKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciBiID0gIiI7DQogICAgICAgICAgICBpZiAoYS5sZW5ndGggPiAzKSB7DQogICAgICAgICAgICAgICAgdmFyIHN1bSA9IGEubGVuZ3RoOw0KICAgICAgICAgICAgICAgIHZhciBjID0gYS5zdWJzdHJpbmcoc3VtKTsNCiAgICAgICAgICAgICAgICB2YXIgayA9IHN1bSAlIDM7DQogICAgICAgICAgICAgICAgdmFyIGogPSBwYXJzZUludChzdW0gLyAzKTsNCiAgICAgICAgICAgICAgICBiID0gYiArIGEuc3Vic3RyaW5nKDAsIGspOw0KICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgajsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBvbmUgPSAoayArIDMgKiBpKTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHR3byA9IGsgKyAzICogKGkgKyAxKTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSAiLCI7DQoNCiAgICAgICAgICAgICAgICAgICAgYiA9IGIgKyBkICsgYS5zdWJzdHJpbmcob25lLCB0d28pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBiID0gYiArIGM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsgYiA9IGE7IH0NCiAgICAgICAgICAgIGlmIChrID09IDApIHsNCiAgICAgICAgICAgICAgICBiID0gYi5zdWJzdHJpbmcoMSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZnVoYW8gPiAtMSkgew0KICAgICAgICAgICAgICAgIGIgPSAiLSIgKyBiOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGI7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoNCiAgICDlkYjnjrDlrprngrnlsI/mlbANCiAgICAqLw0KICAgICwgcmVuZGVyRGVjaW1hbDogZnVuY3Rpb24gKHZhbCwgbWV0YURhdGEsIHJlY29yZCwgcm93SW5kZXgsIGNvbEluZGV4LCBzdG9yZSwgdmlldykgew0KICAgICAgICBpZiAodmFsID09IG51bGwgfHwgdmFsID09ICIiKSB7DQogICAgICAgICAgICByZXR1cm4gIjAuMDAiOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgdmFyIGEgPSBwYXJzZUZsb2F0KHZhbCkudG9GaXhlZCgyKS50b1N0cmluZygpOw0KICAgICAgICAgICAgdmFyIGZ1aGFvID0gYS5pbmRleE9mKCItIikNCiAgICAgICAgICAgIGlmIChmdWhhbyA+IC0xKSB7DQogICAgICAgICAgICAgICAgYSA9IGEuc3Vic3RyaW5nKDEpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFyIGIgPSAiIjsNCiAgICAgICAgICAgIGlmIChhLmxlbmd0aCA+IDMpIHsNCiAgICAgICAgICAgICAgICB2YXIgc3VtID0gYS5sYXN0SW5kZXhPZignLicpOw0KICAgICAgICAgICAgICAgIGlmIChzdW0gPCAxKSB7DQogICAgICAgICAgICAgICAgICAgIHN1bSA9IGEubGVuZ3RoOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB2YXIgYyA9IGEuc3Vic3RyaW5nKHN1bSk7DQogICAgICAgICAgICAgICAgdmFyIGsgPSBzdW0gJSAzOw0KICAgICAgICAgICAgICAgIHZhciBqID0gcGFyc2VJbnQoc3VtIC8gMyk7DQogICAgICAgICAgICAgICAgYiA9IGIgKyBhLnN1YnN0cmluZygwLCBrKTsNCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGo7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICB2YXIgb25lID0gKGsgKyAzICogaSk7DQogICAgICAgICAgICAgICAgICAgIHZhciB0d28gPSBrICsgMyAqIChpICsgMSk7DQogICAgICAgICAgICAgICAgICAgIHZhciBkID0gIiwiOw0KICAgICAgICAgICAgICAgICAgICBiID0gYiArIGQgKyBhLnN1YnN0cmluZyhvbmUsIHR3byk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGIgPSBiICsgYzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgeyBiID0gYTsgfQ0KICAgICAgICAgICAgaWYgKGsgPT0gMCkgew0KICAgICAgICAgICAgICAgIGIgPSBiLnN1YnN0cmluZygxKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChmdWhhbyA+IC0xKSB7DQogICAgICAgICAgICAgICAgYiA9ICItIiArIGI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gYjsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKg0KICAgIOWRiOeOsOW4g+WwlOWAvA0KICAgICovDQogICAgLCByZW5kZXJCb29sZWFuOiBmdW5jdGlvbiAodmFsLCBtZXRhRGF0YSwgcmVjb3JkLCByb3dJbmRleCwgY29sSW5kZXgsIHN0b3JlLCB2aWV3KSB7DQogICAgICAgIGlmICh2YWwgPT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVybiAnJzsNCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBpZiAodmFsKQ0KICAgICAgICAgICAgICAgIHJldHVybiBKaXQuZ3JpZC5jb2x1bW4uQ29sdW1uLmppdFllc1RleHQ7DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgcmV0dXJuIEppdC5ncmlkLmNvbHVtbi5Db2x1bW4uaml0Tm9UZXh0Ow0KICAgICAgICB9DQogICAgfQ0KICAgIC8qDQogICAg5ZGI546w5pel5pyfDQogICAgKi8NCiAgICAsIHJlbmRlckRhdGU6IGZ1bmN0aW9uICh2YWwsIG1ldGFEYXRhLCByZWNvcmQsIHJvd0luZGV4LCBjb2xJbmRleCwgc3RvcmUsIHZpZXcpIHsNCiAgICAgICAgaWYgKHZhbCA9PSBudWxsKQ0KICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGlmICh0eXBlb2YgKHZhbCkgIT0gJ29iamVjdCcgJiYgdmFsLmNvbnN0cnVjdG9yICE9IERhdGUpIHsNCiAgICAgICAgICAgICAgICB2YWwgPSBFeHQuRGF0ZS5wYXJzZSh2YWwsICdjJyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gRXh0LkRhdGUuZm9ybWF0KHZhbCwgJ1ktbS1kJyk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoNCiAgICDlkYjnjrDml6XmnJ/ml7bpl7QNCiAgICAqLw0KICAgICwgcmVuZGVyRGF0ZVRpbWU6IGZ1bmN0aW9uICh2YWwsIG1ldGFEYXRhLCByZWNvcmQsIHJvd0luZGV4LCBjb2xJbmRleCwgc3RvcmUsIHZpZXcpIHsNCiAgICAgICAgaWYgKHZhbCA9PSBudWxsKQ0KICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGlmICh0eXBlb2YgKHZhbCkgIT0gJ29iamVjdCcgJiYgdmFsLmNvbnN0cnVjdG9yICE9IERhdGUpIHsNCiAgICAgICAgICAgICAgICB2YWwgPSBFeHQuRGF0ZS5wYXJzZSh2YWwsICdjJyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gRXh0LkRhdGUuZm9ybWF0KHZhbCwgJ1ktbS1kIEg6aTpzJyk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoNCiAgICDlkYjnjrDmnIjml6Xml7bliIYgMDYtMDQgMTjvvJowOCANCiAgICAqLw0KICAgICwgcmVuZGVyTW9udGhEYXlIb3VyTWludXRlOiBmdW5jdGlvbiAodmFsLCBtZXRhRGF0YSwgcmVjb3JkLCByb3dJbmRleCwgY29sSW5kZXgsIHN0b3JlLCB2aWV3KSB7DQogICAgICAgIGlmICh2YWwgPT0gbnVsbCkNCiAgICAgICAgICAgIHJldHVybiAnJzsNCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICBpZiAodHlwZW9mICh2YWwpICE9ICdvYmplY3QnICYmIHZhbC5jb25zdHJ1Y3RvciAhPSBEYXRlKSB7DQogICAgICAgICAgICAgICAgdmFsID0gRXh0LkRhdGUucGFyc2UodmFsLCAnYycpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIEV4dC5EYXRlLmZvcm1hdCh2YWwsICdtLWQgSDppJyk7DQogICAgICAgIH0NCiAgICB9DQogICAgLyoNCiAgICDlkYjnjrDml7bpl7QNCiAgICAqLw0KICAgICwgcmVuZGVyVGltZTogZnVuY3Rpb24gKHZhbCwgbWV0YURhdGEsIHJlY29yZCwgcm93SW5kZXgsIGNvbEluZGV4LCBzdG9yZSwgdmlldykgew0KICAgICAgICBpZiAodmFsID09IG51bGwpDQogICAgICAgICAgICByZXR1cm4gJyc7DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgaWYgKHR5cGVvZiAodmFsKSAhPSAnb2JqZWN0JyAmJiB2YWwuY29uc3RydWN0b3IgIT0gRGF0ZSkgew0KICAgICAgICAgICAgICAgIHZhbCA9IEV4dC5EYXRlLnBhcnNlKHZhbCwgJ2MnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBFeHQuRGF0ZS5mb3JtYXQodmFsLCAnSDppOnMnKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICAvKg0KICAgIOWRiOeOsOaXtumXtOi3qOW6pg0KICAgICovDQogICAgLCByZW5kZXJUaW1lc3BhbjogZnVuY3Rpb24gKHZhbCwgbWV0YURhdGEsIHJlY29yZCwgcm93SW5kZXgsIGNvbEluZGV4LCBzdG9yZSwgdmlldykgew0KICAgICAgICBpZiAodmFsID09IG51bGwpDQogICAgICAgICAgICByZXR1cm4gJyc7DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgaWYgKHZhbCA+IDM2MDApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQodmFsIC8gMzYwMCkgKyBKaXQuZ3JpZC5jb2x1bW4uQ29sdW1uLmppdFRpbWVzcGFuRm9ybWF0dGVyLmhvdXJUZXh0ICsgcGFyc2VJbnQoKHZhbCAtIHBhcnNlSW50KHZhbCAvIDM2MDApICogMzYwMCkgLyA2MCkgKyBKaXQuZ3JpZC5jb2x1bW4uQ29sdW1uLmppdFRpbWVzcGFuRm9ybWF0dGVyLm1pbnV0ZVRleHQgKyAodmFsIC0gcGFyc2VJbnQodmFsIC8gNjApICogNjApICsgSml0LmdyaWQuY29sdW1uLkNvbHVtbi5qaXRUaW1lc3BhbkZvcm1hdHRlci5zZWNvbmRUZXh0Ow0KICAgICAgICAgICAgfSBlbHNlIGlmICh2YWwgPiA2MCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUludCh2YWwgLyA2MCkgKyBKaXQuZ3JpZC5jb2x1bW4uQ29sdW1uLmppdFRpbWVzcGFuRm9ybWF0dGVyLm1pbnV0ZVRleHQgKyAodmFsIC0gcGFyc2VJbnQodmFsIC8gNjApICogNjApICsgSml0LmdyaWQuY29sdW1uLkNvbHVtbi5qaXRUaW1lc3BhbkZvcm1hdHRlci5zZWNvbmRUZXh0Ow0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdmFsICsgSml0LmdyaWQuY29sdW1uLkNvbHVtbi5qaXRUaW1lc3BhbkZvcm1hdHRlci5zZWNvbmRUZXh0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIC8qDQogICAg5ZGI546w5Zyw5Zu+DQogICAgKi8NCiAgICwgcmVuZGVyQ29vcmRpbmF0ZTogZnVuY3Rpb24gKHZhbCwgbWV0YURhdGEsIHJlY29yZCwgcm93SW5kZXgsIGNvbEluZGV4LCBzdG9yZSwgdmlldywgZ2V0TWFwVGl0bGUpIHsNCiAgICAgICBpZiAodmFsICE9IG51bGwgJiYgdmFsICE9ICIiKSB7DQogICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICB2YXIgdGl0bGUgPSBudWxsOw0KICAgICAgICAgICAgICAgaWYgKGdldE1hcFRpdGxlICYmIEV4dC5pc0Z1bmN0aW9uKGdldE1hcFRpdGxlKSkgew0KICAgICAgICAgICAgICAgICAgIHRpdGxlID0gZ2V0TWFwVGl0bGUodmFsLCByZWNvcmQpOw0KICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgdmFyIFZhbHVlcyA9IHZhbC5zcGxpdCgiLCIpOw0KICAgICAgICAgICAgICAgdmFyIExuZyA9IDA7DQogICAgICAgICAgICAgICB2YXIgTGF0ID0gMDsNCiAgICAgICAgICAgICAgIHZhciBpbkdQU1R5cGUgPSAwOw0KICAgICAgICAgICAgICAgaWYgKFZhbHVlcy5sZW5ndGggPiAxKSB7DQogICAgICAgICAgICAgICAgICAgTG5nID0gVmFsdWVzWzBdOw0KICAgICAgICAgICAgICAgICAgIExhdCA9IFZhbHVlc1sxXTsNCiAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgIGlmIChWYWx1ZXMubGVuZ3RoID09IDMpIHsNCiAgICAgICAgICAgICAgICAgICBpbkdQU1R5cGUgPSBWYWx1ZXNbMl07DQogICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAvLyAgdmFyIElkID0gdGhpcy5jb2x1bW5zW2NvbEluZGV4XS5nZXRJZCgpOw0KICAgICAgICAgICAgICAgLy9FeHQuZ2V0Q21wKFwiIiArIElkICsgIlwiKS5tYXBTaG93KCIgKyBMbmcgKyAiLCIgKyBMYXQgKyAiLCIgKyBpbkdQU1R5cGUgKyAiLFwiIiArIHRpdGxlICsgIlwiKQ0KICAgICAgICAgICAgICAgcmV0dXJuICI8aW1nIHNyYz0nL0xpYi9JbWFnZS9pY29uX3dvcmxkLmdpZicgc3R5bGU9J2N1cnNvcjpwb2ludGVyJyBvbmNsaWNrPSdfX19mbk1hcFNob3coIiArIExuZyArICIsIiArIExhdCArICIsIiArIGluR1BTVHlwZSArICIsXCIiICsgdGl0bGUgKyAiXCIpJyAvPiAiOw0KICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICByZXR1cm4gIjxpbWcgc3JjPScvTGliL0ltYWdlL2ljb25fbm93b3JsZC5qcGcnIC8+ICI7DQogICAgICAgICAgIH0NCiAgICAgICB9DQogICAgICAgcmV0dXJuICI8aW1nIHNyYz0nL0xpYi9JbWFnZS9pY29uX25vd29ybGQuanBnJyAvPiAiOw0KICAgfQ0KICAgIC8qDQogICAg5ZGI546w54Wn54mHDQogICAgKi8NCiAgICAsIHJlbmRlclBob3RvOiBmdW5jdGlvbiAodmFsLCBtZXRhRGF0YSwgcmVjb3JkLCByb3dJbmRleCwgY29sSW5kZXgsIHN0b3JlLCB2aWV3KSB7DQogICAgICAgIHZhciBwaG90b1ZhbHVlID0gIiI7DQogICAgICAgIHZhciBwQ2xpZW50VXNlcklEPTA7DQogICAgICAgIGlmICh2YWwgIT0gbnVsbCAmJiB2YWwgIT0gIiIpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgaWYgKHZhbCAhPSBudWxsICYmIHZhbCAhPSAiIikgew0KICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBldmFsKHZhbCk7DQogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPSBudWxsICYmIHZhbHVlLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBob3RvVmFsdWUgPSB2YWx1ZVswXS5GaWxlTmFtZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBDbGllbnRVc2VySUQ9dmFsdWVbMF0uQ2xpZW50VXNlcklEOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiAiPGltZyBzcmM9Jy9MaWIvSW1hZ2UvaW1hZ2UucG5nJyBzdHlsZT0nY3Vyc29yOnBvaW50ZXInIG9uY2xpY2s9J19fX2ZuUGhvdG9TaG93KFwiIiArIHBob3RvVmFsdWUgKyAiXCIsIitwQ2xpZW50VXNlcklEKyIpJyAvPiAiOw0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiAiPGltZyBzcmM9Jy9MaWIvSW1hZ2Uvbm9pbWFnZS5wbmcnIC8+ICI7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICI8aW1nIHNyYz0nL0xpYi9JbWFnZS9ub2ltYWdlLnBuZycgLz4gIjsNCiAgICB9DQp9KTsNCg0KDQpfX19mbk1hcFNob3cgPSBmdW5jdGlvbiAocExuZywgcExhdCwgcEEsIHBUaXRsZSkgew0KICAgIGlmIChwVGl0bGUgPT0gbnVsbCB8fCBwVGl0bGUgPT0gIiIgfHwgcFRpdGxlID09ICJudWxsIikgew0KICAgICAgICBwVGl0bGUgPSAiTWFwIjsNCiAgICB9DQogICAgRXh0LmNyZWF0ZSgnSml0LndpbmRvdy5NYXBXaW5kb3cnLCB7DQogICAgICAgIGlkOiAnX19jb2x1bW5NYXBJRCcsDQogICAgICAgIHRpdGxlOiBwVGl0bGUsDQogICAgICAgIGppdFBvaW50OiB7DQogICAgICAgICAgICBwb2ludElEOiAnMCcsICAgICAgICAgICAgLy/mlbTmlbDvvIzllK/kuIDmoIfor4bvvIzlv4XpobsNCiAgICAgICAgICAgIGxuZzogcExuZywgICAgICAgICAgICAgICAvLyDmta7ngrnmlbDvvIzllYblupdHUFPlnZDmoIfnmoTnu4/luqbvvIzlv4XpobvvvIzojIPlm7QwLTE4MC4NCiAgICAgICAgICAgIGxhdDogcExhdCwgICAgICAgICAgICAgICAvLyDmta7ngrnmlbDvvIzllYblupdHUFPlnZDmoIfnmoTnuqzluqbvvIzlv4XpobvvvIzojIPlm7QwLTkwICAgICAgICAgICAgIA0KICAgICAgICAgICAgaXNFZGl0YWJsZTogZmFsc2UsICAgICAgIC8vIOaYr+WQpuWPr+e8lui+kSAgICAgIA0KICAgICAgICAgICAgaW5HUFNUeXBlOiBwQSwNCiAgICAgICAgICAgIG1hcFNjYWxlOiAxNSAgICAgICAgICAgLy/lnLDlm77nuqfliKsNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIEV4dC5nZXRDbXAoIl9fY29sdW1uTWFwSUQiKS5zaG93KCk7DQp9DQoNCi8q54Wn54mH5p+l55yLKi8NCl9fX2ZuUGhvdG9TaG93ID0gZnVuY3Rpb24gKHZhbHVlLGNsaWVudFVzZXJJRCkgew0KICAgIEV4dC5jcmVhdGUoJ0ppdC53aW5kb3cuUGhvdG9XaW5kb3cnLCB7DQogICAgICAgIGlkOiAnX19jb2x1bW5QaG90b0lEJywNCiAgICAgICAgdGl0bGU6ICfnhafniYfmn6XnnIsnLA0KICAgICAgICBwQ2xpZW50VXNlcklEOmNsaWVudFVzZXJJRCwNCiAgICAgICAgdmFsdWU6IHZhbHVlDQogICAgfSk7DQogICAgRXh0LmdldENtcCgiX19jb2x1bW5QaG90b0lEIikuc2hvdygpOw0KfQ0KLyoNCuWKqOaAgemdouadvw0KKi8NCkV4dC5kZWZpbmUoJ0ppdC5wYW5lbC5EeW5hbWljUGFuZWwnLCB7DQogICAgZXh0ZW5kOiAnRXh0LnBhbmVsLlBhbmVsJw0KICAgICwgYWxpYXM6IFsnd2lkZ2V0LmppdGR5bmFtaWNwYW5lbCcsJ3dpZGdldC5qaXRkcGFuZWwnXQ0KICAgICwgY29uZmlnOiB7DQogICAgICAgIC8qDQogICAgICAgIOiOt+WPluWKqOaAgeaOp+S7tumFjee9rueahHVybA0KICAgICAgICAkcmVxdWlyZWQNCiAgICAgICAgKi8NCiAgICAgICAgdXJsOm51bGwNCiAgICB9DQogICAgLCBjb25zdHJ1Y3RvcjogZnVuY3Rpb24gKGNmZykgew0KICAgICAgICAvL+WumuS5iem7mOiupOmFjee9rg0KICAgICAgICB2YXIgZGVmYXVsdENvbmZpZyA9IHsNCiAgICAgICAgICAgIGNsb3NlYWJsZTogdHJ1ZQ0KICAgICAgICAgICAgLCBjbG9zZUFjdGlvbjogJ2hpZGUnDQogICAgICAgICAgICAsIG1vZGFsOiAndHJ1ZScNCiAgICAgICAgICAgICwgcmVzaXphYmxlOiBmYWxzZQ0KICAgICAgICB9Ow0KICAgICAgICAvL+WQiOW5tumFjee9rumhuQ0KICAgICAgICBjZmcgPSBFeHQuYXBwbHlJZihjZmcsIGRlZmF1bHRDb25maWcpOw0KICAgICAgICAvL+WIneWni+WMlumFjee9rumhuQ0KICAgICAgICB0aGlzLmluaXRDb25maWcoY2ZnKTsNCiAgICAgICAgLy/osIPnlKjniLbnsbvov5vooYzliJ3lp4vljJYNCiAgICAgICAgdGhpcy5jYWxsUGFyZW50KGFyZ3VtZW50cyk7DQogICAgfQ0KfSk7DQovL0NoZWNrYm94TW9kZWzln7rnoYDmjqfku7YNCkV4dC5kZWZpbmUoJ0ppdC5zZWxlY3Rpb24uQ2hlY2tib3hNb2RlbCcsIHsNCiAgICBleHRlbmQ6ICdFeHQuc2VsZWN0aW9uLkNoZWNrYm94TW9kZWwnLA0KICAgIGFsaWFzOiAnd2lkZ2V0LmppdGNoZWNrYm94bW9kZWwnLA0KICAgIGFsbFNlbGVjdG9yU3RhdHVzOiAwLCAgIC8v5a6a5LmJ5Yid5aeL5YC877yM5b2T5YmN54q25oCBMOS4uum7mOiupO+8jDHkuLrlhajpgInvvIwy5Li65YWo5LiN6YCJDQogICAgaW5jbHVkZUxpc3Q6IG5ldyBBcnJheSgpLCAgIC8v5a6a5LmJ5YyF5ZCr5YC8DQogICAgZXhjbHVkZUxpc3Q6IG5ldyBBcnJheSgpLCAgIC8v5a6a5LmJ5o6S6Zmk5YC8DQogICAgaW5pdENoZWNrZWQ6IG5ldyBBcnJheSgpLCAgIC8v5a6a5LmJ5Lit6Ze05YC8DQogICAgZGVmYXVsdExpc3Q6IG5ldyBBcnJheSgpLCAgIC8v5a6a5LmJ6buY6K6k5YC8DQogICAgcm93U2VsZWN0OiB0cnVlLCAgICAgICAgICAgIC8v5a6a5LmJ5piv5ZCm6IO954K55Ye76KGM6YCJ5oupDQogICAgY29uZmlnOiB7DQogICAgICAgIGlkUHJvcGVydHk6ICcnLCAgLy8g5a6a5LmJ5re75Yqg5Yiw5pWw5o2u5bqT5Lit55qE5YWz6IGUSUTlrZfmrrUNCiAgICAgICAgaWRTZWxlY3Q6ICcnICAgICAvLyDlrprkuYnliKTmlq3mmK/lkKbpgInmi6nnmoRJROWtl+autQ0KICAgIH0sDQogICAgY29uc3RydWN0b3I6IGZ1bmN0aW9uIChjZmcpIHsNCiAgICAgICAgdmFyIGRlZmF1bHRDb25maWcgPSB7fTsNCiAgICAgICAgLy/lkIjlubbphY3nva7pobkNCiAgICAgICAgY2ZnID0gRXh0LmFwcGx5SWYoY2ZnLCBkZWZhdWx0Q29uZmlnKTsNCiAgICAgICAgLy/liJ3lp4vljJbphY3nva7pobkNCiAgICAgICAgdGhpcy5pbml0Q29uZmlnKGNmZyk7DQogICAgICAgIC8v6LCD55So54i257G76L+b6KGM5Yid5aeL5YyWDQogICAgICAgIHRoaXMuY2FsbFBhcmVudChhcmd1bWVudHMpOw0KICAgIH0sDQogICAgLyoNCiAgICDngrnlh7vlpLTpg6jnmoRjaGVja2JveCDkuovku7bvvIzov5nkuKrov5vooYzliKTmlq3nirbmgIHmmK/pu5jorqTvvIzov5jmmK/lhajpgInmiJbogIXlhajkuI3pgIkNCiAgICDph43lhpnnmoTmlrnms5XvvIzlubbkuJTkuLrkuIDkupvlj4LmlbDorr7nva7kuLrliJ3lp4vljJbnirbmgIENCiAgICAqLw0KICAgIG9uSGVhZGVyQ2xpY2s6IGZ1bmN0aW9uIChoZWFkZXJDdCwgaGVhZGVyLCBlKSB7DQogICAgICAgIGlmIChoZWFkZXIuaXNDaGVja2VySGQpIHsNCiAgICAgICAgICAgIGUuc3RvcEV2ZW50KCk7DQogICAgICAgICAgICB2YXIgbWUgPSB0aGlzLA0KICAgICAgICAgICAgICAgICAgICAgICAgaXNDaGVja2VkID0gaGVhZGVyLmVsLmhhc0NscyhFeHQuYmFzZUNTU1ByZWZpeCArICdncmlkLWhkLWNoZWNrZXItb24nKTsNCiAgICAgICAgICAgIG1lLnByZXZlbnRGb2N1cyA9IHRydWU7DQogICAgICAgICAgICBpZiAoaXNDaGVja2VkKSB7DQogICAgICAgICAgICAgICAgLy/kv67mlLnkuLrlhajkuI3pgInnirbmgIENCiAgICAgICAgICAgICAgICB0aGlzLmFsbFNlbGVjdG9yU3RhdHVzID0gMjsNCiAgICAgICAgICAgICAgICB0aGlzLmV4Y2x1ZGVMaXN0ID0gbmV3IEFycmF5KCk7DQogICAgICAgICAgICAgICAgdGhpcy5pbml0Q2hlY2tlZCA9IG5ldyBBcnJheSgpOw0KICAgICAgICAgICAgICAgIHRoaXMuZGVmYXVsdExpc3QgPSBuZXcgQXJyYXkoKTsNCiAgICAgICAgICAgICAgICBFeHQuTXNnLnNob3coew0KICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ+aPkOekuicsDQogICAgICAgICAgICAgICAgICAgIG1zZzogJ+aCqOeahOaTjeS9nOWwhua4heepuuaJgOacieaVsOaNricsDQogICAgICAgICAgICAgICAgICAgIGJ1dHRvbnM6IEV4dC5Nc2cuT0ssDQogICAgICAgICAgICAgICAgICAgIGljb246IEV4dC5Nc2cuSU5GTywNCiAgICAgICAgICAgICAgICAgICAgZm46IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG1lLmRlc2VsZWN0QWxsKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy/kv67mlLnkuLrlhajpgInnirbmgIENCiAgICAgICAgICAgICAgICB0aGlzLmFsbFNlbGVjdG9yU3RhdHVzID0gMTsNCiAgICAgICAgICAgICAgICB0aGlzLmluY2x1ZGVMaXN0ID0gbmV3IEFycmF5KCk7DQogICAgICAgICAgICAgICAgdGhpcy5pbml0Q2hlY2tlZCA9IG5ldyBBcnJheSgpOw0KICAgICAgICAgICAgICAgIHRoaXMuZGVmYXVsdExpc3QgPSBuZXcgQXJyYXkoKTsNCiAgICAgICAgICAgICAgICBFeHQuTXNnLnNob3coew0KICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ+aPkOekuicsDQogICAgICAgICAgICAgICAgICAgIG1zZzogJ+aCqOeahOaTjeS9nOWwhumAieaLqeaJgOacieaVsOaNricsDQogICAgICAgICAgICAgICAgICAgIGJ1dHRvbnM6IEV4dC5Nc2cuT0ssDQogICAgICAgICAgICAgICAgICAgIGljb246IEV4dC5Nc2cuSU5GTywNCiAgICAgICAgICAgICAgICAgICAgZm46IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG1lLnNlbGVjdEFsbCgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7ICAgDQogICAgICAgICAgICB9DQogICAgICAgICAgICBtZS51cGRhdGVIZWFkZXJTdGF0ZSgpOw0KICAgICAgICAgICAgLy9pZiAobWUuc2VsZWN0ZWQuZ2V0Q291bnQoKSA9PSAwKSB7DQogICAgICAgICAgICAvLyAgICAgICAgIG1lLnVwZGF0ZUhlYWRlclN0YXRlKCk7DQogICAgICAgICAgICAvL30NCiAgICAgICAgICAgIGRlbGV0ZSBtZS5wcmV2ZW50Rm9jdXM7DQogICAgICAgIH0NCiAgICB9LA0KICAgIC8qDQogICAg6YeN5YaZ54K55Ye76KGM55qE5LqL5Lu277yM56aB55So5LqG6YCJ5oup5Y2V5p2h55qE5Yqf6IO9DQogICAg5Zyo54K55Ye755qE5pe25YCZ77yM5Li65pWw57uE5re75Yqg5oiW6ICF5Yig6Zmk5LiA5Liq5pWw5o2uDQogICAgKi8NCiAgICBvblJvd01vdXNlRG93bjogZnVuY3Rpb24gKHZpZXcsIHJlY29yZCwgaXRlbSwgaW5kZXgsIGUpIHsNCiAgICAgICAgdmlldy5lbC5mb2N1cygpOw0KICAgICAgICB2YXIgbWUgPSB0aGlzLA0KICAgICAgICAgICAgICAgIGNoZWNrZXIgPSBlLmdldFRhcmdldCgnLicgKyBFeHQuYmFzZUNTU1ByZWZpeCArICdncmlkLXJvdy1jaGVja2VyJyksDQogICAgICAgICAgICAgICAgbW9kZTsNCiAgICAgICAgdmFyIHZhbHVlSUQgPSByZWNvcmQuZ2V0KG1lLmlkUHJvcGVydHkpOw0KICAgICAgICBpZiAoY2hlY2tlciB8fCB0aGlzLnJvd1NlbGVjdCkgew0KICAgICAgICAgICAgaWYgKG1lLmFsbFNlbGVjdG9yU3RhdHVzID09IDApIHsNCiAgICAgICAgICAgICAgICBpZiAobWUuaXNTZWxlY3RlZChyZWNvcmQpKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuaW5jbHVkZUxpc3QgPSB0aGlzLmppdERlbGV0ZUFycmF5KG1lLmluY2x1ZGVMaXN0LCB2YWx1ZUlEKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBtZS5pbmNsdWRlTGlzdCA9IHRoaXMuaml0QWRkQXJyYXkobWUuaW5jbHVkZUxpc3QsIHZhbHVlSUQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSBpZiAobWUuYWxsU2VsZWN0b3JTdGF0dXMgPT0gMSkgew0KICAgICAgICAgICAgICAgIGlmIChtZS5pc1NlbGVjdGVkKHJlY29yZCkpIHsNCiAgICAgICAgICAgICAgICAgICAgbWUuZXhjbHVkZUxpc3QgPSB0aGlzLmppdEFkZEFycmF5KG1lLmV4Y2x1ZGVMaXN0LCB2YWx1ZUlEKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBtZS5leGNsdWRlTGlzdCA9IHRoaXMuaml0RGVsZXRlQXJyYXkobWUuZXhjbHVkZUxpc3QsIHZhbHVlSUQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSBpZiAobWUuYWxsU2VsZWN0b3JTdGF0dXMgPT0gMikgew0KICAgICAgICAgICAgICAgIGlmIChtZS5pc1NlbGVjdGVkKHJlY29yZCkpIHsNCiAgICAgICAgICAgICAgICAgICAgbWUuaW5jbHVkZUxpc3QgPSB0aGlzLmppdERlbGV0ZUFycmF5KG1lLmluY2x1ZGVMaXN0LCB2YWx1ZUlEKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBtZS5pbmNsdWRlTGlzdCA9IHRoaXMuaml0QWRkQXJyYXkobWUuaW5jbHVkZUxpc3QsIHZhbHVlSUQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGlmICghbWUuYWxsb3dSaWdodE1vdXNlU2VsZWN0aW9uKGUpKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgaWYgKG1lLmNoZWNrT25seSAmJiAhY2hlY2tlcikgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9IA0KICAgICAgICBpZiAoY2hlY2tlciB8fCB0aGlzLnJvd1NlbGVjdCkgew0KICAgICAgICAgICAgbW9kZSA9IG1lLmdldFNlbGVjdGlvbk1vZGUoKTsNCiAgICAgICAgICAgIGlmIChtb2RlICE9PSAnU0lOR0xFJykgew0KICAgICAgICAgICAgICAgIG1lLnNldFNlbGVjdGlvbk1vZGUoJ1NJTVBMRScpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbWUuc2VsZWN0V2l0aEV2ZW50KHJlY29yZCwgZSk7DQogICAgICAgICAgICBtZS5zZXRTZWxlY3Rpb25Nb2RlKG1vZGUpOw0KICAgICAgICB9DQogICAgfSwNCiAgICBvblNlbGVjdENoYW5nZTogZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgbWUgPSB0aGlzOw0KICAgICAgICBtZS5jYWxsUGFyZW50KGFyZ3VtZW50cyk7DQogICAgICAgIG1lLnVwZGF0ZUhlYWRlclN0YXRlKCk7DQogICAgfSwNCiAgICAvKg0KICAgIOmHjeWGmeS6huS/ruaUueWktOmDqGNoZWNrYm9455qE5LqL5Lu2DQogICAgKi8NCiAgICB1cGRhdGVIZWFkZXJTdGF0ZTogZnVuY3Rpb24gKCkgew0KICAgICAgICAvL+WIpOaWreWOn+Wni+WxnuaAp2FsbFNlbGVjdG9yU3RhdHVz55qE5YC85piv5ZCm5piv5YWo6YCJDQogICAgICAgIHZhciBoZFNlbGVjdFN0YXR1cyA9IHRoaXMuYWxsU2VsZWN0b3JTdGF0dXMgPT0gMTsgLy8gdGhpcy5zZWxlY3RlZC5nZXRDb3VudCgpID09PSB0aGlzLnN0b3JlLmdldENvdW50KCk7DQogICAgICAgIHRoaXMudG9nZ2xlVWlIZWFkZXIoaGRTZWxlY3RTdGF0dXMpOw0KICAgIH0sDQogICAgLyoNCiAgICDoh6rlrprkuYnojrflj5bmlbDmja7nmoTmlrnms5XvvIzov5Tlm57mlbDnu4Tlr7nosaENCiAgICAqLw0KICAgIGppdEdldFZhbHVlOiBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciB2YWx1ZXMgPSB7fTsNCiAgICAgICAgdmFsdWVzLmFsbFNlbGVjdG9yU3RhdHVzID0gdGhpcy5hbGxTZWxlY3RvclN0YXR1czsNCiAgICAgICAgdmFsdWVzLmluY2x1ZGVMaXN0ID0gdGhpcy5pbmNsdWRlTGlzdDsNCiAgICAgICAgdmFsdWVzLmV4Y2x1ZGVMaXN0ID0gdGhpcy5leGNsdWRlTGlzdDsNCiAgICAgICAgdmFsdWVzLmRlZmF1bHRMaXN0ID0gdGhpcy5kZWZhdWx0TGlzdDsNCiAgICAgICAgcmV0dXJuIHZhbHVlczsNCiAgICB9LA0KICAgIC8qDQogICAg6Ieq5a6a5LmJ5riF56m65omA5pyJ55qE5YC85pa55rOVDQogICAgKi8NCiAgICBqaXRDbGVhclZhbHVlOiBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMuYWxsU2VsZWN0b3JTdGF0dXMgPSAwOw0KICAgICAgICB0aGlzLmluY2x1ZGVMaXN0ID0gbmV3IEFycmF5KCk7DQogICAgICAgIHRoaXMuZXhjbHVkZUxpc3QgPSBuZXcgQXJyYXkoKTsNCiAgICAgICAgdGhpcy5pbml0Q2hlY2tlZCA9IG5ldyBBcnJheSgpOw0KICAgICAgICB0aGlzLmRlZmF1bHRMaXN0ID0gbmV3IEFycmF5KCk7DQogICAgfQ0KICAgIC8qDQogICAg5Yid5aeL5YyW55qE5pe25YCZ6K6+572u5Y+C5pWwDQogICAg5Lyg5YWlcEdyaWRWaWV355qESWQgICAgDQogICAgKi8NCiAgICAsIGppdFNldFZhbHVlOiBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBtZSA9IHRoaXM7DQogICAgICAgIHZhciBwR2lyZFN0b3JlID0gbWUuZ2V0U3RvcmUoKTsNCiAgICAgICAgdmFyIGxlbmd0aCA9IHBHaXJkU3RvcmUuZGF0YS5pdGVtcy5sZW5ndGg7DQogICAgICAgIGlmICh0aGlzLmFsbFNlbGVjdG9yU3RhdHVzID09IDApIHsNCiAgICAgICAgICAgIC8qDQogICAgICAgICAgICDnirbmgIHkuLrpu5jorqTnirbmgIENCiAgICAgICAgICAgICovDQogICAgICAgICAgICBpZiAocEdpcmRTdG9yZS5kYXRhICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbml0Q2hlY2tlZC5sZW5ndGggPT0gMCkgew0KICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcFN0b3JlRGF0YSA9IHBHaXJkU3RvcmUuZGF0YS5pdGVtc1tpXS5kYXRhW3RoaXMuaWRTZWxlY3RdDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocFN0b3JlRGF0YSAhPSBudWxsICYmIHBTdG9yZURhdGEgIT0gIjAiICYmIHBTdG9yZURhdGEgIT0gIiIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluaXRDaGVja2VkID0gdGhpcy5qaXRBZGRBcnJheSh0aGlzLmluaXRDaGVja2VkLCBwR2lyZFN0b3JlLmRhdGEuaXRlbXNbaV0uZGF0YVt0aGlzLmlkUHJvcGVydHldKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB2YXIgZGVmYXVsdENvdW50ID0gdGhpcy5kZWZhdWx0TGlzdC5sZW5ndGg7DQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRlZmF1bHRMaXN0Lmxlbmd0aCA9PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRMaXN0ID0gdGhpcy5pbml0Q2hlY2tlZC50b1N0cmluZygpLnNwbGl0KCIsIik7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRlZmF1bHRMaXN0ID0gdGhpcy5qaXRBZGRBcnJheUJ5QXJyYXkodGhpcy5kZWZhdWx0TGlzdCwgdGhpcy5pbml0Q2hlY2tlZC50b1N0cmluZygpLnNwbGl0KCIsIikpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChkZWZhdWx0Q291bnQgIT0gdGhpcy5kZWZhdWx0TGlzdC5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmluY2x1ZGVMaXN0Lmxlbmd0aCA9PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbmNsdWRlTGlzdCA9IHRoaXMuaW5pdENoZWNrZWQudG9TdHJpbmcoKS5zcGxpdCgiLCIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluY2x1ZGVMaXN0ID0gdGhpcy5qaXRBZGRBcnJheUJ5QXJyYXkodGhpcy5pbmNsdWRlTGlzdCwgdGhpcy5pbml0Q2hlY2tlZC50b1N0cmluZygpLnNwbGl0KCIsIikpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHRoaXMuaW5pdENoZWNrZWQgPSBuZXcgQXJyYXkoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICB2YXIgcFN0b3JlRGF0YSA9IHBHaXJkU3RvcmUuZGF0YS5pdGVtc1tpXS5kYXRhW3RoaXMuaWRQcm9wZXJ0eV0NCiAgICAgICAgICAgICAgICAgICAgaWYgKHBTdG9yZURhdGEgIT0gbnVsbCAmJiBwU3RvcmVEYXRhICE9ICIwIiAmJiBwU3RvcmVEYXRhICE9ICIiKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pbmNsdWRlTGlzdC5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLmluY2x1ZGVMaXN0Lmxlbmd0aDsgaisrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmluY2x1ZGVMaXN0W2pdID09IHBTdG9yZURhdGEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lLnNlbGVjdChpLCB0cnVlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYWxsU2VsZWN0b3JTdGF0dXMgPT0gMSkgew0KICAgICAgICAgICAgLyoNCiAgICAgICAgICAgIOeKtuaAgeS4uuWFqOmAieeKtuaAgQ0KICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIG1lLnNlbGVjdEFsbCgpOw0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIHZhciBwU3RvcmVEYXRhID0gcEdpcmRTdG9yZS5kYXRhLml0ZW1zW2ldLmRhdGFbdGhpcy5pZFByb3BlcnR5XQ0KICAgICAgICAgICAgICAgIGlmIChwU3RvcmVEYXRhICE9IG51bGwgJiYgcFN0b3JlRGF0YSAhPSAiMCIgJiYgcFN0b3JlRGF0YSAhPSAiIikgew0KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5leGNsdWRlTGlzdC5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMuZXhjbHVkZUxpc3QubGVuZ3RoOyBqKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5leGNsdWRlTGlzdFtqXSA9PSBwU3RvcmVEYXRhKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lLmRlc2VsZWN0KGksIHRydWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvL2V4Y2x1ZGVMaXN0OiBuZXcgQXJyYXkoKQ0KICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYWxsU2VsZWN0b3JTdGF0dXMgPT0gMikgew0KICAgICAgICAgICAgLyoNCiAgICAgICAgICAgIOeKtuaAgeS4uuWFqOS4jemAieeKtuaAgQ0KICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIG1lLmRlc2VsZWN0QWxsKCk7DQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgdmFyIHBTdG9yZURhdGEgPSBwR2lyZFN0b3JlLmRhdGEuaXRlbXNbaV0uZGF0YVt0aGlzLmlkUHJvcGVydHldDQogICAgICAgICAgICAgICAgaWYgKHBTdG9yZURhdGEgIT0gbnVsbCAmJiBwU3RvcmVEYXRhICE9ICIwIiAmJiBwU3RvcmVEYXRhICE9ICIiKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmluY2x1ZGVMaXN0Lmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdGhpcy5pbmNsdWRlTGlzdC5sZW5ndGg7IGorKykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmluY2x1ZGVMaXN0W2pdID09IHBTdG9yZURhdGEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWUuc2VsZWN0KGksIHRydWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9LA0KICAgIC8qDQogICAg5re75Yqg5LiA5Liq5YC85Yiw5LiA5Liq5pWw57uE5a+56LGhDQogICAg6L+U5Zue5paw55qE5pWw57uE5a+56LGhDQogICAgKi8NCiAgICBqaXRBZGRBcnJheTogZnVuY3Rpb24gKHBDYWx1ZUNoZWNrZWQsIHBWYWx1ZSkgew0KICAgICAgICB2YXIgaXNDb250YWluID0gdHJ1ZTsNCiAgICAgICAgaWYgKHBDYWx1ZUNoZWNrZWQubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBwQ2FsdWVDaGVja2VkLmxlbmd0aDsgaisrKSB7DQogICAgICAgICAgICAgICAgaWYgKHBDYWx1ZUNoZWNrZWRbal0gPT0gcFZhbHVlKSB7DQogICAgICAgICAgICAgICAgICAgIGlzQ29udGFpbiA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzQ29udGFpbikgew0KICAgICAgICAgICAgcENhbHVlQ2hlY2tlZC5wdXNoKHBWYWx1ZSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHBDYWx1ZUNoZWNrZWQ7DQogICAgfSwNCiAgICAvKg0KICAgIOa3u+WKoOS4gOS4quaWsOeahOaVsOe7hOWvueixoeWIsOWPpuS4gOS4quaVsOe7hOS4re+8jOWOu+mZpOmHjeWkjQ0KICAgIOi/lOWbnuaWsOeahOaVsOe7hOWvueixoQ0KICAgICovDQogICAgaml0QWRkQXJyYXlCeUFycmF5OiBmdW5jdGlvbiAocFZhbHVlQ2hlY2tlZCwgcFZhbHVlc0NoZWNrZWQpIHsNCiAgICAgICAgdmFyIGlzQ29udGFpbiA9IHRydWU7DQogICAgICAgIGlmIChwVmFsdWVDaGVja2VkLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcFZhbHVlc0NoZWNrZWQubGVuZ3RoOyBqKyspIHsNCiAgICAgICAgICAgICAgICBpc0NvbnRhaW4gPSB0cnVlOw0KICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcFZhbHVlQ2hlY2tlZC5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICBpZiAocFZhbHVlc0NoZWNrZWRbal0gPT0gcFZhbHVlQ2hlY2tlZFtpXSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaXNDb250YWluID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoaXNDb250YWluKSB7DQogICAgICAgICAgICAgICAgICAgIHBWYWx1ZUNoZWNrZWQucHVzaChwVmFsdWVzQ2hlY2tlZFtqXSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBwVmFsdWVDaGVja2VkOw0KICAgIH0NCiAgICAsDQogICAgLyoNCiAgICDliKDpmaTkuIDkuKrmlbDnu4Tlr7nosaHkuK3nmoTkuIDkuKrmlbDmja4NCiAgICDov5Tlm57kuIDkuKrmlrDnmoTmlbDnu4Tlr7nosaENCiAgICAqLw0KICAgIGppdERlbGV0ZUFycmF5OiBmdW5jdGlvbiAocFZhbHVlQ2hlY2tlZCwgcFZhbHVlKSB7DQogICAgICAgIHZhciBpc0NvbnRhaW4gPSBmYWxzZTsNCiAgICAgICAgdmFyIGogPSAwOw0KICAgICAgICBpZiAocFZhbHVlQ2hlY2tlZC5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgcFZhbHVlQ2hlY2tlZC5sZW5ndGg7IGorKykgew0KICAgICAgICAgICAgICAgIGlmIChwVmFsdWVDaGVja2VkW2pdID09IHBWYWx1ZSkgew0KICAgICAgICAgICAgICAgICAgICBpc0NvbnRhaW4gPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzQ29udGFpbikgew0KICAgICAgICAgICAgcFZhbHVlQ2hlY2tlZC5zcGxpY2UoaiwgMSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHBWYWx1ZUNoZWNrZWQ7DQogICAgfQ0KfSkNCg0KLy/lnLDlm77ln7rnoYDmjqfku7YNCkV4dC5kZWZpbmUoJ0ppdC53aW5kb3cuTWFwV2luZG93Jywgew0KICAgIGFsaWFzOiAnd2lkZ2V0LmppdG1hcHdpbmRvdycsDQogICAgY29uZmlnOiB7DQogICAgICAgIGppdFBvaW50OiBudWxsDQogICAgfSwNCiAgICBjb25zdHJ1Y3RvcjogZnVuY3Rpb24gKGFyZ3MpIHsNCiAgICAgICAgaWYgKGFyZ3MuaWQgPT0gbnVsbCB8fCBhcmdzLmlkID09ICIiKSB7DQogICAgICAgICAgICBhcmdzLmlkID0gIl9fTWFwSUQiOw0KICAgICAgICB9DQogICAgICAgIHZhciBkZWZhdWx0Q29uZmlnID0gew0KICAgICAgICAgICAgaml0U2l6ZTogImN1c3RvbSIsDQogICAgICAgICAgICB0aXRsZTogJ01hcCcsDQogICAgICAgICAgICB3aWR0aDogNzAwLA0KICAgICAgICAgICAgaGVpZ2h0OiA0NTAsDQogICAgICAgICAgICBjb25zdHJhaW46IHRydWUsDQogICAgICAgICAgICBtb2RhbDogdHJ1ZSwNCiAgICAgICAgICAgIHJlc2l6YWJsZTogdHJ1ZSwNCiAgICAgICAgICAgIGluR1BTVHlwZTogMCwNCiAgICAgICAgICAgIGh0bWw6ICc8aWZyYW1lICBoZWlnaHQ9IjEwMCUiICBtYXJnaW5oZWlnaHQ9IjAiIG1hcmdpbndpZHRoPSIwIiBzY3JvbGxpbmc9Im5vIiAgZnJhbWVib3JkZXI9Im5vIiAgaWQ9IicgKyBhcmdzLmlkICsgJ2ZybUZsYXNoTWFwIiAgd2lkdGg9IjEwMCUiIHNyYz0iL0xpYi9NYXBGbGFzaC9pbmRleC5odG1sP2NvbmZpZz1tYXBjb25maWcueG1sJk1hcFdpbmRvd0lEPScgKyBhcmdzLmlkICsgJyI+PC9pZnJhbWU+Jw0KICAgICAgICB9DQogICAgICAgIHZhciBkZWZhdWx0UG9pbnQgPSB7DQogICAgICAgICAgICBwb2ludElEOiAnMCcsICAgICAgICAgICAvL1tTdG9yZUlEXSDmlbTmlbDvvIzllK/kuIDmoIfor4bvvIzlv4XpobsNCiAgICAgICAgICAgIGxuZzogJzAnLCAgICAgICAgICAgICAgIC8vW0xuZ10g5rWu54K55pWw77yM5ZWG5bqXR1BT5Z2Q5qCH55qE57uP5bqm77yM5b+F6aG777yM6IyD5Zu0MC0xODAuDQogICAgICAgICAgICBsYXQ6ICcwJywgICAgICAgICAgICAgICAvL1tMYXRdIOa1rueCueaVsO+8jOWVhuW6l0dQU+WdkOagh+eahOe6rOW6pu+8jOW/hemhu++8jOiMg+WbtDAtOTANCiAgICAgICAgICAgIGljb246ICdnLnBuZycsICAgICAgICAgIC8vW0ljb25dIOWbvueJh+agt+W8j++8jGcucG5n57u/6Imy54K577yIZ3MucG5n6YCJ5oup5ZCO77yJ77yMYi5wbmfok53oibLngrnvvIhicy5wbmfpgInmi6nlkI7vvInvvIxvLnBuZ+apmeiJsueCue+8iG9zLnBuZ+mAieaLqeWQju+8ie+8jOW/hemhuw0KICAgICAgICAgICAgaXNFZGl0YWJsZTogZmFsc2UsICAgICAgLy9bSXNFZGl0XSDmmK/lkKblj6/mi5bmi70NCiAgICAgICAgICAgIGluc2lkZVRleHQ6ICcnLCAgICAgICAgIC8vW0xhYmVsSURdIOWbvueJh+S4iuaUvueahOaWh+Wtlw0KICAgICAgICAgICAgcG9pbnRUaXRsZTogJycsICAgICAgICAgLy9bTGFiZWxDb250ZW50XSDlm77niYfovrnkuIrmloflrZcNCiAgICAgICAgICAgIHBvaW50SW5mb0hlaWdodDogJzAnLCAgIC8vW1BvcEluZm9IZWlnaHRdIOW8ueWHuuahhumVv+W6pg0KICAgICAgICAgICAgcG9pbnRJbmZvV2lkdGg6ICcwJywgICAgLy9bUG9wSW5mb1dpZHRoXSDlvLnlh7rmoYblrr3luqYNCiAgICAgICAgICAgIHRpcHM6ICcnLCAgICAgICAgICAgICAgIC8vW1RpcHNdIOWtl+espuS4su+8jOm8oOagh+aCrOWBnOWIsOeCueS4iuaXtuaYvuekuueahOaWh+acrOS/oeaBrw0KICAgICAgICAgICAgcG9pbnRJbmZvOiBuZXcgQXJyYXkoKSwgIC8vW1BvcEluZm9dIOmXqOW6l+S/oeaBryzlv4XpobsgeyJ0aXRsZSI6IuWuouaIt+WQjeensCIsInZhbHVlIjoi5Z2C55Sw5Yy76ZmiIiwidHlwZSI6IjEiIH10eXBlPTHkuLrmlofmnKzjgIF0eXBlPTLkuLrlm77niYfjgIF0eXBlPTPkuLrmjInpkq4sdHlwZT00IOS4umlmcmFtZQ0KICAgICAgICAgICAgbWFwU2NhbGU6IDAgICAgICAgICAgICAgIC8v5Zyw5Zu+562J57qnDQogICAgICAgIH07DQogICAgICAgIGFyZ3Muaml0UG9pbnQgPSBFeHQuYXBwbHlJZihhcmdzLmppdFBvaW50IHx8IHt9LCBkZWZhdWx0UG9pbnQpOw0KICAgICAgICBhcmdzID0gRXh0LmFwcGx5SWYoYXJncywgZGVmYXVsdENvbmZpZyk7DQogICAgICAgIGlmIChhcmdzLmlkICE9IG51bGwgJiYgYXJncy5pZCAhPSAiIikgew0KICAgICAgICAgICAgaWYgKEV4dC5nZXRDbXAoYXJncy5pZCkgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIEV4dC5nZXRDbXAoYXJncy5pZCkuZGVzdHJveSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFyIGluc3RhbmNlID0gRXh0LmNyZWF0ZSgnSml0LndpbmRvdy5XaW5kb3cnLCBhcmdzKTsNCiAgICAgICAgICAgIC8qDQogICAgICAgICAgICDojrflj5blnLDlm77lr7nosaENCiAgICAgICAgICAgICovDQogICAgICAgICAgICBpbnN0YW5jZS5nZXRGbGFzaE1hcE9iamVjdCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICB2YXIgZnJhbWUgPSB3aW5kb3cuZnJhbWVzW2FyZ3MuaWQgKyAiZnJtRmxhc2hNYXAiXTsNCiAgICAgICAgICAgICAgICByZXR1cm4gZnJhbWU7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8qDQogICAgICAgICAgICBGbGFzaOWcsOWbvuaYr+WQpuWKoOi9veWujOavlQ0KICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIGluc3RhbmNlLl9tYXBfSW5pdE1hcCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAvL3ZhciBmcmFtZSA9IGluc3RhbmNlLmdldEZsYXNoTWFwT2JqZWN0KCk7DQogICAgICAgICAgICAgICAgLy9mcmFtZS5pbmRleC5fbWFwX1NldE1hcFNjYWxlKHRoaXMuaml0UG9pbnQubWFwU2NhbGUpOw0KICAgICAgICAgICAgICAgIHRoaXMuX21hcF9Mb2FkTWFwKCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGluc3RhbmNlLl9tYXBfTG9hZE1hcCA9IGZ1bmN0aW9uICgpIHsNCg0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmppdFBvaW50LmxuZyA+IDAgJiYgdGhpcy5qaXRQb2ludC5sYXQgPiAwKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmppdFBvaW50LmluR1BTVHlwZSA9PSAxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgeHkgPSBpbnN0YW5jZS5fbWFwX1hZR3BzQ2hhbmdlKHRoaXMuaml0UG9pbnQubG5nLCB0aGlzLmppdFBvaW50LmxhdCk7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmppdFBvaW50LmxuZyA9IHh5LnNwbGl0KCcsJylbMF07DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmppdFBvaW50LmxhdCA9IHh5LnNwbGl0KCcsJylbMV07DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgdmFyIGZyYW1lID0gaW5zdGFuY2UuZ2V0Rmxhc2hNYXBPYmplY3QoKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGZyYW1lICE9IG51bGwgJiYgZnJhbWUuaW5kZXggIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWUuaW5kZXguX21hcF9SZW1vdmVTdG9yZXMoIiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWUuaW5kZXguX21hcF9BZGRTdG9yZXMoaW5zdGFuY2Uuaml0R2V0UG9pbnQoKSwgdHJ1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcCA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5qaXRQb2ludC5tYXBTY2FsZSAhPSBudWxsICYmIHRoaXMuaml0UG9pbnQubWFwU2NhbGUgPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcCA9IHRoaXMuaml0UG9pbnQubWFwU2NhbGU7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocCA9PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcCA9IGZyYW1lLmluZGV4Ll9tYXBfR2V0TWFwU2NhbGUoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocCA8PSA0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAgPSAxNTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocCA9PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWUuaW5kZXguX21hcF9Nb3ZlVG9TdG9yZSh0aGlzLmppdFBvaW50LnBvaW50SUQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcmFtZS5pbmRleC5fbWFwX01vdmVUb1N0b3JlQnlTY2FsZSh0aGlzLmppdFBvaW50LnBvaW50SUQsIHApDQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvKg0KICAgICAgICAgICAg5Zyw5Zu+5Y2V5Ye75LqL5Lu2LOmHjeaWsOiwg+eUqCAgICAgICAgICAgIA0KICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIGluc3RhbmNlLl9tYXBfT25DbGljayA9IGZ1bmN0aW9uIChwTG5nLCBwTGF0KSB7DQogICAgICAgICAgICAgICAgaWYgKHRoaXMuaml0UG9pbnQuaXNFZGl0YWJsZSkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLmppdFBvaW50LmxuZyA9IHBMbmc7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuaml0UG9pbnQubGF0ID0gcExhdDsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWFwX0xvYWRNYXAoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvKg0KICAgICAgICAgICAg5Zyw5Zu+5L+u5pS55LqL5Lu277yM5b2x5ZONDQogICAgICAgICAgICAqLw0KICAgICAgICAgICAgaW5zdGFuY2UuX21hcF9VcGRhdGUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgaWYgKGFyZ3MuaGFuZGxlciAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIGFyZ3MuaGFuZGxlcih0aGlzLmppdFBvaW50KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8qDQogICAgICAgICAgICDorr7nva7mlbDmja4gIOaVsOaNruagvOW8jyB7IkxhdCI6MTIzLjMyLCJMbmciOjMyLjEyLCJUeXBlIjoxfQ0KICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIGluc3RhbmNlLmppdFNldFZhbHVlID0gZnVuY3Rpb24gKHBWYWx1ZSkgew0KICAgICAgICAgICAgICAgIGlmIChwVmFsdWUgIT0gbnVsbCAmJiBwVmFsdWUgIT0gIiIpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIFZhbHVlcyA9IHBWYWx1ZS5zcGxpdCgiLCIpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoVmFsdWVzLmxlbmd0aCA+IDEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmppdFBvaW50LmlzRWRpdGFibGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmppdFBvaW50LmxuZyA9IFZhbHVlc1swXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmppdFBvaW50LmxhdCA9IFZhbHVlc1sxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tYXBfTG9hZE1hcCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5qaXRQb2ludC5sbmcgPSAiIjsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5qaXRQb2ludC5sYXQgPSAiIjsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWFwX0xvYWRNYXAoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8qDQogICAgICAgICAgICDojrflj5bmlbDmja4NCiAgICAgICAgICAgICovDQogICAgICAgICAgICBpbnN0YW5jZS5qaXRHZXRWYWx1ZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5qaXRQb2ludDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8qDQogICAgICAgICAgICDopoHntKDnvJbovpHkuovku7YNCiAgICAgICAgICAgICovDQogICAgICAgICAgICBpbnN0YW5jZS5fbWFwX0dyYXBoaWNfTW92ZUVkaXQgPSBmdW5jdGlvbiAocE9iaikgew0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmppdFBvaW50LmlzRWRpdGFibGUpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5qaXRQb2ludC5sbmcgPSBwT2JqLkxuZzsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5qaXRQb2ludC5sYXQgPSBwT2JqLkxhdDsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWFwX0xvYWRNYXAoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8qDQogICAgICAgICAgICBGbGFzaOWcsOWbvua4hemZpOeCuQ0KICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIGluc3RhbmNlLl9tYXBfUmVtb3ZlU3RvcmVzID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHZhciBmcmFtZSA9IGluc3RhbmNlLmdldEZsYXNoTWFwT2JqZWN0KCk7DQogICAgICAgICAgICAgICAgaWYgKGZyYW1lICE9IG51bGwgJiYgZnJhbWUuaW5kZXggIT0gbnVsbCAmJiBmcmFtZS5pbmRleC5fbWFwX1JlbW92ZVN0b3JlcyAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIGZyYW1lLmluZGV4Ll9tYXBfUmVtb3ZlU3RvcmVzKCIiKTsNCiAgICAgICAgICAgICAgICAgICAgZnJhbWUuX21hcF9SZW1vdmVUaXRsZSgpOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLmppdFBvaW50LmxuZyA9ICIiOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLmppdFBvaW50LmxhdCA9ICIiOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9tYXBfTG9hZE1hcCgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLyoNCiAgICAgICAgICAgIEZsYXNo5Zyw5Zu+55m+5bqm6L2s5o2i6LC35q2M5Z2Q5qCHDQogICAgICAgICAgICAqLw0KICAgICAgICAgICAgaW5zdGFuY2UuX21hcF9YWUNoYW5nZSA9IGZ1bmN0aW9uIChsbmcsIGxhdCkgew0KICAgICAgICAgICAgICAgIHZhciBmcmFtZSA9IGluc3RhbmNlLmdldEZsYXNoTWFwT2JqZWN0KCk7DQogICAgICAgICAgICAgICAgdmFyIHh5ID0gZnJhbWUuaW5kZXguX21hcF9YWUNoYW5nZShsbmcsIGxhdCwgMSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHh5Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLypncHMg6L2sZ29vZ2xlKi8NCiAgICAgICAgICAgIGluc3RhbmNlLl9tYXBfWFlHcHNDaGFuZ2UgPSBmdW5jdGlvbiAobG5nLCBsYXQpIHsNCg0KICAgICAgICAgICAgICAgIHZhciBmcmFtZSA9IGluc3RhbmNlLmdldEZsYXNoTWFwT2JqZWN0KCk7DQogICAgICAgICAgICAgICAgdmFyIHh5ID0gZnJhbWUuaW5kZXguX21hcF9YWUNoYW5nZShsbmcsIGxhdCwgMyk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHh5Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLyoNCiAgICAgICAgICAgIEZsYXNo5Zyw5Zu+5riF56m65p+l6K+i5pWw5o2uDQogICAgICAgICAgICAqLw0KICAgICAgICAgICAgaW5zdGFuY2UuX21hcF9SZW1vdmVUaXRsZSA9IGZ1bmN0aW9uIChsbmcsIGxhdCkgew0KICAgICAgICAgICAgICAgIHZhciBmcmFtZSA9IGluc3RhbmNlLmdldEZsYXNoTWFwT2JqZWN0KCk7DQogICAgICAgICAgICAgICAgZnJhbWUuaW5kZXguX21hcF9SZW1vdmVUaXRsZSgpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvKkZsYXNo5Zyw5Zu+5omA6ZyA6KaB55qESnNvbiDlrZfnrKbkuLIsDQogICAgICAgICAgICBAcmV0dXJuIHN0cmluZ+exu+Wei+eahEpzb24NCiAgICAgICAgICAgICovDQogICAgICAgICAgICBpbnN0YW5jZS5qaXRHZXRQb2ludCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICB2YXIgUG9pbnQgPSBuZXcgT2JqZWN0KCk7DQogICAgICAgICAgICAgICAgUG9pbnQuU3RvcmVJRCA9IHRoaXMuaml0UG9pbnQucG9pbnRJRDsNCiAgICAgICAgICAgICAgICBQb2ludC5MbmcgPSB0aGlzLmppdFBvaW50LmxuZzsNCiAgICAgICAgICAgICAgICBQb2ludC5MYXQgPSB0aGlzLmppdFBvaW50LmxhdDsNCiAgICAgICAgICAgICAgICBQb2ludC5JY29uID0gdGhpcy5qaXRQb2ludC5pY29uOw0KICAgICAgICAgICAgICAgIFBvaW50LklzQXNzaWduZWQgPSAidHJ1ZSI7ICAvL+m7mOiupOS4unRydWUNCiAgICAgICAgICAgICAgICBQb2ludC5Jc0VkaXQgPSB0aGlzLmppdFBvaW50LmlzRWRpdGFibGU7DQogICAgICAgICAgICAgICAgUG9pbnQuTGFiZWxJRCA9IHRoaXMuaml0UG9pbnQuaW5zaWRlVGV4dDsNCiAgICAgICAgICAgICAgICBQb2ludC5MYWJlbENvbnRlbnQgPSB0aGlzLmppdFBvaW50LnBvaW50VGl0bGU7DQogICAgICAgICAgICAgICAgaWYgKHRoaXMuaml0UG9pbnQucG9pbnRJbmZvSGVpZ2h0ID4gMCkgew0KICAgICAgICAgICAgICAgICAgICBQb2ludC5Qb3BJbmZvSGVpZ2h0ID0gdGhpcy5qaXRQb2ludC5wb2ludEluZm9IZWlnaHQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmppdFBvaW50LnBvaW50SW5mb1dpZHRoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICBQb2ludC5Qb3BJbmZvV2lkdGggPSB0aGlzLmppdFBvaW50LnBvaW50SW5mb1dpZHRoOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBQb2ludC5UaXBzID0gdGhpcy5qaXRQb2ludC50aXBzOw0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmppdFBvaW50LnBvaW50SW5mbyAhPSBudWxsICYmIHRoaXMuaml0UG9pbnQucG9pbnRJbmZvLnRvU3RyaW5nKCkgIT0gIiIpIHsNCiAgICAgICAgICAgICAgICAgICAgUG9pbnQuUG9wSW5mbyA9IFt0aGlzLmppdFBvaW50LnBvaW50SW5mb107DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHZhciBQb2ludEFycmF5ID0gbmV3IEFycmF5KCk7DQogICAgICAgICAgICAgICAgUG9pbnRBcnJheS5wdXNoKFBvaW50KTsNCiAgICAgICAgICAgICAgICB2YXIgUG9pbnRKc29uID0gRXh0LkpTT04uZW5jb2RlKFBvaW50QXJyYXkpOw0KICAgICAgICAgICAgICAgIHJldHVybiBQb2ludEpzb247DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gaW5zdGFuY2U7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgIH0NCn0pOw0KDQpFeHQuZGVmaW5lKCdKaXQud2luZG93LlBob3RvV2luZG93Jywgew0KICAgIGFsaWFzOiAnd2lkZ2V0LmppdHBob3Rvd2luZG93JywNCg0KICAgIGNvbnN0cnVjdG9yOiBmdW5jdGlvbiAoYXJncykgew0KICAgICAgICB2YXIgbWUgPSB0aGlzOw0KICAgICAgICB2YXIgZGVmYXVsdENvbmZpZyA9IHsNCiAgICAgICAgICAgIGlkOiAnX19QaG90b1dpbmRvd0lEJyAgIC8vcGFuZWwg55qEaWQg6buY6K6k5Li6bWFwU2VsZWN0ICAgICAgICAgIA0KICAgICAgICAgICAgLCByZW5kZXJUbzogbnVsbCAvL3BhbmVs55qEcmVuZGVyVG8gICAgICAgICAgDQogICAgICAgICAgICAsIHBob3RvVGl0bGU6ICfnhafniYfkuIrkvKAnDQogICAgICAgICAgICAsIHBDbGllbnRJRDogMA0KICAgICAgICAgICAgLCBwQ2xpZW50VXNlcklEOiAwDQogICAgICAgIH0NCiAgICAgICAgYXJncyA9IEV4dC5hcHBseUlmKGFyZ3MsIGRlZmF1bHRDb25maWcpOw0KICAgICAgICBpZiAoX19jbGllbnRpZCAhPSBudWxsKSB7DQogICAgICAgICAgICBhcmdzLnBDbGllbnRJRCA9IF9fY2xpZW50aWQ7DQogICAgICAgIH0NCiAgICAgICAgLy/nhafniYfnqpfkvZPmjqfku7YNCiAgICAgICAgLy/nhafniYdwYW5lbA0KICAgICAgICBtZS5waG90b1BhbmVsSW1nID0gRXh0LmNyZWF0ZSgnRXh0LnBhbmVsLlBhbmVsJywgew0KICAgICAgICAgICAgd2lkdGg6IDQ5MCwNCiAgICAgICAgICAgIGhlaWdodDogMzI1LA0KICAgICAgICAgICAgY29sdW1uV2lkdGg6IDEsDQogICAgICAgICAgICBodG1sOiAnPGRpdiBzdHlsZT0id2lkdGg6NDg4cHg7aGVpZ2h0OjMyNXB4OyB0ZXh0LWFsaWduOmNlbnRlcjtwYWRkaW5nLXRvcDo1cHgiPjxpbWcgaWQ9Il9faW1nJyArIGFyZ3MuaWQgKyAnIiBzdHlsZT0ibWF4LXdpZHRoOjQ4MHB4O21heC1oZWlnaHQ6MjgwcHgiIHNyYz0iJyArICcvRmlsZS9Nb2JpbGVEZXZpY2VzL1Bob3RvLycgKyBhcmdzLnBDbGllbnRJRCArICcvJyArIGFyZ3MucENsaWVudFVzZXJJRCArICcvJyArIGFyZ3MudmFsdWUgKyAnIj48L2Rpdj4nLA0KICAgICAgICAgICAgbGF5b3V0OiAnY29sdW1uJywNCiAgICAgICAgICAgIGJvcmRlcjogMA0KICAgICAgICB9KTsNCg0KICAgICAgICBpZiAoRXh0LmdldENtcChhcmdzLmlkKSAhPSBudWxsKSB7DQogICAgICAgICAgICBFeHQuZ2V0Q21wKGFyZ3MuaWQpLmRlc3Ryb3koKTsNCiAgICAgICAgfQ0KICAgICAgICAvL+S4iuS8oOWbvueJh+eahHdpbmRvdw0KICAgICAgICB2YXIgaW5zdGFuY2UgPSBFeHQuY3JlYXRlKCdKaXQud2luZG93LldpbmRvdycsIHsNCiAgICAgICAgICAgIGlkOiBhcmdzLmlkLA0KICAgICAgICAgICAgdGl0bGU6IGFyZ3MucGhvdG9UaXRsZSwNCiAgICAgICAgICAgIGl0ZW1zOiBbbWUucGhvdG9QYW5lbEltZ10sDQogICAgICAgICAgICB3aWR0aDogNTAwLA0KICAgICAgICAgICAgaGVpZ2h0OiAzMjUsDQogICAgICAgICAgICBqaXRTaXplOiAiY3VzdG9tIiwNCiAgICAgICAgICAgIGNvbnN0cmFpbjogdHJ1ZSwNCiAgICAgICAgICAgIG1vZGFsOiB0cnVlDQogICAgICAgIH0pOw0KICAgIH0NCn0pOw0KRXh0LmRlZmluZSgnSml0LndpbmRvdy5XaW5kb3cnLCB7DQogICAgZXh0ZW5kOiAnRXh0LndpbmRvdy5XaW5kb3cnDQogICAgLCBhbGlhczogJ3dpZGdldC5qaXR3aW5kb3cnDQogICAgLCBjb25maWc6IHsNCiAgICAgICAgLyoNCiAgICAgICAgQHNpemUgICDlsLrlr7jmnIlzbWFsbCxiaWcsbGFyZ2UNCiAgICAgICAgKi8NCiAgICAgICAgaml0U2l6ZTogJ3NtYWxsJw0KICAgIH0NCiAgICAsIGNvbnN0cnVjdG9yOiBmdW5jdGlvbiAoY2ZnKSB7DQogICAgICAgIC8v5a6a5LmJ6buY6K6k6YWN572uDQogICAgICAgIHZhciBkZWZhdWx0Q29uZmlnID0gew0KICAgICAgICAgICAgY2xvc2VhYmxlOiB0cnVlDQogICAgICAgICAgICAsIGNsb3NlQWN0aW9uOiAnaGlkZScNCiAgICAgICAgICAgICwgbW9kYWw6ICd0cnVlJw0KICAgICAgICAgICAgLCByZXNpemFibGU6IGZhbHNlDQogICAgICAgIH07DQogICAgICAgIC8v6Ieq5bex55qE6YWN572u6aG55aSE55CGDQogICAgICAgIHZhciBjZmcgPSBFeHQuYXBwbHlJZihjZmcsIHsNCiAgICAgICAgICAgIGppdFNpemU6ICdzbWFsbCcNCiAgICAgICAgfSk7DQogICAgICAgIGlmIChjZmcuaml0U2l6ZSkgew0KICAgICAgICAgICAgdmFyIGppdFNpemUgPSBjZmcuaml0U2l6ZS50b1N0cmluZygpLnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICBzd2l0Y2ggKGppdFNpemUpIHsNCiAgICAgICAgICAgICAgICBjYXNlICdzbWFsbCc6DQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRDb25maWcud2lkdGggPSAzMDA7DQogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0Q29uZmlnLmhlaWdodCA9IDE1MDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlICdiaWcnOg0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0Q29uZmlnLndpZHRoID0gNjgwOw0KICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdENvbmZpZy5oZWlnaHQgPSAyNTA7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSAnbGFyZ2UnOg0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0Q29uZmlnLndpZHRoID0gOTAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdENvbmZpZy5oZWlnaHQgPSA0MDA7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgLy/lkIjlubbphY3nva7pobkNCiAgICAgICAgY2ZnID0gRXh0LmFwcGx5SWYoY2ZnLCBkZWZhdWx0Q29uZmlnKTsNCiAgICAgICAgLy/liJ3lp4vljJbphY3nva7pobkNCiAgICAgICAgdGhpcy5pbml0Q29uZmlnKGNmZyk7DQogICAgICAgIC8v6LCD55So54i257G76L+b6KGM5Yid5aeL5YyWDQogICAgICAgIHRoaXMuY2FsbFBhcmVudChhcmd1bWVudHMpOw0KICAgIH0NCn0pOw==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>