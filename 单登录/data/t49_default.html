$(function () {
    $("#BtnDeleteMap").click(function () {
        window.frames['Ifcenter'].deleteMap();
    });

    $("#BtnViewSet").click(function () {
        if (document.getElementById(divID)) {
            $("#" + divID).show();
        }
        else {
            $(document.body).append(divID_HTML);
            $.get("/web/ViewSet.htm?date=" + (Math.random()), function (res) {
                viewSetHTML = res;

                $("#" + divID).html(viewSetHTML);
                $("#" + divID).show();

                $("#" + divID).mousemove(function () {
                    $("#" + divID).show();
                    try {
                        clearTimeout(hideview);
                    }
                    catch (e) {

                    }
                });
                $("#" + divID).mouseout(function () { hideView(); });
            })
        }
        setPosition(divID, document.getElementById("BtnViewSet"));
    });
    
    $("#BtnFullScreen").click(function () {
        fullScreen = fullScreen == true ? false : true;
        $("#imgFull").attr("src", (fullScreen == true ? "/images/icon10.png" : "/images/icon10.jpg"))
        $("#spFull").html((fullScreen == true ? "退出全屏" : "全屏"));
        if (fullScreen) {
            $(".content").height($(window).height() - 2).width($(window).width() - 5);
            $("#Ifcenter").height($(window).height() - 40).width($(window).width() - 5);
//            alert("width:" + window.frames['Ifcenter'].index.width + "    height:" + window.frames['Ifcenter'].index.height);
        }
        else {
            $(".content").height("540px");
            $(".content").width("1001px");
            $("#Ifcenter").height("500px");
            $("#Ifcenter").width("999px");
        }
    });
});

var fullScreen = false;

var divID = "divViewSet";
var divID_HTML = "<div id=\"" + divID + "\" class=\"xlk\"></div>";
var viewSetHTML = "";
function setPosition(div, obj)//set compare 
{
    var oRect = obj.getBoundingClientRect();
    var globalleft = oRect.left + $(document).scrollLeft();
    var globaltop = oRect.top + $(document).scrollTop() + obj.offsetHeight;
    $("#" + div).css({ "top": globaltop, "left": globalleft, "position": "absolute", "z-index": "100", "display": "block" });
    try {
        clearTimeout(hideview);
    }
    catch (e) {

    }
}
var hideview;
function hideView() {
    hideview=setTimeout(function () { $("#" + divID).hide(); }, 500);
}

//显示设置
var bgvalue = false;
var numvalue = false;
var wordvalue = true;
function callViewSet(type) {
    if (type == "bgvalue") {
        bgvalue = (bgvalue == true ? false : true);
        $("#spBg").html((bgvalue == true ? "隐藏" : "显示"));
        //spBg spNum spWord
    }
    if (type == "numvalue") {
        numvalue = (numvalue == true ? false : true);
        $("#spNum").html((numvalue == true ? "隐藏" : "显示"));
    }
    if (type == "wordvalue") {
        wordvalue = (wordvalue == true ? false : true);
        $("#spWord").html((wordvalue == true ? "隐藏" : "显示"));
    }
    window.frames['Ifcenter'].viewSet({ "bgvalue": bgvalue, "numvalue": numvalue, "wordvalue": wordvalue });
}

//显示数据
function showData() {
    if (w_editWin.isVisible()) {
        //loadData();
    }
    else {
        w_editWin.show();
    }
    //loadData();
}

var kpiid;
var kpitype;
//保存数据
function saveData(kpiId, layertype, data) {
    
    var type = "";
    if (layertype != "") {
        type = layertype.substring(layertype.indexOf("layer_") + 6, layertype.indexOf("layer_") + 7);
        type = parseInt(type);
    }
    kpiid = kpiId;
    kpitype = type;
    if (type == 4 && bgvalue == false) {
        callViewSet('bgvalue');
    }
//    if(kpiId==1034)
//    { return; }
    //ajax serviceHandler  存储xml文件
    $.post("/web/ServiceHandler.ashx?type=savedata",
    {
        data: escape(data),
        r: Math.random
    },
    function (res) {
        if (res == "success") {
            //alert(res);
            try {
                if (grid != null && grid != "undefined") {
                    loadData(kpiId, type);
                }
            }
            catch (e) { }
        }
    });
}

//导出地图
function exportMap() {
    window.frames['Ifcenter'].exportMap();
}
function generatMap(data) {
    //window.open("/web/ServiceHandler.ashx?type=exportmap&data=" + data);
    $.post("/web/ServiceHandler.ashx?type=exportmap",
    {
        data: data,
        r: Math.random
    },
    function (res) {
        if (res == "success") {
            //alert(res);
        }
    });
}


//导出数据
function exportData() {
    var _url = '/web/ServiceHandler.ashx?type=exportdata&kpiid=' + kpiid + "&kpitype=" + kpitype;
    window.open(_url, '_blank', 'width=1,height=1,toolbar=no,menubar=no,location=no');
}

//创建地图
function renderKPI(kpi) {
    window.frames['Ifcenter'].renderKPI(kpi);
}

function dataSearch(ids) {
    window.frames['Ifcenter'].dataSearch(ids);
}