<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="136">
  <HTTPTask id="229" hostname="180.153.154.42" path="/Framework/javascript/other/fancybox/jquery.fancybox-1.3.1.js" url="http://180.153.154.42/Framework/javascript/other/fancybox/jquery.fancybox-1.3.1.js" ip="180.153.154.42" port="80" connectionId="33" origin="Primary" frame="1" startTime="95200358" endTime="95200390">
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Accept" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YXBwbGljYXRpb24vamF2YXNjcmlwdCwgKi8qO3E9MC44</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Referer" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cDovLzE4MC4xNTMuMTU0LjQyL01vZHVsZS9WaXNpdGluZ0RhdGEvcGhvdG8vVGFza0RhdGFwaG90by5hc3B4P21pZD0zNjQ3MDM0My1kNjVkLTQ4ODMtYTRiNC0zYzdjYjdmMjM2NjgmVmlzaXRpbmdUYXNrSUQ9ZDkzODViZGMtNTMyZC00YTk0LWEzOTgtZGZmOWI1ZjdlZTRmJlZpc2l0aW5nVGFza1N0ZXBJRD1udWxsJlZpc2l0aW5nVGFza05hbWU9JXU1REU1JXU0RjVDJXU0RUZCJXU1MkExJlN0ZXBOYW1lPSV1OEZEQiV1NTFGQSV1NUU5Nw==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>emgtQ04=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKGNvbXBhdGlibGU7IE1TSUUgOS4wOyBXaW5kb3dzIE5UIDYuMTsgV09XNjQ7IFRyaWRlbnQvNS4wKQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Host" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MTgwLjE1My4xNTQuNDI=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>S2VlcC1BbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Q0NDSktMRkFKVUlPUlc9azFNK0w5QlcrZHlBQlROdzF6d0p6UT09OyBDV1JXUUZBSktMVU9JTD0vdERYSmMvWVJ5dGx4N24vR0dnNmdnPT07IEFTUC5ORVRfU2Vzc2lvbklkPWI0aDEyaTBpNXBka211b3oycGJienN1aw==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC9GcmFtZXdvcmsvamF2YXNjcmlwdC9vdGhlci9mYW5jeWJveC9qcXVlcnkuZmFuY3lib3gtMS4zLjEuanMgSFRUUC8xLjENCkFjY2VwdDogYXBwbGljYXRpb24vamF2YXNjcmlwdCwgKi8qO3E9MC44DQpSZWZlcmVyOiBodHRwOi8vMTgwLjE1My4xNTQuNDIvTW9kdWxlL1Zpc2l0aW5nRGF0YS9waG90by9UYXNrRGF0YXBob3RvLmFzcHg/bWlkPTM2NDcwMzQzLWQ2NWQtNDg4My1hNGI0LTNjN2NiN2YyMzY2OCZWaXNpdGluZ1Rhc2tJRD1kOTM4NWJkYy01MzJkLTRhOTQtYTM5OC1kZmY5YjVmN2VlNGYmVmlzaXRpbmdUYXNrU3RlcElEPW51bGwmVmlzaXRpbmdUYXNrTmFtZT0ldTVERTUldTRGNUMldTRFRkIldTUyQTEmU3RlcE5hbWU9JXU4RkRCJXU1MUZBJXU1RTk3DQpBY2NlcHQtTGFuZ3VhZ2U6IHpoLUNODQpVc2VyLUFnZW50OiBNb3ppbGxhLzUuMCAoY29tcGF0aWJsZTsgTVNJRSA5LjA7IFdpbmRvd3MgTlQgNi4xOyBXT1c2NDsgVHJpZGVudC81LjApDQpBY2NlcHQtRW5jb2Rpbmc6IGd6aXAsIGRlZmxhdGUNCkhvc3Q6IDE4MC4xNTMuMTU0LjQyDQpDb25uZWN0aW9uOiBLZWVwLUFsaXZlDQpDb29raWU6IENDQ0pLTEZBSlVJT1JXPWsxTStMOUJXK2R5QUJUTncxendKelE9PTsgQ1dSV1FGQUpLTFVPSUw9L3REWEpjL1lSeXRseDduL0dHZzZnZz09OyBBU1AuTkVUX1Nlc3Npb25JZD1iNGgxMmkwaTVwZGttdW96MnBiYnpzdWsNCg0K</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="CCCJKLFAJUIORW" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>azFNK0w5QlcrZHlBQlROdzF6d0p6UT09</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="CWRWQFAJKLUOIL" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>L3REWEpjL1lSeXRseDduL0dHZzZnZz09</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ASP.NET_SessionId" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>YjRoMTJpMGk1cGRrbXVvejJwYmJ6c3Vr</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Content-Type" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YXBwbGljYXRpb24veC1qYXZhc2NyaXB0</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Encoding" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Last-Modified" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>RnJpLCAzMSBNYXkgMjAxMyAwMjoyMTozNiBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Ranges" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ynl0ZXM=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="ETag" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>IjE0YTliMTkzYTU1ZGNlMTowIg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Vary" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWNjZXB0LUVuY29kaW5n</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Server" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TWljcm9zb2Z0LUlJUy83LjU=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-Powered-By" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QVNQLk5FVA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>VHVlLCAwOSBKdWwgMjAxMyAwOTowNDowOSBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Length" index="9">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>OTk5MA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL3gtamF2YXNjcmlwdA0KQ29udGVudC1FbmNvZGluZzogZ3ppcA0KTGFzdC1Nb2RpZmllZDogRnJpLCAzMSBNYXkgMjAxMyAwMjoyMTozNiBHTVQNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpFVGFnOiAiMTRhOWIxOTNhNTVkY2UxOjAiDQpWYXJ5OiBBY2NlcHQtRW5jb2RpbmcNClNlcnZlcjogTWljcm9zb2Z0LUlJUy83LjUNClgtUG93ZXJlZC1CeTogQVNQLk5FVA0KRGF0ZTogVHVlLCAwOSBKdWwgMjAxMyAwOTowNDowOSBHTVQNCkNvbnRlbnQtTGVuZ3RoOiA5OTkwDQoNCg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>LyoNCiAqIEZhbmN5Qm94IC0galF1ZXJ5IFBsdWdpbg0KICogU2ltcGxlIGFuZCBmYW5jeSBsaWdodGJveCBhbHRlcm5hdGl2ZQ0KICoNCiAqIEV4YW1wbGVzIGFuZCBkb2N1bWVudGF0aW9uIGF0OiBodHRwOi8vZmFuY3lib3gubmV0DQogKiANCiAqIENvcHlyaWdodCAoYykgMjAwOCAtIDIwMTAgSmFuaXMgU2thcm5lbGlzDQogKg0KICogVmVyc2lvbjogMS4zLjEgKDA1LzAzLzIwMTApDQogKiBSZXF1aXJlczogalF1ZXJ5IHYxLjMrDQogKg0KICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGFuZCBHUEwgbGljZW5zZXM6DQogKiAgIGh0dHA6Ly93d3cub3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvbWl0LWxpY2Vuc2UucGhwDQogKiAgIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9ncGwuaHRtbA0KICovDQoNCihmdW5jdGlvbiAoJCkgew0KDQogICAgdmFyIHRtcCwgbG9hZGluZywgb3ZlcmxheSwgd3JhcCwgb3V0ZXIsIGlubmVyLCBjbG9zZSwgbmF2X2xlZnQsIG5hdl9yaWdodCwNCg0KCQlzZWxlY3RlZEluZGV4ID0gMCwgc2VsZWN0ZWRPcHRzID0ge30sIHNlbGVjdGVkQXJyYXkgPSBbXSwgY3VycmVudEluZGV4ID0gMCwgY3VycmVudE9wdHMgPSB7fSwgY3VycmVudEFycmF5ID0gW10sDQoNCgkJYWpheExvYWRlciA9IG51bGwsIGltZ1ByZWxvYWRlciA9IG5ldyBJbWFnZSgpLCBpbWdSZWdFeHAgPSAvXC4oanBnfGdpZnxwbmd8Ym1wfGpwZWcpKC4qKT8kL2ksIHN3ZlJlZ0V4cCA9IC9bXlwuXVwuKHN3ZilccyokL2ksDQoNCgkJbG9hZGluZ1RpbWVyLCBsb2FkaW5nRnJhbWUgPSAxLA0KDQoJCXN0YXJ0X3BvcywgZmluYWxfcG9zLCBidXN5ID0gZmFsc2UsIHNoYWRvdyA9IDIwLCBmeCA9ICQuZXh0ZW5kKCQoJzxkaXYvPicpWzBdLCB7IHByb3A6IDAgfSksIHRpdGxlaCA9IDAsDQoNCgkJaXNJRTYgPSAhJC5zdXBwb3J0Lm9wYWNpdHkgJiYgIXdpbmRvdy5YTUxIdHRwUmVxdWVzdCwNCg0KICAgIC8qDQogICAgKiBQcml2YXRlIG1ldGhvZHMgDQogICAgKi8NCg0KCQlmYW5jeWJveF9hYm9ydCA9IGZ1bmN0aW9uICgpIHsNCgkJICAgIGxvYWRpbmcuaGlkZSgpOw0KDQoJCSAgICBpbWdQcmVsb2FkZXIub25lcnJvciA9IGltZ1ByZWxvYWRlci5vbmxvYWQgPSBudWxsOw0KDQoJCSAgICBpZiAoYWpheExvYWRlcikgew0KCQkgICAgICAgIGFqYXhMb2FkZXIuYWJvcnQoKTsNCgkJICAgIH0NCg0KCQkgICAgdG1wLmVtcHR5KCk7DQoJCX0sDQoNCgkJZmFuY3lib3hfZXJyb3IgPSBmdW5jdGlvbiAoKSB7DQoJCSAgICAkLmZhbmN5Ym94KCc8cCBpZD0iZmFuY3lib3hfZXJyb3IiPs28xqy809TYyqew3KOsx+vJ1Lrz1NnK1KGjPC9wPicsIHsNCgkJICAgICAgICAnc2Nyb2xsaW5nJzogJ25vJywNCgkJICAgICAgICAncGFkZGluZyc6IDIwLA0KCQkgICAgICAgICd0cmFuc2l0aW9uSW4nOiAnbm9uZScsDQoJCSAgICAgICAgJ3RyYW5zaXRpb25PdXQnOiAnbm9uZScNCgkJICAgIH0pOw0KCQl9LA0KDQoJCWZhbmN5Ym94X2dldF92aWV3cG9ydCA9IGZ1bmN0aW9uICgpIHsNCgkJICAgIHJldHVybiBbJCh3aW5kb3cpLndpZHRoKCksICQod2luZG93KS5oZWlnaHQoKSwgJChkb2N1bWVudCkuc2Nyb2xsTGVmdCgpLCAkKGRvY3VtZW50KS5zY3JvbGxUb3AoKV07DQoJCX0sDQoNCgkJZmFuY3lib3hfZ2V0X3pvb21fdG8gPSBmdW5jdGlvbiAoKSB7DQoJCSAgICB2YXIgdmlldyA9IGZhbmN5Ym94X2dldF92aWV3cG9ydCgpLA0KCQkJCXRvID0ge30sDQoNCgkJCQltYXJnaW4gPSBjdXJyZW50T3B0cy5tYXJnaW4sDQoJCQkJcmVzaXplID0gY3VycmVudE9wdHMuYXV0b1NjYWxlLA0KDQoJCQkJaG9yaXpvbnRhbF9zcGFjZSA9IChzaGFkb3cgKyBtYXJnaW4pICogMiwNCgkJCQl2ZXJ0aWNhbF9zcGFjZSA9IChzaGFkb3cgKyBtYXJnaW4pICogMiwNCgkJCQlkb3VibGVfcGFkZGluZyA9IChjdXJyZW50T3B0cy5wYWRkaW5nICogMiksDQoNCgkJCQlyYXRpbzsNCg0KCQkgICAgaWYgKGN1cnJlbnRPcHRzLndpZHRoLnRvU3RyaW5nKCkuaW5kZXhPZignJScpID4gLTEpIHsNCgkJICAgICAgICB0by53aWR0aCA9ICgodmlld1swXSAqIHBhcnNlRmxvYXQoY3VycmVudE9wdHMud2lkdGgpKSAvIDEwMCkgLSAoc2hhZG93ICogMik7DQoJCSAgICAgICAgcmVzaXplID0gZmFsc2U7DQoNCgkJICAgIH0gZWxzZSB7DQoJCSAgICAgICAgdG8ud2lkdGggPSBjdXJyZW50T3B0cy53aWR0aCArIGRvdWJsZV9wYWRkaW5nOw0KCQkgICAgfQ0KDQoJCSAgICBpZiAoY3VycmVudE9wdHMuaGVpZ2h0LnRvU3RyaW5nKCkuaW5kZXhPZignJScpID4gLTEpIHsNCgkJICAgICAgICB0by5oZWlnaHQgPSAoKHZpZXdbMV0gKiBwYXJzZUZsb2F0KGN1cnJlbnRPcHRzLmhlaWdodCkpIC8gMTAwKSAtIChzaGFkb3cgKiAyKTsNCgkJICAgICAgICByZXNpemUgPSBmYWxzZTsNCg0KCQkgICAgfSBlbHNlIHsNCgkJICAgICAgICB0by5oZWlnaHQgPSBjdXJyZW50T3B0cy5oZWlnaHQgKyBkb3VibGVfcGFkZGluZzsNCgkJICAgIH0NCg0KCQkgICAgaWYgKHJlc2l6ZSAmJiAodG8ud2lkdGggPiAodmlld1swXSAtIGhvcml6b250YWxfc3BhY2UpIHx8IHRvLmhlaWdodCA+ICh2aWV3WzFdIC0gdmVydGljYWxfc3BhY2UpKSkgew0KCQkgICAgICAgIGlmIChzZWxlY3RlZE9wdHMudHlwZSA9PSAnaW1hZ2UnIHx8IHNlbGVjdGVkT3B0cy50eXBlID09ICdzd2YnKSB7DQoJCSAgICAgICAgICAgIGhvcml6b250YWxfc3BhY2UgKz0gZG91YmxlX3BhZGRpbmc7DQoJCSAgICAgICAgICAgIHZlcnRpY2FsX3NwYWNlICs9IGRvdWJsZV9wYWRkaW5nOw0KDQoJCSAgICAgICAgICAgIHJhdGlvID0gTWF0aC5taW4oTWF0aC5taW4odmlld1swXSAtIGhvcml6b250YWxfc3BhY2UsIGN1cnJlbnRPcHRzLndpZHRoKSAvIGN1cnJlbnRPcHRzLndpZHRoLCBNYXRoLm1pbih2aWV3WzFdIC0gdmVydGljYWxfc3BhY2UsIGN1cnJlbnRPcHRzLmhlaWdodCkgLyBjdXJyZW50T3B0cy5oZWlnaHQpOw0KDQoJCSAgICAgICAgICAgIHRvLndpZHRoID0gTWF0aC5yb3VuZChyYXRpbyAqICh0by53aWR0aCAtIGRvdWJsZV9wYWRkaW5nKSkgKyBkb3VibGVfcGFkZGluZzsNCgkJICAgICAgICAgICAgdG8uaGVpZ2h0ID0gTWF0aC5yb3VuZChyYXRpbyAqICh0by5oZWlnaHQgLSBkb3VibGVfcGFkZGluZykpICsgZG91YmxlX3BhZGRpbmc7DQoNCgkJICAgICAgICB9IGVsc2Ugew0KCQkgICAgICAgICAgICB0by53aWR0aCA9IE1hdGgubWluKHRvLndpZHRoLCAodmlld1swXSAtIGhvcml6b250YWxfc3BhY2UpKTsNCgkJICAgICAgICAgICAgdG8uaGVpZ2h0ID0gTWF0aC5taW4odG8uaGVpZ2h0LCAodmlld1sxXSAtIHZlcnRpY2FsX3NwYWNlKSk7DQoJCSAgICAgICAgfQ0KCQkgICAgfQ0KDQoJCSAgICB0by50b3AgPSB2aWV3WzNdICsgKCh2aWV3WzFdIC0gKHRvLmhlaWdodCArIChzaGFkb3cgKiAyKSkpICogMC41KTsNCgkJICAgIHRvLmxlZnQgPSB2aWV3WzJdICsgKCh2aWV3WzBdIC0gKHRvLndpZHRoICsgKHNoYWRvdyAqIDIpKSkgKiAwLjUpOw0KDQoJCSAgICBpZiAoY3VycmVudE9wdHMuYXV0b1NjYWxlID09PSBmYWxzZSkgew0KCQkgICAgICAgIHRvLnRvcCA9IE1hdGgubWF4KHZpZXdbM10gKyBtYXJnaW4sIHRvLnRvcCk7DQoJCSAgICAgICAgdG8ubGVmdCA9IE1hdGgubWF4KHZpZXdbMl0gKyBtYXJnaW4sIHRvLmxlZnQpOw0KCQkgICAgfQ0KCQkgICAgdG8udG9wID0gNTA7DQoJCSAgICB0by5sZWZ0ID0gMjUwOw0KCQkgICAgdG8ud2lkdGggPSA3NTA7DQoJCSAgICB0by5oZWlnaHQgPSA1NTA7DQoJCSAgICByZXR1cm4gdG87DQoJCX0sDQoNCgkJZmFuY3lib3hfZm9ybWF0X3RpdGxlID0gZnVuY3Rpb24gKHRpdGxlKSB7DQoJCSAgICBpZiAodGl0bGUgJiYgdGl0bGUubGVuZ3RoKSB7DQoJCSAgICAgICAgc3dpdGNoIChjdXJyZW50T3B0cy50aXRsZVBvc2l0aW9uKSB7DQoJCSAgICAgICAgICAgIGNhc2UgJ2luc2lkZSc6DQoJCSAgICAgICAgICAgICAgICByZXR1cm4gdGl0bGU7DQoJCSAgICAgICAgICAgIGNhc2UgJ292ZXInOg0KCQkgICAgICAgICAgICAgICAgcmV0dXJuICc8c3BhbiBpZD0iZmFuY3lib3gtdGl0bGUtb3ZlciI+JyArIHRpdGxlICsgJzwvc3Bhbj4nOw0KCQkgICAgICAgICAgICBkZWZhdWx0Og0KCQkgICAgICAgICAgICAgICAgcmV0dXJuICc8c3BhbiBpZD0iZmFuY3lib3gtdGl0bGUtd3JhcCI+PHNwYW4gaWQ9ImZhbmN5Ym94LXRpdGxlLWxlZnQiPjwvc3Bhbj48c3BhbiBpZD0iZmFuY3lib3gtdGl0bGUtbWFpbiI+JyArIHRpdGxlICsgJzwvc3Bhbj48c3BhbiBpZD0iZmFuY3lib3gtdGl0bGUtcmlnaHQiPjwvc3Bhbj48L3NwYW4+JzsNCgkJICAgICAgICB9DQoJCSAgICB9DQoNCgkJICAgIHJldHVybiBmYWxzZTsNCgkJfSwNCg0KCQlmYW5jeWJveF9wcm9jZXNzX3RpdGxlID0gZnVuY3Rpb24gKCkgew0KCQkgICAgdmFyIHRpdGxlID0gY3VycmVudE9wdHMudGl0bGUsDQoJCQkJd2lkdGggPSBmaW5hbF9wb3Mud2lkdGggLSAoY3VycmVudE9wdHMucGFkZGluZyAqIDIpLA0KCQkJCXRpdGxlYyA9ICdmYW5jeWJveC10aXRsZS0nICsgY3VycmVudE9wdHMudGl0bGVQb3NpdGlvbjsNCg0KCQkgICAgJCgnI2ZhbmN5Ym94LXRpdGxlJykucmVtb3ZlKCk7DQoNCgkJICAgIHRpdGxlaCA9IDA7DQoNCgkJICAgIGlmIChjdXJyZW50T3B0cy50aXRsZVNob3cgPT09IGZhbHNlKSB7DQoJCSAgICAgICAgcmV0dXJuOw0KCQkgICAgfQ0KDQoJCSAgICB0aXRsZSA9ICQuaXNGdW5jdGlvbihjdXJyZW50T3B0cy50aXRsZUZvcm1hdCkgPyBjdXJyZW50T3B0cy50aXRsZUZvcm1hdCh0aXRsZSwgY3VycmVudEFycmF5LCBjdXJyZW50SW5kZXgsIGN1cnJlbnRPcHRzKSA6IGZhbmN5Ym94X2Zvcm1hdF90aXRsZSh0aXRsZSk7DQoNCgkJICAgIGlmICghdGl0bGUgfHwgdGl0bGUgPT09ICcnKSB7DQoJCSAgICAgICAgcmV0dXJuOw0KCQkgICAgfQ0KDQoJCSAgICAkKCc8ZGl2IGlkPSJmYW5jeWJveC10aXRsZSIgY2xhc3M9IicgKyB0aXRsZWMgKyAnIiAvPicpLmNzcyh7DQoJCSAgICAgICAgJ3dpZHRoJzogd2lkdGgsDQoJCSAgICAgICAgJ3BhZGRpbmdMZWZ0JzogY3VycmVudE9wdHMucGFkZGluZywNCgkJICAgICAgICAncGFkZGluZ1JpZ2h0JzogY3VycmVudE9wdHMucGFkZGluZw0KCQkgICAgfSkuaHRtbCh0aXRsZSkuYXBwZW5kVG8oJ2JvZHknKTsNCg0KCQkgICAgc3dpdGNoIChjdXJyZW50T3B0cy50aXRsZVBvc2l0aW9uKSB7DQoJCSAgICAgICAgY2FzZSAnaW5zaWRlJzoNCgkJICAgICAgICAgICAgdGl0bGVoID0gJCgiI2ZhbmN5Ym94LXRpdGxlIikub3V0ZXJIZWlnaHQodHJ1ZSkgLSBjdXJyZW50T3B0cy5wYWRkaW5nOw0KCQkgICAgICAgICAgICBmaW5hbF9wb3MuaGVpZ2h0ICs9IHRpdGxlaDsNCgkJICAgICAgICAgICAgYnJlYWs7DQoNCgkJICAgICAgICBjYXNlICdvdmVyJzoNCgkJICAgICAgICAgICAgJCgnI2ZhbmN5Ym94LXRpdGxlJykuY3NzKCdib3R0b20nLCBjdXJyZW50T3B0cy5wYWRkaW5nKTsNCgkJICAgICAgICAgICAgYnJlYWs7DQoNCgkJICAgICAgICBkZWZhdWx0Og0KCQkgICAgICAgICAgICAkKCcjZmFuY3lib3gtdGl0bGUnKS5jc3MoJ2JvdHRvbScsICQoIiNmYW5jeWJveC10aXRsZSIpLm91dGVySGVpZ2h0KHRydWUpICogLTEpOw0KCQkgICAgICAgICAgICBicmVhazsNCgkJICAgIH0NCg0KCQkgICAgJCgnI2ZhbmN5Ym94LXRpdGxlJykuYXBwZW5kVG8ob3V0ZXIpLmhpZGUoKTsNCgkJfSwNCg0KCQlmYW5jeWJveF9zZXRfbmF2aWdhdGlvbiA9IGZ1bmN0aW9uICgpIHsNCgkJICAgICQoZG9jdW1lbnQpLnVuYmluZCgna2V5ZG93bi5mYicpLmJpbmQoJ2tleWRvd24uZmInLCBmdW5jdGlvbiAoZSkgew0KCQkgICAgICAgIGlmIChlLmtleUNvZGUgPT0gMjcgJiYgY3VycmVudE9wdHMuZW5hYmxlRXNjYXBlQnV0dG9uKSB7DQoJCSAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCgkJICAgICAgICAgICAgJC5mYW5jeWJveC5jbG9zZSgpOw0KDQoJCSAgICAgICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT0gMzcpIHsNCgkJICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkgICAgICAgICAgICAkLmZhbmN5Ym94LnByZXYoKTsNCg0KCQkgICAgICAgIH0gZWxzZSBpZiAoZS5rZXlDb2RlID09IDM5KSB7DQoJCSAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCgkJICAgICAgICAgICAgJC5mYW5jeWJveC5uZXh0KCk7DQoJCSAgICAgICAgfQ0KCQkgICAgfSk7DQoNCgkJICAgIGlmICgkLmZuLm1vdXNld2hlZWwpIHsNCgkJICAgICAgICB3cmFwLnVuYmluZCgnbW91c2V3aGVlbC5mYicpOw0KDQoJCSAgICAgICAgaWYgKGN1cnJlbnRBcnJheS5sZW5ndGggPiAxKSB7DQoJCSAgICAgICAgICAgIHdyYXAuYmluZCgnbW91c2V3aGVlbC5mYicsIGZ1bmN0aW9uIChlLCBkZWx0YSkgew0KCQkgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KDQoJCSAgICAgICAgICAgICAgICBpZiAoYnVzeSB8fCBkZWx0YSA9PT0gMCkgew0KCQkgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCgkJICAgICAgICAgICAgICAgIH0NCg0KCQkgICAgICAgICAgICAgICAgaWYgKGRlbHRhID4gMCkgew0KCQkgICAgICAgICAgICAgICAgICAgICQuZmFuY3lib3gucHJldigpOw0KCQkgICAgICAgICAgICAgICAgfSBlbHNlIHsNCgkJICAgICAgICAgICAgICAgICAgICAkLmZhbmN5Ym94Lm5leHQoKTsNCgkJICAgICAgICAgICAgICAgIH0NCgkJICAgICAgICAgICAgfSk7DQoJCSAgICAgICAgfQ0KCQkgICAgfQ0KDQoJCSAgICBpZiAoIWN1cnJlbnRPcHRzLnNob3dOYXZBcnJvd3MpIHsgcmV0dXJuOyB9DQoNCgkJICAgIGlmICgoY3VycmVudE9wdHMuY3ljbGljICYmIGN1cnJlbnRBcnJheS5sZW5ndGggPiAxKSB8fCBjdXJyZW50SW5kZXggIT09IDApIHsNCgkJICAgICAgICBuYXZfbGVmdC5zaG93KCk7DQoJCSAgICB9DQoNCgkJICAgIGlmICgoY3VycmVudE9wdHMuY3ljbGljICYmIGN1cnJlbnRBcnJheS5sZW5ndGggPiAxKSB8fCBjdXJyZW50SW5kZXggIT0gKGN1cnJlbnRBcnJheS5sZW5ndGggLSAxKSkgew0KCQkgICAgICAgIG5hdl9yaWdodC5zaG93KCk7DQoJCSAgICB9DQoJCX0sDQoNCgkJZmFuY3lib3hfcHJlbG9hZF9pbWFnZXMgPSBmdW5jdGlvbiAoKSB7DQoJCSAgICB2YXIgaHJlZiwNCgkJCQlvYmpOZXh0Ow0KDQoJCSAgICBpZiAoKGN1cnJlbnRBcnJheS5sZW5ndGggLSAxKSA+IGN1cnJlbnRJbmRleCkgew0KCQkgICAgICAgIGhyZWYgPSBjdXJyZW50QXJyYXlbY3VycmVudEluZGV4ICsgMV0uaHJlZjsNCg0KCQkgICAgICAgIGlmICh0eXBlb2YgaHJlZiAhPT0gJ3VuZGVmaW5lZCcgJiYgaHJlZi5tYXRjaChpbWdSZWdFeHApKSB7DQoJCSAgICAgICAgICAgIG9iak5leHQgPSBuZXcgSW1hZ2UoKTsNCgkJICAgICAgICAgICAgb2JqTmV4dC5zcmMgPSBocmVmOw0KCQkgICAgICAgIH0NCgkJICAgIH0NCg0KCQkgICAgaWYgKGN1cnJlbnRJbmRleCA+IDApIHsNCgkJICAgICAgICBocmVmID0gY3VycmVudEFycmF5W2N1cnJlbnRJbmRleCAtIDFdLmhyZWY7DQoNCgkJICAgICAgICBpZiAodHlwZW9mIGhyZWYgIT09ICd1bmRlZmluZWQnICYmIGhyZWYubWF0Y2goaW1nUmVnRXhwKSkgew0KCQkgICAgICAgICAgICBvYmpOZXh0ID0gbmV3IEltYWdlKCk7DQoJCSAgICAgICAgICAgIG9iak5leHQuc3JjID0gaHJlZjsNCgkJICAgICAgICB9DQoJCSAgICB9DQoJCX0sDQoNCgkJX2ZpbmlzaCA9IGZ1bmN0aW9uICgpIHsNCgkJICAgIGlubmVyLmNzcygnb3ZlcmZsb3cnLCAoY3VycmVudE9wdHMuc2Nyb2xsaW5nID09ICdhdXRvJyA/IChjdXJyZW50T3B0cy50eXBlID09ICdpbWFnZScgfHwgY3VycmVudE9wdHMudHlwZSA9PSAnaWZyYW1lJyB8fCBjdXJyZW50T3B0cy50eXBlID09ICdzd2YnID8gJ2hpZGRlbicgOiAnYXV0bycpIDogKGN1cnJlbnRPcHRzLnNjcm9sbGluZyA9PSAneWVzJyA/ICdhdXRvJyA6ICd2aXNpYmxlJykpKTsNCg0KCQkgICAgaWYgKCEkLnN1cHBvcnQub3BhY2l0eSkgew0KCQkgICAgICAgIGlubmVyLmdldCgwKS5zdHlsZS5yZW1vdmVBdHRyaWJ1dGUoJ2ZpbHRlcicpOw0KCQkgICAgICAgIHdyYXAuZ2V0KDApLnN0eWxlLnJlbW92ZUF0dHJpYnV0ZSgnZmlsdGVyJyk7DQoJCSAgICB9DQoNCgkJICAgICQoJyNmYW5jeWJveC10aXRsZScpLnNob3coKTsNCg0KCQkgICAgaWYgKGN1cnJlbnRPcHRzLmhpZGVPbkNvbnRlbnRDbGljaykgew0KCQkgICAgICAgIGlubmVyLm9uZSgnY2xpY2snLCAkLmZhbmN5Ym94LmNsb3NlKTsNCgkJICAgIH0NCgkJICAgIGlmIChjdXJyZW50T3B0cy5oaWRlT25PdmVybGF5Q2xpY2spIHsNCgkJICAgICAgICBvdmVybGF5Lm9uZSgnY2xpY2snLCAkLmZhbmN5Ym94LmNsb3NlKTsNCgkJICAgIH0NCg0KCQkgICAgaWYgKGN1cnJlbnRPcHRzLnNob3dDbG9zZUJ1dHRvbikgew0KCQkgICAgICAgIGNsb3NlLnNob3coKTsNCgkJICAgIH0NCg0KCQkgICAgZmFuY3lib3hfc2V0X25hdmlnYXRpb24oKTsNCg0KCQkgICAgJCh3aW5kb3cpLmJpbmQoInJlc2l6ZS5mYiIsICQuZmFuY3lib3guY2VudGVyKTsNCg0KCQkgICAgaWYgKGN1cnJlbnRPcHRzLmNlbnRlck9uU2Nyb2xsKSB7DQoJCSAgICAgICAgJCh3aW5kb3cpLmJpbmQoInNjcm9sbC5mYiIsICQuZmFuY3lib3guY2VudGVyKTsNCgkJICAgIH0gZWxzZSB7DQoJCSAgICAgICAgJCh3aW5kb3cpLnVuYmluZCgic2Nyb2xsLmZiIik7DQoJCSAgICB9DQoNCgkJICAgIGlmICgkLmlzRnVuY3Rpb24oY3VycmVudE9wdHMub25Db21wbGV0ZSkpIHsNCgkJICAgICAgICBjdXJyZW50T3B0cy5vbkNvbXBsZXRlKGN1cnJlbnRBcnJheSwgY3VycmVudEluZGV4LCBjdXJyZW50T3B0cyk7DQoJCSAgICB9DQoNCgkJICAgIGJ1c3kgPSBmYWxzZTsNCg0KCQkgICAgZmFuY3lib3hfcHJlbG9hZF9pbWFnZXMoKTsNCgkJfSwNCg0KCQlmYW5jeWJveF9kcmF3ID0gZnVuY3Rpb24gKHBvcykgew0KCQkgICAgLy8JCSAgICB2YXIgd2lkdGggPSBNYXRoLnJvdW5kKHN0YXJ0X3Bvcy53aWR0aCArIChmaW5hbF9wb3Mud2lkdGggLSBzdGFydF9wb3Mud2lkdGgpICogcG9zKSwNCgkJICAgIC8vCQkJCWhlaWdodCA9IE1hdGgucm91bmQoc3RhcnRfcG9zLmhlaWdodCArIChmaW5hbF9wb3MuaGVpZ2h0IC0gc3RhcnRfcG9zLmhlaWdodCkgKiBwb3MpLA0KDQoJCSAgICAvLwkJCQl0b3AgPSBNYXRoLnJvdW5kKHN0YXJ0X3Bvcy50b3AgKyAoZmluYWxfcG9zLnRvcCAtIHN0YXJ0X3Bvcy50b3ApICogcG9zKSwNCgkJICAgIC8vCQkJCWxlZnQgPSBNYXRoLnJvdW5kKHN0YXJ0X3Bvcy5sZWZ0ICsgKGZpbmFsX3Bvcy5sZWZ0IC0gc3RhcnRfcG9zLmxlZnQpICogcG9zKTsNCgkJICAgIHdpZHRoID0gJzc1MCc7DQoJCSAgICBoZWlnaHQgPSAnNTUwJzsNCgkJICAgIHRvcCA9ICc1MCc7DQoJCSAgICBsZWZ0ID0gJzIzMCc7DQoJCSAgICB3cmFwLmNzcyh7DQoJCSAgICAgICAgJ3dpZHRoJzogd2lkdGggKyAncHgnLA0KCQkgICAgICAgICdoZWlnaHQnOiBoZWlnaHQgKyAncHgnLA0KCQkgICAgICAgICd0b3AnOiB0b3AgKyAncHgnLA0KCQkgICAgICAgICdsZWZ0JzogbGVmdCArICdweCcsDQoJCSAgICAgICAgJ3RleHQtYWxpZ24nOiAnY2VudGVyJywNCgkJICAgICAgICAnbWFyZ2luJzogJzIwcHgnLA0KCQkgICAgICAgICdwYWRkaW5nJzogJzBweCcNCgkJICAgIH0pOw0KDQoJCSAgICAvLyB3aWR0aCA9IE1hdGgubWF4KHdpZHRoIC0gY3VycmVudE9wdHMucGFkZGluZyAqIDIsIDApOw0KCQkgICAgLy8gaGVpZ2h0ID0gTWF0aC5tYXgoaGVpZ2h0IC0gKGN1cnJlbnRPcHRzLnBhZGRpbmcgKiAyICsgKHRpdGxlaCAqIHBvcykpLCAwKTsNCg0KCQkgICAgLy8JCSAgICBpbm5lci5jc3Moew0KCQkgICAgLy8JCSAgICAgICAgJ3dpZHRoJzogd2lkdGggKyAncHgnLA0KCQkgICAgLy8JCSAgICAgICAgJ2hlaWdodCc6IGhlaWdodCArICdweCcNCgkJICAgIC8vCQkgICAgfSk7DQoNCgkJICAgIGlmICh0eXBlb2YgZmluYWxfcG9zLm9wYWNpdHkgIT09ICd1bmRlZmluZWQnKSB7DQoJCSAgICAgICAgd3JhcC5jc3MoJ29wYWNpdHknLCAocG9zIDwgMC41ID8gMC41IDogcG9zKSk7DQoJCSAgICB9DQoJCX0sDQoNCgkJZmFuY3lib3hfZ2V0X29ial9wb3MgPSBmdW5jdGlvbiAob2JqKSB7DQoJCSAgICB2YXIgcG9zID0gb2JqLm9mZnNldCgpOw0KDQoJCSAgICBwb3MudG9wICs9IHBhcnNlRmxvYXQob2JqLmNzcygncGFkZGluZ1RvcCcpKSB8fCAwOw0KCQkgICAgcG9zLmxlZnQgKz0gcGFyc2VGbG9hdChvYmouY3NzKCdwYWRkaW5nTGVmdCcpKSB8fCAwOw0KDQoJCSAgICBwb3MudG9wICs9IHBhcnNlRmxvYXQob2JqLmNzcygnYm9yZGVyLXRvcC13aWR0aCcpKSB8fCAwOw0KCQkgICAgcG9zLmxlZnQgKz0gcGFyc2VGbG9hdChvYmouY3NzKCdib3JkZXItbGVmdC13aWR0aCcpKSB8fCAwOw0KDQoJCSAgICBwb3Mud2lkdGggPSBvYmoud2lkdGgoKTsNCgkJICAgIHBvcy5oZWlnaHQgPSBvYmouaGVpZ2h0KCk7DQoNCgkJICAgIHJldHVybiBwb3M7DQoJCX0sDQoNCgkJZmFuY3lib3hfZ2V0X3pvb21fZnJvbSA9IGZ1bmN0aW9uICgpIHsNCgkJICAgIHZhciBvcmlnID0gc2VsZWN0ZWRPcHRzLm9yaWcgPyAkKHNlbGVjdGVkT3B0cy5vcmlnKSA6IGZhbHNlLA0KCQkJCWZyb20gPSB7fSwNCgkJCQlwb3MsDQoJCQkJdmlldzsNCg0KCQkgICAgaWYgKG9yaWcgJiYgb3JpZy5sZW5ndGgpIHsNCgkJICAgICAgICBwb3MgPSBmYW5jeWJveF9nZXRfb2JqX3BvcyhvcmlnKTsNCg0KCQkgICAgICAgIGZyb20gPSB7DQoJCSAgICAgICAgICAgIHdpZHRoOiAocG9zLndpZHRoICsgKGN1cnJlbnRPcHRzLnBhZGRpbmcgKiAyKSksDQoJCSAgICAgICAgICAgIGhlaWdodDogKHBvcy5oZWlnaHQgKyAoY3VycmVudE9wdHMucGFkZGluZyAqIDIpKSwNCgkJICAgICAgICAgICAgdG9wOiAocG9zLnRvcCAtIGN1cnJlbnRPcHRzLnBhZGRpbmcgLSBzaGFkb3cpLA0KCQkgICAgICAgICAgICBsZWZ0OiAocG9zLmxlZnQgLSBjdXJyZW50T3B0cy5wYWRkaW5nIC0gc2hhZG93KQ0KCQkgICAgICAgIH07DQoNCgkJICAgIH0gZWxzZSB7DQoJCSAgICAgICAgdmlldyA9IGZhbmN5Ym94X2dldF92aWV3cG9ydCgpOw0KDQoJCSAgICAgICAgZnJvbSA9IHsNCgkJICAgICAgICAgICAgd2lkdGg6IDEsDQoJCSAgICAgICAgICAgIGhlaWdodDogMSwNCgkJICAgICAgICAgICAgdG9wOiB2aWV3WzNdICsgdmlld1sxXSAqIDAuNSwNCgkJICAgICAgICAgICAgbGVmdDogdmlld1syXSArIHZpZXdbMF0gKiAwLjUNCgkJICAgICAgICB9Ow0KCQkgICAgfQ0KDQoJCSAgICByZXR1cm4gZnJvbTsNCgkJfSwNCg0KCQlmYW5jeWJveF9zaG93ID0gZnVuY3Rpb24gKCkgew0KCQkgICAgbG9hZGluZy5oaWRlKCk7DQoNCgkJICAgIGlmICh3cmFwLmlzKCI6dmlzaWJsZSIpICYmICQuaXNGdW5jdGlvbihjdXJyZW50T3B0cy5vbkNsZWFudXApKSB7DQoJCSAgICAgICAgaWYgKGN1cnJlbnRPcHRzLm9uQ2xlYW51cChjdXJyZW50QXJyYXksIGN1cnJlbnRJbmRleCwgY3VycmVudE9wdHMpID09PSBmYWxzZSkgew0KCQkgICAgICAgICAgICAkLmV2ZW50LnRyaWdnZXIoJ2ZhbmN5Ym94LWNhbmNlbCcpOw0KDQoJCSAgICAgICAgICAgIGJ1c3kgPSBmYWxzZTsNCgkJICAgICAgICAgICAgcmV0dXJuOw0KCQkgICAgICAgIH0NCgkJICAgIH0NCg0KCQkgICAgY3VycmVudEFycmF5ID0gc2VsZWN0ZWRBcnJheTsNCgkJICAgIGN1cnJlbnRJbmRleCA9IHNlbGVjdGVkSW5kZXg7DQoJCSAgICBjdXJyZW50T3B0cyA9IHNlbGVjdGVkT3B0czsNCg0KCQkgICAgaW5uZXIuZ2V0KDApLnNjcm9sbFRvcCA9IDA7DQoJCSAgICBpbm5lci5nZXQoMCkuc2Nyb2xsTGVmdCA9IDA7DQoNCgkJICAgIGlmIChjdXJyZW50T3B0cy5vdmVybGF5U2hvdykgew0KCQkgICAgICAgIGlmIChpc0lFNikgew0KCQkgICAgICAgICAgICAkKCdzZWxlY3Q6bm90KCNmYW5jeWJveC10bXAgc2VsZWN0KScpLmZpbHRlcihmdW5jdGlvbiAoKSB7DQoJCSAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdHlsZS52aXNpYmlsaXR5ICE9PSAnaGlkZGVuJzsNCgkJICAgICAgICAgICAgfSkuY3NzKHsgJ3Zpc2liaWxpdHknOiAnaGlkZGVuJyB9KS5vbmUoJ2ZhbmN5Ym94LWNsZWFudXAnLCBmdW5jdGlvbiAoKSB7DQoJCSAgICAgICAgICAgICAgICB0aGlzLnN0eWxlLnZpc2liaWxpdHkgPSAnaW5oZXJpdCc7DQoJCSAgICAgICAgICAgIH0pOw0KCQkgICAgICAgIH0NCg0KCQkgICAgICAgIG92ZXJsYXkuY3NzKHsNCgkJICAgICAgICAgICAgJ2JhY2tncm91bmQtY29sb3InOiBjdXJyZW50T3B0cy5vdmVybGF5Q29sb3IsDQoJCSAgICAgICAgICAgICdvcGFjaXR5JzogY3VycmVudE9wdHMub3ZlcmxheU9wYWNpdHkNCgkJICAgICAgICB9KS51bmJpbmQoKS5zaG93KCk7DQoJCSAgICB9DQoNCgkJICAgIGZpbmFsX3BvcyA9IGZhbmN5Ym94X2dldF96b29tX3RvKCk7DQoNCgkJICAgIGZhbmN5Ym94X3Byb2Nlc3NfdGl0bGUoKTsNCg0KCQkgICAgaWYgKHdyYXAuaXMoIjp2aXNpYmxlIikpIHsNCgkJICAgICAgICAkKGNsb3NlLmFkZChuYXZfbGVmdCkuYWRkKG5hdl9yaWdodCkpLmhpZGUoKTsNCg0KCQkgICAgICAgIHZhciBwb3MgPSB3cmFwLnBvc2l0aW9uKCksDQoJCQkJCWVxdWFsOw0KDQoJCSAgICAgICAgc3RhcnRfcG9zID0gew0KCQkgICAgICAgICAgICB0b3A6IHBvcy50b3AsDQoJCSAgICAgICAgICAgIGxlZnQ6IHBvcy5sZWZ0LA0KCQkgICAgICAgICAgICB3aWR0aDogd3JhcC53aWR0aCgpLA0KCQkgICAgICAgICAgICBoZWlnaHQ6IHdyYXAuaGVpZ2h0KCkNCgkJICAgICAgICB9Ow0KDQoJCSAgICAgICAgZXF1YWwgPSAoc3RhcnRfcG9zLndpZHRoID09IGZpbmFsX3Bvcy53aWR0aCAmJiBzdGFydF9wb3MuaGVpZ2h0ID09IGZpbmFsX3Bvcy5oZWlnaHQpOw0KDQoJCSAgICAgICAgaW5uZXIuZmFkZU91dChjdXJyZW50T3B0cy5jaGFuZ2VGYWRlLCBmdW5jdGlvbiAoKSB7DQoJCSAgICAgICAgICAgIHZhciBmaW5pc2hfcmVzaXppbmcgPSBmdW5jdGlvbiAoKSB7DQoJCSAgICAgICAgICAgICAgICBpbm5lci5odG1sKHRtcC5jb250ZW50cygpKS5mYWRlSW4oY3VycmVudE9wdHMuY2hhbmdlRmFkZSwgX2ZpbmlzaCk7DQoJCSAgICAgICAgICAgIH07DQoNCgkJICAgICAgICAgICAgJC5ldmVudC50cmlnZ2VyKCdmYW5jeWJveC1jaGFuZ2UnKTsNCg0KCQkgICAgICAgICAgICBpbm5lci5lbXB0eSgpLmNzcygnb3ZlcmZsb3cnLCAnaGlkZGVuJyk7DQoNCgkJICAgICAgICAgICAgaWYgKGVxdWFsKSB7DQoJCSAgICAgICAgICAgICAgICBpbm5lci5jc3Moew0KCQkgICAgICAgICAgICAgICAgICAgIHRvcDogY3VycmVudE9wdHMucGFkZGluZywNCgkJICAgICAgICAgICAgICAgICAgICBsZWZ0OiBjdXJyZW50T3B0cy5wYWRkaW5nLA0KCQkgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBNYXRoLm1heChmaW5hbF9wb3Mud2lkdGggLSAoY3VycmVudE9wdHMucGFkZGluZyAqIDIpLCAxKSwNCgkJICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IE1hdGgubWF4KGZpbmFsX3Bvcy5oZWlnaHQgLSAoY3VycmVudE9wdHMucGFkZGluZyAqIDIpIC0gdGl0bGVoLCAxKQ0KCQkgICAgICAgICAgICAgICAgfSk7DQoNCgkJICAgICAgICAgICAgICAgIGZpbmlzaF9yZXNpemluZygpOw0KDQoJCSAgICAgICAgICAgIH0gZWxzZSB7DQoJCSAgICAgICAgICAgICAgICBpbm5lci5jc3Moew0KCQkgICAgICAgICAgICAgICAgICAgIHRvcDogY3VycmVudE9wdHMucGFkZGluZywNCgkJICAgICAgICAgICAgICAgICAgICBsZWZ0OiBjdXJyZW50T3B0cy5wYWRkaW5nLA0KCQkgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBNYXRoLm1heChzdGFydF9wb3Mud2lkdGggLSAoY3VycmVudE9wdHMucGFkZGluZyAqIDIpLCAxKSwNCgkJICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IE1hdGgubWF4KHN0YXJ0X3Bvcy5oZWlnaHQgLSAoY3VycmVudE9wdHMucGFkZGluZyAqIDIpLCAxKQ0KCQkgICAgICAgICAgICAgICAgfSk7DQoNCgkJICAgICAgICAgICAgICAgIGZ4LnByb3AgPSAwOw0KDQoJCSAgICAgICAgICAgICAgICAkKGZ4KS5hbmltYXRlKHsgcHJvcDogMSB9LCB7DQoJCSAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IGN1cnJlbnRPcHRzLmNoYW5nZVNwZWVkLA0KCQkgICAgICAgICAgICAgICAgICAgIGVhc2luZzogY3VycmVudE9wdHMuZWFzaW5nQ2hhbmdlLA0KCQkgICAgICAgICAgICAgICAgICAgIHN0ZXA6IGZhbmN5Ym94X2RyYXcsDQoJCSAgICAgICAgICAgICAgICAgICAgY29tcGxldGU6IGZpbmlzaF9yZXNpemluZw0KCQkgICAgICAgICAgICAgICAgfSk7DQoJCSAgICAgICAgICAgIH0NCgkJICAgICAgICB9KTsNCg0KCQkgICAgICAgIHJldHVybjsNCgkJICAgIH0NCg0KCQkgICAgd3JhcC5jc3MoJ29wYWNpdHknLCAxKTsNCg0KCQkgICAgaWYgKGN1cnJlbnRPcHRzLnRyYW5zaXRpb25JbiA9PSAnZWxhc3RpYycpIHsNCgkJICAgICAgICBzdGFydF9wb3MgPSBmYW5jeWJveF9nZXRfem9vbV9mcm9tKCk7DQoNCgkJICAgICAgICBpbm5lci5jc3Moew0KCQkgICAgICAgICAgICB0b3A6IGN1cnJlbnRPcHRzLnBhZGRpbmcsDQoJCSAgICAgICAgICAgIGxlZnQ6IGN1cnJlbnRPcHRzLnBhZGRpbmcsDQoJCSAgICAgICAgICAgIHdpZHRoOiBNYXRoLm1heChzdGFydF9wb3Mud2lkdGggLSAoY3VycmVudE9wdHMucGFkZGluZyAqIDIpLCAxKSwNCgkJICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLm1heChzdGFydF9wb3MuaGVpZ2h0IC0gKGN1cnJlbnRPcHRzLnBhZGRpbmcgKiAyKSwgMSkNCgkJICAgICAgICB9KQ0KCQkJCQkuaHRtbCh0bXAuY29udGVudHMoKSk7DQoNCgkJICAgICAgICB3cmFwLmNzcyhzdGFydF9wb3MpLnNob3coKTsNCg0KCQkgICAgICAgIGlmIChjdXJyZW50T3B0cy5vcGFjaXR5KSB7DQoJCSAgICAgICAgICAgIGZpbmFsX3Bvcy5vcGFjaXR5ID0gMDsNCgkJICAgICAgICB9DQoNCgkJICAgICAgICBmeC5wcm9wID0gMDsNCg0KCQkgICAgICAgICQoZngpLmFuaW1hdGUoeyBwcm9wOiAxIH0sIHsNCgkJICAgICAgICAgICAgZHVyYXRpb246IGN1cnJlbnRPcHRzLnNwZWVkSW4sDQoJCSAgICAgICAgICAgIGVhc2luZzogY3VycmVudE9wdHMuZWFzaW5nSW4sDQoJCSAgICAgICAgICAgIHN0ZXA6IGZhbmN5Ym94X2RyYXcsDQoJCSAgICAgICAgICAgIGNvbXBsZXRlOiBfZmluaXNoDQoJCSAgICAgICAgfSk7DQoNCgkJICAgIH0gZWxzZSB7DQoJCSAgICAgICAgaW5uZXIuY3NzKHsNCgkJICAgICAgICAgICAgdG9wOiBjdXJyZW50T3B0cy5wYWRkaW5nLA0KCQkgICAgICAgICAgICBsZWZ0OiBjdXJyZW50T3B0cy5wYWRkaW5nLA0KCQkgICAgICAgICAgICB3aWR0aDogTWF0aC5tYXgoZmluYWxfcG9zLndpZHRoIC0gKGN1cnJlbnRPcHRzLnBhZGRpbmcgKiAyKSwgMSksDQoJCSAgICAgICAgICAgIGhlaWdodDogTWF0aC5tYXgoZmluYWxfcG9zLmhlaWdodCAtIChjdXJyZW50T3B0cy5wYWRkaW5nICogMikgLSB0aXRsZWgsIDEpDQoJCSAgICAgICAgfSkNCgkJCQkJLmh0bWwodG1wLmNvbnRlbnRzKCkpOw0KDQoJCSAgICAgICAgd3JhcC5jc3MoZmluYWxfcG9zKS5mYWRlSW4oY3VycmVudE9wdHMudHJhbnNpdGlvbkluID09ICdub25lJyA/IDAgOiBjdXJyZW50T3B0cy5zcGVlZEluLCBfZmluaXNoKTsNCgkJICAgIH0NCgkJfSwNCg0KCQlmYW5jeWJveF9wcm9jZXNzX2lubGluZSA9IGZ1bmN0aW9uICgpIHsNCgkJICAgIHRtcC53aWR0aChzZWxlY3RlZE9wdHMud2lkdGgpOw0KCQkgICAgdG1wLmhlaWdodChzZWxlY3RlZE9wdHMuaGVpZ2h0KTsNCg0KCQkgICAgaWYgKHNlbGVjdGVkT3B0cy53aWR0aCA9PSAnYXV0bycpIHsNCgkJICAgICAgICBzZWxlY3RlZE9wdHMud2lkdGggPSB0bXAud2lkdGgoKTsNCgkJICAgIH0NCgkJICAgIGlmIChzZWxlY3RlZE9wdHMuaGVpZ2h0ID09ICdhdXRvJykgew0KCQkgICAgICAgIHNlbGVjdGVkT3B0cy5oZWlnaHQgPSB0bXAuaGVpZ2h0KCk7DQoJCSAgICB9DQoNCgkJICAgIGZhbmN5Ym94X3Nob3coKTsNCgkJfSwNCg0KCQlmYW5jeWJveF9wcm9jZXNzX2ltYWdlID0gZnVuY3Rpb24gKCkgew0KCQkgICAgYnVzeSA9IHRydWU7DQoJCSAgICANCgkJICAgIHNlbGVjdGVkT3B0cy53aWR0aCA9IGltZ1ByZWxvYWRlci53aWR0aDsNCgkJICAgIHNlbGVjdGVkT3B0cy5oZWlnaHQgPSBpbWdQcmVsb2FkZXIuaGVpZ2h0Ow0KCQkgICAgaWYgKGltZ1ByZWxvYWRlci53aWR0aCA+IDAgJiYgaW1nUHJlbG9hZGVyLmhlaWdodCA+IDApIHsNCgkJICAgICAgICAkKCI8aW1nIC8+IikuYXR0cih7DQoJCSAgICAgICAgICAgICdpZCc6ICdmYW5jeWJveC1pbWcnLA0KCQkgICAgICAgICAgICAnc3JjJzogaW1nUHJlbG9hZGVyLnNyYywNCgkJICAgICAgICAgICAgJ3dpZHRoJzogaW1nUHJlbG9hZGVyLndpZHRoLA0KCQkgICAgICAgICAgICAnaGVpZ2h0JzogaW1nUHJlbG9hZGVyLmhlaWdodA0KCQkgICAgICAgIH0pLmFwcGVuZFRvKHRtcCk7DQoNCgkJICAgIH0gZWxzZSB7DQoJCSAgICAgICAgJCgiPGltZyAvPiIpLmF0dHIoew0KCQkgICAgICAgICAgICAnaWQnOiAnZmFuY3lib3gtaW1nJywNCgkJICAgICAgICAgICAgJ3NyYyc6IGltZ1ByZWxvYWRlci5zcmMsCQkgICAgICAgICAgIA0KCQkgICAgICAgICAgICAnc3R5bGUnOiAnd2lkdGg6YXV0bztoZWlnaHQ6YXV0bzttYXgtd2lkdGg6NzAwcHg7bWF4LWhlaWdodDo1MDBweCcNCg0KCQkgICAgICAgIH0pLmFwcGVuZFRvKHRtcCk7DQoJCSAgICB9DQoNCgkJICAgIGZhbmN5Ym94X3Nob3coKTsNCgkJfSwNCg0KCQlmYW5jeWJveF9zdGFydCA9IGZ1bmN0aW9uICgpIHsNCgkJICAgIGZhbmN5Ym94X2Fib3J0KCk7DQoNCgkJICAgIHZhciBvYmogPSBzZWxlY3RlZEFycmF5W3NlbGVjdGVkSW5kZXhdLA0KCQkJCWhyZWYsDQoJCQkJdHlwZSwNCgkJCQl0aXRsZSwNCgkJCQlzdHIsDQoJCQkJZW1iLA0KCQkJCXNlbGVjdG9yLA0KCQkJCWRhdGE7DQoNCgkJICAgIHNlbGVjdGVkT3B0cyA9ICQuZXh0ZW5kKHt9LCAkLmZuLmZhbmN5Ym94LmRlZmF1bHRzLCAodHlwZW9mICQob2JqKS5kYXRhKCdmYW5jeWJveCcpID09ICd1bmRlZmluZWQnID8gc2VsZWN0ZWRPcHRzIDogJChvYmopLmRhdGEoJ2ZhbmN5Ym94JykpKTsNCgkJICAgIHRpdGxlID0gb2JqLnRpdGxlIHx8ICQob2JqKS50aXRsZSB8fCBzZWxlY3RlZE9wdHMudGl0bGUgfHwgJyc7DQoNCgkJICAgIGlmIChvYmoubm9kZU5hbWUgJiYgIXNlbGVjdGVkT3B0cy5vcmlnKSB7DQoJCSAgICAgICAgc2VsZWN0ZWRPcHRzLm9yaWcgPSAkKG9iaikuY2hpbGRyZW4oImltZzpmaXJzdCIpLmxlbmd0aCA/ICQob2JqKS5jaGlsZHJlbigiaW1nOmZpcnN0IikgOiAkKG9iaik7DQoJCSAgICB9DQoNCgkJICAgIGlmICh0aXRsZSA9PT0gJycgJiYgc2VsZWN0ZWRPcHRzLm9yaWcpIHsNCgkJICAgICAgICB0aXRsZSA9IHNlbGVjdGVkT3B0cy5vcmlnLmF0dHIoJ2FsdCcpOw0KCQkgICAgfQ0KDQoJCSAgICBpZiAob2JqLm5vZGVOYW1lICYmICgvXig/OmphdmFzY3JpcHR8IykvaSkudGVzdChvYmouaHJlZikpIHsNCgkJICAgICAgICBocmVmID0gc2VsZWN0ZWRPcHRzLmhyZWYgfHwgbnVsbDsNCgkJICAgIH0gZWxzZSB7DQoJCSAgICAgICAgaHJlZiA9IHNlbGVjdGVkT3B0cy5ocmVmIHx8IG9iai5ocmVmIHx8IG51bGw7DQoJCSAgICB9DQoNCgkJICAgIGlmIChzZWxlY3RlZE9wdHMudHlwZSkgew0KCQkgICAgICAgIHR5cGUgPSBzZWxlY3RlZE9wdHMudHlwZTsNCg0KCQkgICAgICAgIGlmICghaHJlZikgew0KCQkgICAgICAgICAgICBocmVmID0gc2VsZWN0ZWRPcHRzLmNvbnRlbnQ7DQoJCSAgICAgICAgfQ0KDQoJCSAgICB9IGVsc2UgaWYgKHNlbGVjdGVkT3B0cy5jb250ZW50KSB7DQoJCSAgICAgICAgdHlwZSA9ICdodG1sJzsNCg0KCQkgICAgfSBlbHNlIGlmIChocmVmKSB7DQoJCSAgICAgICAgaWYgKGhyZWYubWF0Y2goaW1nUmVnRXhwKSkgew0KCQkgICAgICAgICAgICB0eXBlID0gJ2ltYWdlJzsNCg0KCQkgICAgICAgIH0gZWxzZSBpZiAoaHJlZi5tYXRjaChzd2ZSZWdFeHApKSB7DQoJCSAgICAgICAgICAgIHR5cGUgPSAnc3dmJzsNCg0KCQkgICAgICAgIH0gZWxzZSBpZiAoJChvYmopLmhhc0NsYXNzKCJpZnJhbWUiKSkgew0KCQkgICAgICAgICAgICB0eXBlID0gJ2lmcmFtZSc7DQoNCgkJICAgICAgICB9IGVsc2UgaWYgKGhyZWYubWF0Y2goLyMvKSkgew0KCQkgICAgICAgICAgICBvYmogPSBocmVmLnN1YnN0cihocmVmLmluZGV4T2YoIiMiKSk7DQoNCgkJICAgICAgICAgICAgdHlwZSA9ICQob2JqKS5sZW5ndGggPiAwID8gJ2lubGluZScgOiAnYWpheCc7DQoJCSAgICAgICAgfSBlbHNlIHsNCgkJICAgICAgICAgICAgdHlwZSA9ICdhamF4JzsNCgkJICAgICAgICB9DQoJCSAgICB9IGVsc2Ugew0KCQkgICAgICAgIHR5cGUgPSAnaW5saW5lJzsNCgkJICAgIH0NCg0KCQkgICAgc2VsZWN0ZWRPcHRzLnR5cGUgPSB0eXBlOw0KCQkgICAgc2VsZWN0ZWRPcHRzLmhyZWYgPSBocmVmOw0KCQkgICAgc2VsZWN0ZWRPcHRzLnRpdGxlID0gdGl0bGU7DQoNCgkJICAgIGlmIChzZWxlY3RlZE9wdHMuYXV0b0RpbWVuc2lvbnMgJiYgc2VsZWN0ZWRPcHRzLnR5cGUgIT09ICdpZnJhbWUnICYmIHNlbGVjdGVkT3B0cy50eXBlICE9PSAnc3dmJykgew0KCQkgICAgICAgIHNlbGVjdGVkT3B0cy53aWR0aCA9ICdhdXRvJzsNCgkJICAgICAgICBzZWxlY3RlZE9wdHMuaGVpZ2h0ID0gJ2F1dG8nOw0KDQoJCSAgICB9DQoNCgkJICAgIGlmIChzZWxlY3RlZE9wdHMubW9kYWwpIHsNCgkJICAgICAgICBzZWxlY3RlZE9wdHMub3ZlcmxheVNob3cgPSB0cnVlOw0KCQkgICAgICAgIHNlbGVjdGVkT3B0cy5oaWRlT25PdmVybGF5Q2xpY2sgPSBmYWxzZTsNCgkJICAgICAgICBzZWxlY3RlZE9wdHMuaGlkZU9uQ29udGVudENsaWNrID0gZmFsc2U7DQoJCSAgICAgICAgc2VsZWN0ZWRPcHRzLmVuYWJsZUVzY2FwZUJ1dHRvbiA9IGZhbHNlOw0KCQkgICAgICAgIHNlbGVjdGVkT3B0cy5zaG93Q2xvc2VCdXR0b24gPSBmYWxzZTsNCgkJICAgIH0NCg0KCQkgICAgaWYgKCQuaXNGdW5jdGlvbihzZWxlY3RlZE9wdHMub25TdGFydCkpIHsNCgkJICAgICAgICBpZiAoc2VsZWN0ZWRPcHRzLm9uU3RhcnQoc2VsZWN0ZWRBcnJheSwgc2VsZWN0ZWRJbmRleCwgc2VsZWN0ZWRPcHRzKSA9PT0gZmFsc2UpIHsNCgkJICAgICAgICAgICAgYnVzeSA9IGZhbHNlOw0KCQkgICAgICAgICAgICByZXR1cm47DQoJCSAgICAgICAgfQ0KCQkgICAgfQ0KDQoJCSAgICAvLyAgdG1wLmNzcygncGFkZGluZycsIChzaGFkb3cgKyBzZWxlY3RlZE9wdHMucGFkZGluZyArIHNlbGVjdGVkT3B0cy5tYXJnaW4pKTsNCgkJICAgIHRtcC5jc3MoJ3BhZGRpbmcnLCAoc2hhZG93ICsgc2VsZWN0ZWRPcHRzLnBhZGRpbmcpKTsNCgkJICAgICQoJy5mYW5jeWJveC1pbmxpbmUtdG1wJykudW5iaW5kKCdmYW5jeWJveC1jYW5jZWwnKS5iaW5kKCdmYW5jeWJveC1jaGFuZ2UnLCBmdW5jdGlvbiAoKSB7DQoJCSAgICAgICAgJCh0aGlzKS5yZXBsYWNlV2l0aChpbm5lci5jaGlsZHJlbigpKTsNCgkJICAgIH0pOw0KDQoJCSAgICBzd2l0Y2ggKHR5cGUpIHsNCgkJICAgICAgICBjYXNlICdodG1sJzoNCgkJICAgICAgICAgICAgdG1wLmh0bWwoc2VsZWN0ZWRPcHRzLmNvbnRlbnQpOw0KCQkgICAgICAgICAgICBmYW5jeWJveF9wcm9jZXNzX2lubGluZSgpOw0KCQkgICAgICAgICAgICBicmVhazsNCg0KCQkgICAgICAgIGNhc2UgJ2lubGluZSc6DQoJCSAgICAgICAgICAgICQoJzxkaXYgY2xhc3M9ImZhbmN5Ym94LWlubGluZS10bXAiIC8+JykuaGlkZSgpLmluc2VydEJlZm9yZSgkKG9iaikpLmJpbmQoJ2ZhbmN5Ym94LWNsZWFudXAnLCBmdW5jdGlvbiAoKSB7DQoJCSAgICAgICAgICAgICAgICAkKHRoaXMpLnJlcGxhY2VXaXRoKGlubmVyLmNoaWxkcmVuKCkpOw0KCQkgICAgICAgICAgICB9KS5iaW5kKCdmYW5jeWJveC1jYW5jZWwnLCBmdW5jdGlvbiAoKSB7DQoJCSAgICAgICAgICAgICAgICAkKHRoaXMpLnJlcGxhY2VXaXRoKHRtcC5jaGlsZHJlbigpKTsNCgkJICAgICAgICAgICAgfSk7DQoNCgkJICAgICAgICAgICAgJChvYmopLmFwcGVuZFRvKHRtcCk7DQoNCgkJICAgICAgICAgICAgZmFuY3lib3hfcHJvY2Vzc19pbmxpbmUoKTsNCgkJICAgICAgICAgICAgYnJlYWs7DQoNCgkJICAgICAgICBjYXNlICdpbWFnZSc6DQoNCgkJICAgICAgICAgICAgYnVzeSA9IGZhbHNlOw0KDQoJCSAgICAgICAgICAgICQuZmFuY3lib3guc2hvd0FjdGl2aXR5KCk7DQoNCgkJICAgICAgICAgICAgaW1nUHJlbG9hZGVyID0gbmV3IEltYWdlKCk7DQoJCSAgICAgICAgICAgIGltZ1ByZWxvYWRlci53aWR0aCA9ICdhdXRvJzsNCgkJICAgICAgICAgICAgaW1nUHJlbG9hZGVyLmhlaWdodCA9ICdhdXRvJzsNCgkJICAgICAgICAgICAgaW1nUHJlbG9hZGVyLm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7DQoJCSAgICAgICAgICAgICAgICBmYW5jeWJveF9lcnJvcigpOw0KCQkgICAgICAgICAgICB9Ow0KDQoJCSAgICAgICAgICAgIGltZ1ByZWxvYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CQkgICAgICAgICAgICAgIA0KCQkgICAgICAgICAgICAgICAgdmFyIHBXaWR0aCA9IDcwMDsNCgkJICAgICAgICAgICAgICAgIHZhciBwSGVpZ2h0ID0gNTAwOw0KCQkgICAgICAgICAgICAgICAgaWYgKGltZ1ByZWxvYWRlci53aWR0aCA+IDAgJiYgaW1nUHJlbG9hZGVyLmhlaWdodCA+IDApIHsNCgkJICAgICAgICAgICAgICAgICAgICBpZiAoaW1nUHJlbG9hZGVyLndpZHRoIC8gaW1nUHJlbG9hZGVyLmhlaWdodCA+PSBwV2lkdGggLyBwSGVpZ2h0KSB7DQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbWdQcmVsb2FkZXIud2lkdGggPiBwV2lkdGgpIHsNCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltZ1ByZWxvYWRlci5oZWlnaHQgPSAoaW1nUHJlbG9hZGVyLmhlaWdodCAqIHBXaWR0aCkgLyBpbWdQcmVsb2FkZXIud2lkdGg7DQoJCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWdQcmVsb2FkZXIud2lkdGggPSBwV2lkdGg7DQoJCSAgICAgICAgICAgICAgICAgICAgICAgIH0NCgkJICAgICAgICAgICAgICAgICAgICB9DQoJCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbWdQcmVsb2FkZXIuaGVpZ2h0ID4gcEhlaWdodCkgew0KCQkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1nUHJlbG9hZGVyLndpZHRoID0gKGltZ1ByZWxvYWRlci53aWR0aCAqIHBIZWlnaHQpIC8gaW1nUHJlbG9hZGVyLmhlaWdodDsNCgkJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltZ1ByZWxvYWRlci5oZWlnaHQgPSBwSGVpZ2h0Ow0KCQkgICAgICAgICAgICAgICAgICAgICAgICB9DQoJCSAgICAgICAgICAgICAgICAgICAgfQ0KCQkgICAgICAgICAgICAgICAgfQ0KCQkgICAgICAgICAgICAgICAgaW1nUHJlbG9hZGVyLm9uZXJyb3IgPSBudWxsOw0KCQkgICAgICAgICAgICAgICAgaW1nUHJlbG9hZGVyLm9ubG9hZCA9IG51bGw7DQoJCSAgICAgICAgICAgICAgICBmYW5jeWJveF9wcm9jZXNzX2ltYWdlKCk7DQoJCSAgICAgICAgICAgIH07DQoJCSAgICAgICAgICAgIGltZ1ByZWxvYWRlci53aWR0aCA9ICdhdXRvJzsNCgkJICAgICAgICAgICAgaW1nUHJlbG9hZGVyLmhlaWdodCA9ICdhdXRvJzsNCgkJICAgICAgICAgICAgaW1nUHJlbG9hZGVyLnNyYyA9IGhyZWY7CSAgICAgICAgICAgDQoNCgkJICAgICAgICAgICAgYnJlYWs7DQoNCgkJICAgICAgICBjYXNlICdzd2YnOg0KCQkgICAgICAgICAgICBzdHIgPSAnPG9iamVjdCBjbGFzc2lkPSJjbHNpZDpEMjdDREI2RS1BRTZELTExY2YtOTZCOC00NDQ1NTM1NDAwMDAiIHdpZHRoPSInICsgc2VsZWN0ZWRPcHRzLndpZHRoICsgJyIgaGVpZ2h0PSInICsgc2VsZWN0ZWRPcHRzLmhlaWdodCArICciPjxwYXJhbSBuYW1lPSJtb3ZpZSIgdmFsdWU9IicgKyBocmVmICsgJyI+PC9wYXJhbT4nOw0KCQkgICAgICAgICAgICBlbWIgPSAnJzsNCg0KCQkgICAgICAgICAgICAkLmVhY2goc2VsZWN0ZWRPcHRzLnN3ZiwgZnVuY3Rpb24gKG5hbWUsIHZhbCkgew0KCQkgICAgICAgICAgICAgICAgc3RyICs9ICc8cGFyYW0gbmFtZT0iJyArIG5hbWUgKyAnIiB2YWx1ZT0iJyArIHZhbCArICciPjwvcGFyYW0+JzsNCgkJICAgICAgICAgICAgICAgIGVtYiArPSAnICcgKyBuYW1lICsgJz0iJyArIHZhbCArICciJzsNCgkJICAgICAgICAgICAgfSk7DQoNCgkJICAgICAgICAgICAgc3RyICs9ICc8ZW1iZWQgc3JjPSInICsgaHJlZiArICciIHR5cGU9ImFwcGxpY2F0aW9uL3gtc2hvY2t3YXZlLWZsYXNoIiB3aWR0aD0iJyArIHNlbGVjdGVkT3B0cy53aWR0aCArICciIGhlaWdodD0iJyArIHNlbGVjdGVkT3B0cy5oZWlnaHQgKyAnIicgKyBlbWIgKyAnPjwvZW1iZWQ+PC9vYmplY3Q+JzsNCg0KCQkgICAgICAgICAgICB0bXAuaHRtbChzdHIpOw0KDQoJCSAgICAgICAgICAgIGZhbmN5Ym94X3Byb2Nlc3NfaW5saW5lKCk7DQoJCSAgICAgICAgICAgIGJyZWFrOw0KDQoJCSAgICAgICAgY2FzZSAnYWpheCc6DQoJCSAgICAgICAgICAgIHNlbGVjdG9yID0gaHJlZi5zcGxpdCgnIycsIDIpOw0KCQkgICAgICAgICAgICBkYXRhID0gc2VsZWN0ZWRPcHRzLmFqYXguZGF0YSB8fCB7fTsNCg0KCQkgICAgICAgICAgICBpZiAoc2VsZWN0b3IubGVuZ3RoID4gMSkgew0KCQkgICAgICAgICAgICAgICAgaHJlZiA9IHNlbGVjdG9yWzBdOw0KDQoJCSAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGEgPT0gInN0cmluZyIpIHsNCgkJICAgICAgICAgICAgICAgICAgICBkYXRhICs9ICcmc2VsZWN0b3I9JyArIHNlbGVjdG9yWzFdOw0KCQkgICAgICAgICAgICAgICAgfSBlbHNlIHsNCgkJICAgICAgICAgICAgICAgICAgICBkYXRhLnNlbGVjdG9yID0gc2VsZWN0b3JbMV07DQoJCSAgICAgICAgICAgICAgICB9DQoJCSAgICAgICAgICAgIH0NCg0KCQkgICAgICAgICAgICBidXN5ID0gZmFsc2U7DQoJCSAgICAgICAgICAgICQuZmFuY3lib3guc2hvd0FjdGl2aXR5KCk7DQoNCgkJICAgICAgICAgICAgYWpheExvYWRlciA9ICQuYWpheCgkLmV4dGVuZChzZWxlY3RlZE9wdHMuYWpheCwgew0KCQkgICAgICAgICAgICAgICAgdXJsOiBocmVmLA0KCQkgICAgICAgICAgICAgICAgZGF0YTogZGF0YSwNCgkJICAgICAgICAgICAgICAgIGVycm9yOiBmYW5jeWJveF9lcnJvciwNCgkJICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhLCB0ZXh0U3RhdHVzLCBYTUxIdHRwUmVxdWVzdCkgew0KCQkgICAgICAgICAgICAgICAgICAgIGlmIChhamF4TG9hZGVyLnN0YXR1cyA9PSAyMDApIHsNCgkJICAgICAgICAgICAgICAgICAgICAgICAgdG1wLmh0bWwoZGF0YSk7DQoJCSAgICAgICAgICAgICAgICAgICAgICAgIGZhbmN5Ym94X3Byb2Nlc3NfaW5saW5lKCk7DQoJCSAgICAgICAgICAgICAgICAgICAgfQ0KCQkgICAgICAgICAgICAgICAgfQ0KCQkgICAgICAgICAgICB9KSk7DQoNCgkJICAgICAgICAgICAgYnJlYWs7DQoNCgkJICAgICAgICBjYXNlICdpZnJhbWUnOg0KCQkgICAgICAgICAgICAkKCc8aWZyYW1lIGlkPSJmYW5jeWJveC1mcmFtZSIgbmFtZT0iZmFuY3lib3gtZnJhbWUnICsgbmV3IERhdGUoKS5nZXRUaW1lKCkgKyAnIiBmcmFtZWJvcmRlcj0iMCIgaHNwYWNlPSIwIiBzY3JvbGxpbmc9IicgKyBzZWxlY3RlZE9wdHMuc2Nyb2xsaW5nICsgJyIgc3JjPSInICsgc2VsZWN0ZWRPcHRzLmhyZWYgKyAnIj48L2lmcmFtZT4nKS5hcHBlbmRUbyh0bXApOw0KCQkgICAgICAgICAgICBmYW5jeWJveF9zaG93KCk7DQoJCSAgICAgICAgICAgIGJyZWFrOw0KCQkgICAgfQ0KCQl9LA0KDQoJCWZhbmN5Ym94X2FuaW1hdGVfbG9hZGluZyA9IGZ1bmN0aW9uICgpIHsNCgkJICAgIGlmICghbG9hZGluZy5pcygnOnZpc2libGUnKSkgew0KCQkgICAgICAgIGNsZWFySW50ZXJ2YWwobG9hZGluZ1RpbWVyKTsNCgkJICAgICAgICByZXR1cm47DQoJCSAgICB9DQoNCgkJICAgICQoJ2RpdicsIGxvYWRpbmcpLmNzcygndG9wJywgKGxvYWRpbmdGcmFtZSAqIC00MCkgKyAncHgnKTsNCg0KCQkgICAgbG9hZGluZ0ZyYW1lID0gKGxvYWRpbmdGcmFtZSArIDEpICUgMTI7DQoJCX0sDQoNCgkJZmFuY3lib3hfaW5pdCA9IGZ1bmN0aW9uICgpIHsNCgkJICAgIGlmICgkKCIjZmFuY3lib3gtd3JhcCIpLmxlbmd0aCkgew0KCQkgICAgICAgIHJldHVybjsNCgkJICAgIH0NCg0KCQkgICAgJCgnYm9keScpLmFwcGVuZCgNCgkJCQl0bXAgPSAkKCc8ZGl2IGlkPSJmYW5jeWJveC10bXAiPjwvZGl2PicpLA0KCQkJCWxvYWRpbmcgPSAkKCc8ZGl2IGlkPSJmYW5jeWJveC1sb2FkaW5nIj48ZGl2PjwvZGl2PjwvZGl2PicpLA0KCQkJCW92ZXJsYXkgPSAkKCc8ZGl2IGlkPSJmYW5jeWJveC1vdmVybGF5Ij48L2Rpdj4nKSwNCgkJCQl3cmFwID0gJCgnPGRpdiBpZD0iZmFuY3lib3gtd3JhcCI+PC9kaXY+JykNCgkJCSk7DQoNCgkJICAgIGlmICghJC5zdXBwb3J0Lm9wYWNpdHkpIHsNCgkJICAgICAgICB3cmFwLmFkZENsYXNzKCdmYW5jeWJveC1pZScpOw0KCQkgICAgICAgIGxvYWRpbmcuYWRkQ2xhc3MoJ2ZhbmN5Ym94LWllJyk7DQoJCSAgICB9DQoNCgkJICAgIG91dGVyID0gJCgnPGRpdiBpZD0iZmFuY3lib3gtb3V0ZXIiPjwvZGl2PicpDQoJCQkJLmFwcGVuZCgnPGRpdiBjbGFzcz0iZmFuY3ktYmciIGlkPSJmYW5jeS1iZy1uIj48L2Rpdj48ZGl2IGNsYXNzPSJmYW5jeS1iZyIgaWQ9ImZhbmN5LWJnLW5lIj48L2Rpdj48ZGl2IGNsYXNzPSJmYW5jeS1iZyIgaWQ9ImZhbmN5LWJnLWUiPjwvZGl2PjxkaXYgY2xhc3M9ImZhbmN5LWJnIiBpZD0iZmFuY3ktYmctc2UiPjwvZGl2PjxkaXYgY2xhc3M9ImZhbmN5LWJnIiBpZD0iZmFuY3ktYmctcyI+PC9kaXY+PGRpdiBjbGFzcz0iZmFuY3ktYmciIGlkPSJmYW5jeS1iZy1zdyI+PC9kaXY+PGRpdiBjbGFzcz0iZmFuY3ktYmciIGlkPSJmYW5jeS1iZy13Ij48L2Rpdj48ZGl2IGNsYXNzPSJmYW5jeS1iZyIgaWQ9ImZhbmN5LWJnLW53Ij48L2Rpdj4nKQ0KCQkJCS5hcHBlbmRUbyh3cmFwKTsNCg0KCQkgICAgb3V0ZXIuYXBwZW5kKA0KCQkJCWlubmVyID0gJCgnPGRpdiBpZD0iZmFuY3lib3gtaW5uZXIiPjwvZGl2PicpLA0KCQkJCWNsb3NlID0gJCgnPGEgaWQ9ImZhbmN5Ym94LWNsb3NlIj48L2E+JyksDQoNCgkJCQluYXZfbGVmdCA9ICQoJzxhIGhyZWY9ImphdmFzY3JpcHQ6OyIgaWQ9ImZhbmN5Ym94LWxlZnQiPjxzcGFuIGNsYXNzPSJmYW5jeS1pY28iIGlkPSJmYW5jeWJveC1sZWZ0LWljbyI+PC9zcGFuPjwvYT4nKSwNCgkJCQluYXZfcmlnaHQgPSAkKCc8YSBocmVmPSJqYXZhc2NyaXB0OjsiIGlkPSJmYW5jeWJveC1yaWdodCI+PHNwYW4gY2xhc3M9ImZhbmN5LWljbyIgaWQ9ImZhbmN5Ym94LXJpZ2h0LWljbyI+PC9zcGFuPjwvYT4nKQ0KCQkJKTsNCg0KCQkgICAgY2xvc2UuY2xpY2soJC5mYW5jeWJveC5jbG9zZSk7DQoJCSAgICBsb2FkaW5nLmNsaWNrKCQuZmFuY3lib3guY2FuY2VsKTsNCg0KCQkgICAgbmF2X2xlZnQuY2xpY2soZnVuY3Rpb24gKGUpIHsNCgkJICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQoJCSAgICAgICAgJC5mYW5jeWJveC5wcmV2KCk7DQoJCSAgICB9KTsNCg0KCQkgICAgbmF2X3JpZ2h0LmNsaWNrKGZ1bmN0aW9uIChlKSB7DQoJCSAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KCQkgICAgICAgICQuZmFuY3lib3gubmV4dCgpOw0KCQkgICAgfSk7DQoNCgkJICAgIGlmIChpc0lFNikgew0KCQkgICAgICAgIG92ZXJsYXkuZ2V0KDApLnN0eWxlLnNldEV4cHJlc3Npb24oJ2hlaWdodCcsICJkb2N1bWVudC5ib2R5LnNjcm9sbEhlaWdodCA+IGRvY3VtZW50LmJvZHkub2Zmc2V0SGVpZ2h0ID8gZG9jdW1lbnQuYm9keS5zY3JvbGxIZWlnaHQgOiBkb2N1bWVudC5ib2R5Lm9mZnNldEhlaWdodCArICdweCciKTsNCgkJICAgICAgICBsb2FkaW5nLmdldCgwKS5zdHlsZS5zZXRFeHByZXNzaW9uKCd0b3AnLCAiKC0yMCArIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0ID8gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodC8yIDogZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQvMiApICsgKCBpZ25vcmVNZSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgPyBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wIDogZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgKSkgKyAncHgnIik7DQoNCgkJICAgICAgICBvdXRlci5wcmVwZW5kKCc8aWZyYW1lIGlkPSJmYW5jeWJveC1oaWRlLXNlbC1mcmFtZSIgc3JjPSJqYXZhc2NyaXB0OlwnXCc7IiBzY3JvbGxpbmc9Im5vIiBmcmFtZWJvcmRlcj0iMCIgPjwvaWZyYW1lPicpOw0KCQkgICAgfQ0KCQl9Ow0KDQogICAgLyoNCiAgICAqIFB1YmxpYyBtZXRob2RzIA0KICAgICovDQoNCiAgICAkLmZuLmZhbmN5Ym94ID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsNCiAgICAgICAgJCh0aGlzKQ0KCQkJLmRhdGEoJ2ZhbmN5Ym94JywgJC5leHRlbmQoe30sIG9wdGlvbnMsICgkLm1ldGFkYXRhID8gJCh0aGlzKS5tZXRhZGF0YSgpIDoge30pKSkNCgkJCS51bmJpbmQoJ2NsaWNrLmZiJykuYmluZCgnY2xpY2suZmInLCBmdW5jdGlvbiAoZSkgew0KCQkJICAgIGUucHJldmVudERlZmF1bHQoKTsNCg0KCQkJICAgIGlmIChidXN5KSB7DQoJCQkgICAgICAgIHJldHVybjsNCgkJCSAgICB9DQoNCgkJCSAgICBidXN5ID0gdHJ1ZTsNCg0KCQkJICAgICQodGhpcykuYmx1cigpOw0KDQoJCQkgICAgc2VsZWN0ZWRBcnJheSA9IFtdOw0KCQkJICAgIHNlbGVjdGVkSW5kZXggPSAwOw0KDQoJCQkgICAgdmFyIHJlbCA9ICQodGhpcykuYXR0cigncmVsJykgfHwgJyc7DQoNCgkJCSAgICBpZiAoIXJlbCB8fCByZWwgPT0gJycgfHwgcmVsID09PSAnbm9mb2xsb3cnKSB7DQoJCQkgICAgICAgIHNlbGVjdGVkQXJyYXkucHVzaCh0aGlzKTsNCg0KCQkJICAgIH0gZWxzZSB7DQoJCQkgICAgICAgIHNlbGVjdGVkQXJyYXkgPSAkKCJhW3JlbD0iICsgcmVsICsgIl0sIGFyZWFbcmVsPSIgKyByZWwgKyAiXSIpOw0KCQkJICAgICAgICBzZWxlY3RlZEluZGV4ID0gc2VsZWN0ZWRBcnJheS5pbmRleCh0aGlzKTsNCgkJCSAgICB9DQoNCgkJCSAgICBmYW5jeWJveF9zdGFydCgpOw0KDQoJCQkgICAgcmV0dXJuIGZhbHNlOw0KCQkJfSk7DQoNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfTsNCg0KICAgICQuZmFuY3lib3ggPSBmdW5jdGlvbiAob2JqKSB7DQogICAgICAgIGlmIChidXN5KSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBidXN5ID0gdHJ1ZTsNCg0KICAgICAgICB2YXIgb3B0cyA9IHR5cGVvZiBhcmd1bWVudHNbMV0gIT09ICd1bmRlZmluZWQnID8gYXJndW1lbnRzWzFdIDoge307DQoNCiAgICAgICAgc2VsZWN0ZWRBcnJheSA9IFtdOw0KICAgICAgICBzZWxlY3RlZEluZGV4ID0gb3B0cy5pbmRleCB8fCAwOw0KDQogICAgICAgIGlmICgkLmlzQXJyYXkob2JqKSkgew0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGogPSBvYmoubGVuZ3RoOyBpIDwgajsgaSsrKSB7DQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvYmpbaV0gPT0gJ29iamVjdCcpIHsNCiAgICAgICAgICAgICAgICAgICAgJChvYmpbaV0pLmRhdGEoJ2ZhbmN5Ym94JywgJC5leHRlbmQoe30sIG9wdHMsIG9ialtpXSkpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIG9ialtpXSA9ICQoe30pLmRhdGEoJ2ZhbmN5Ym94JywgJC5leHRlbmQoeyBjb250ZW50OiBvYmpbaV0gfSwgb3B0cykpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgc2VsZWN0ZWRBcnJheSA9IGpRdWVyeS5tZXJnZShzZWxlY3RlZEFycmF5LCBvYmopOw0KDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpZiAodHlwZW9mIG9iaiA9PSAnb2JqZWN0Jykgew0KICAgICAgICAgICAgICAgICQob2JqKS5kYXRhKCdmYW5jeWJveCcsICQuZXh0ZW5kKHt9LCBvcHRzLCBvYmopKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgb2JqID0gJCh7fSkuZGF0YSgnZmFuY3lib3gnLCAkLmV4dGVuZCh7IGNvbnRlbnQ6IG9iaiB9LCBvcHRzKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHNlbGVjdGVkQXJyYXkucHVzaChvYmopOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHNlbGVjdGVkSW5kZXggPiBzZWxlY3RlZEFycmF5Lmxlbmd0aCB8fCBzZWxlY3RlZEluZGV4IDwgMCkgew0KICAgICAgICAgICAgc2VsZWN0ZWRJbmRleCA9IDA7DQogICAgICAgIH0NCg0KICAgICAgICBmYW5jeWJveF9zdGFydCgpOw0KICAgIH07DQoNCiAgICAkLmZhbmN5Ym94LnNob3dBY3Rpdml0eSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgY2xlYXJJbnRlcnZhbChsb2FkaW5nVGltZXIpOw0KDQogICAgICAgIGxvYWRpbmcuc2hvdygpOw0KICAgICAgICBsb2FkaW5nVGltZXIgPSBzZXRJbnRlcnZhbChmYW5jeWJveF9hbmltYXRlX2xvYWRpbmcsIDY2KTsNCiAgICB9Ow0KDQogICAgJC5mYW5jeWJveC5oaWRlQWN0aXZpdHkgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIGxvYWRpbmcuaGlkZSgpOw0KICAgIH07DQoNCiAgICAkLmZhbmN5Ym94Lm5leHQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiAkLmZhbmN5Ym94LnBvcyhjdXJyZW50SW5kZXggKyAxKTsNCiAgICB9Ow0KDQogICAgJC5mYW5jeWJveC5wcmV2ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gJC5mYW5jeWJveC5wb3MoY3VycmVudEluZGV4IC0gMSk7DQogICAgfTsNCg0KICAgICQuZmFuY3lib3gucG9zID0gZnVuY3Rpb24gKHBvcykgew0KICAgICAgICBpZiAoYnVzeSkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgcG9zID0gcGFyc2VJbnQocG9zLCAxMCk7DQoNCiAgICAgICAgaWYgKHBvcyA+IC0xICYmIGN1cnJlbnRBcnJheS5sZW5ndGggPiBwb3MpIHsNCiAgICAgICAgICAgIHNlbGVjdGVkSW5kZXggPSBwb3M7DQogICAgICAgICAgICBmYW5jeWJveF9zdGFydCgpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGN1cnJlbnRPcHRzLmN5Y2xpYyAmJiBjdXJyZW50QXJyYXkubGVuZ3RoID4gMSAmJiBwb3MgPCAwKSB7DQogICAgICAgICAgICBzZWxlY3RlZEluZGV4ID0gY3VycmVudEFycmF5Lmxlbmd0aCAtIDE7DQogICAgICAgICAgICBmYW5jeWJveF9zdGFydCgpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGN1cnJlbnRPcHRzLmN5Y2xpYyAmJiBjdXJyZW50QXJyYXkubGVuZ3RoID4gMSAmJiBwb3MgPj0gY3VycmVudEFycmF5Lmxlbmd0aCkgew0KICAgICAgICAgICAgc2VsZWN0ZWRJbmRleCA9IDA7DQogICAgICAgICAgICBmYW5jeWJveF9zdGFydCgpOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuOw0KICAgIH07DQoNCiAgICAkLmZhbmN5Ym94LmNhbmNlbCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgaWYgKGJ1c3kpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIGJ1c3kgPSB0cnVlOw0KDQogICAgICAgICQuZXZlbnQudHJpZ2dlcignZmFuY3lib3gtY2FuY2VsJyk7DQoNCiAgICAgICAgZmFuY3lib3hfYWJvcnQoKTsNCg0KICAgICAgICBpZiAoc2VsZWN0ZWRPcHRzICYmICQuaXNGdW5jdGlvbihzZWxlY3RlZE9wdHMub25DYW5jZWwpKSB7DQogICAgICAgICAgICBzZWxlY3RlZE9wdHMub25DYW5jZWwoc2VsZWN0ZWRBcnJheSwgc2VsZWN0ZWRJbmRleCwgc2VsZWN0ZWRPcHRzKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGJ1c3kgPSBmYWxzZTsNCiAgICB9Ow0KDQogICAgLy8gTm90ZTogd2l0aGluIGFuIGlmcmFtZSB1c2UgLSBwYXJlbnQuJC5mYW5jeWJveC5jbG9zZSgpOw0KICAgICQuZmFuY3lib3guY2xvc2UgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIGlmIChidXN5IHx8IHdyYXAuaXMoJzpoaWRkZW4nKSkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgYnVzeSA9IHRydWU7DQoNCiAgICAgICAgaWYgKGN1cnJlbnRPcHRzICYmICQuaXNGdW5jdGlvbihjdXJyZW50T3B0cy5vbkNsZWFudXApKSB7DQogICAgICAgICAgICBpZiAoY3VycmVudE9wdHMub25DbGVhbnVwKGN1cnJlbnRBcnJheSwgY3VycmVudEluZGV4LCBjdXJyZW50T3B0cykgPT09IGZhbHNlKSB7DQogICAgICAgICAgICAgICAgYnVzeSA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGZhbmN5Ym94X2Fib3J0KCk7DQoNCiAgICAgICAgJChjbG9zZS5hZGQobmF2X2xlZnQpLmFkZChuYXZfcmlnaHQpKS5oaWRlKCk7DQoNCiAgICAgICAgJCgnI2ZhbmN5Ym94LXRpdGxlJykucmVtb3ZlKCk7DQoNCiAgICAgICAgd3JhcC5hZGQoaW5uZXIpLmFkZChvdmVybGF5KS51bmJpbmQoKTsNCg0KICAgICAgICAkKHdpbmRvdykudW5iaW5kKCJyZXNpemUuZmIgc2Nyb2xsLmZiIik7DQogICAgICAgICQoZG9jdW1lbnQpLnVuYmluZCgna2V5ZG93bi5mYicpOw0KDQogICAgICAgIGZ1bmN0aW9uIF9jbGVhbnVwKCkgew0KICAgICAgICAgICAgb3ZlcmxheS5mYWRlT3V0KCdmYXN0Jyk7DQoNCiAgICAgICAgICAgIHdyYXAuaGlkZSgpOw0KDQogICAgICAgICAgICAkLmV2ZW50LnRyaWdnZXIoJ2ZhbmN5Ym94LWNsZWFudXAnKTsNCg0KICAgICAgICAgICAgaW5uZXIuZW1wdHkoKTsNCg0KICAgICAgICAgICAgaWYgKCQuaXNGdW5jdGlvbihjdXJyZW50T3B0cy5vbkNsb3NlZCkpIHsNCiAgICAgICAgICAgICAgICBjdXJyZW50T3B0cy5vbkNsb3NlZChjdXJyZW50QXJyYXksIGN1cnJlbnRJbmRleCwgY3VycmVudE9wdHMpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBjdXJyZW50QXJyYXkgPSBzZWxlY3RlZE9wdHMgPSBbXTsNCiAgICAgICAgICAgIGN1cnJlbnRJbmRleCA9IHNlbGVjdGVkSW5kZXggPSAwOw0KICAgICAgICAgICAgY3VycmVudE9wdHMgPSBzZWxlY3RlZE9wdHMgPSB7fTsNCg0KICAgICAgICAgICAgYnVzeSA9IGZhbHNlOw0KICAgICAgICB9DQoNCiAgICAgICAgaW5uZXIuY3NzKCdvdmVyZmxvdycsICdoaWRkZW4nKTsNCg0KICAgICAgICBpZiAoY3VycmVudE9wdHMudHJhbnNpdGlvbk91dCA9PSAnZWxhc3RpYycpIHsNCiAgICAgICAgICAgIHN0YXJ0X3BvcyA9IGZhbmN5Ym94X2dldF96b29tX2Zyb20oKTsNCg0KICAgICAgICAgICAgdmFyIHBvcyA9IHdyYXAucG9zaXRpb24oKTsNCg0KICAgICAgICAgICAgZmluYWxfcG9zID0gew0KICAgICAgICAgICAgICAgIHRvcDogcG9zLnRvcCwNCiAgICAgICAgICAgICAgICBsZWZ0OiBwb3MubGVmdCwNCiAgICAgICAgICAgICAgICB3aWR0aDogd3JhcC53aWR0aCgpLA0KICAgICAgICAgICAgICAgIGhlaWdodDogd3JhcC5oZWlnaHQoKQ0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgaWYgKGN1cnJlbnRPcHRzLm9wYWNpdHkpIHsNCiAgICAgICAgICAgICAgICBmaW5hbF9wb3Mub3BhY2l0eSA9IDE7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGZ4LnByb3AgPSAxOw0KDQogICAgICAgICAgICAkKGZ4KS5hbmltYXRlKHsgcHJvcDogMCB9LCB7DQogICAgICAgICAgICAgICAgZHVyYXRpb246IGN1cnJlbnRPcHRzLnNwZWVkT3V0LA0KICAgICAgICAgICAgICAgIGVhc2luZzogY3VycmVudE9wdHMuZWFzaW5nT3V0LA0KICAgICAgICAgICAgICAgIHN0ZXA6IGZhbmN5Ym94X2RyYXcsDQogICAgICAgICAgICAgICAgY29tcGxldGU6IF9jbGVhbnVwDQogICAgICAgICAgICB9KTsNCg0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgd3JhcC5mYWRlT3V0KGN1cnJlbnRPcHRzLnRyYW5zaXRpb25PdXQgPT0gJ25vbmUnID8gMCA6IGN1cnJlbnRPcHRzLnNwZWVkT3V0LCBfY2xlYW51cCk7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgJC5mYW5jeWJveC5yZXNpemUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBjLCBoOw0KDQogICAgICAgIGlmIChidXN5IHx8IHdyYXAuaXMoJzpoaWRkZW4nKSkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgYnVzeSA9IHRydWU7DQoNCiAgICAgICAgYyA9IGlubmVyLndyYXBJbm5lcigiPGRpdiBzdHlsZT0nb3ZlcmZsb3c6YXV0byc+PC9kaXY+IikuY2hpbGRyZW4oKTsNCiAgICAgICAgaCA9IGMuaGVpZ2h0KCk7DQoNCiAgICAgICAgd3JhcC5jc3MoeyBoZWlnaHQ6IGggKyAoY3VycmVudE9wdHMucGFkZGluZyAqIDIpICsgdGl0bGVoIH0pOw0KICAgICAgICBpbm5lci5jc3MoeyBoZWlnaHQ6IGggfSk7DQoNCiAgICAgICAgYy5yZXBsYWNlV2l0aChjLmNoaWxkcmVuKCkpOw0KDQogICAgICAgICQuZmFuY3lib3guY2VudGVyKCk7DQogICAgfTsNCg0KICAgICQuZmFuY3lib3guY2VudGVyID0gZnVuY3Rpb24gKCkgew0KICAgICAgICBidXN5ID0gdHJ1ZTsNCg0KICAgICAgICB2YXIgdmlldyA9IGZhbmN5Ym94X2dldF92aWV3cG9ydCgpLA0KCQkJbWFyZ2luID0gY3VycmVudE9wdHMubWFyZ2luLA0KCQkJdG8gPSB7fTsNCg0KICAgICAgICB0by50b3AgPSB2aWV3WzNdICsgKCh2aWV3WzFdIC0gKCh3cmFwLmhlaWdodCgpIC0gdGl0bGVoKSArIChzaGFkb3cgKiAyKSkpICogMC41KTsNCiAgICAgICAgdG8ubGVmdCA9IHZpZXdbMl0gKyAoKHZpZXdbMF0gLSAod3JhcC53aWR0aCgpICsgKHNoYWRvdyAqIDIpKSkgKiAwLjUpOw0KDQogICAgICAgIHRvLnRvcCA9IE1hdGgubWF4KHZpZXdbM10gKyBtYXJnaW4sIHRvLnRvcCk7DQogICAgICAgIHRvLmxlZnQgPSBNYXRoLm1heCh2aWV3WzJdICsgbWFyZ2luLCB0by5sZWZ0KTsNCg0KICAgICAgICB3cmFwLmNzcyh0byk7DQoNCiAgICAgICAgYnVzeSA9IGZhbHNlOw0KICAgIH07DQoNCiAgICAkLmZuLmZhbmN5Ym94LmRlZmF1bHRzID0gew0KICAgICAgICBwYWRkaW5nOiAxMCwNCiAgICAgICAgbWFyZ2luOiAyMCwNCiAgICAgICAgb3BhY2l0eTogZmFsc2UsDQogICAgICAgIG1vZGFsOiBmYWxzZSwNCiAgICAgICAgY3ljbGljOiBmYWxzZSwNCiAgICAgICAgc2Nyb2xsaW5nOiAnYXV0bycsIC8vICdhdXRvJywgJ3llcycgb3IgJ25vJw0KDQogICAgICAgIHdpZHRoOiA1NjAsDQogICAgICAgIGhlaWdodDogMzQwLA0KDQogICAgICAgIGF1dG9TY2FsZTogdHJ1ZSwNCiAgICAgICAgYXV0b0RpbWVuc2lvbnM6IHRydWUsDQogICAgICAgIGNlbnRlck9uU2Nyb2xsOiBmYWxzZSwNCg0KICAgICAgICBhamF4OiB7fSwNCiAgICAgICAgc3dmOiB7IHdtb2RlOiAndHJhbnNwYXJlbnQnIH0sDQoNCiAgICAgICAgaGlkZU9uT3ZlcmxheUNsaWNrOiB0cnVlLA0KICAgICAgICBoaWRlT25Db250ZW50Q2xpY2s6IGZhbHNlLA0KDQogICAgICAgIG92ZXJsYXlTaG93OiB0cnVlLA0KICAgICAgICBvdmVybGF5T3BhY2l0eTogMC4zLA0KICAgICAgICBvdmVybGF5Q29sb3I6ICcjNjY2JywNCg0KICAgICAgICB0aXRsZVNob3c6IHRydWUsDQogICAgICAgIHRpdGxlUG9zaXRpb246ICdvdXRzaWRlJywgLy8gJ291dHNpZGUnLCAnaW5zaWRlJyBvciAnb3ZlcicNCiAgICAgICAgdGl0bGVGb3JtYXQ6IG51bGwsDQoNCiAgICAgICAgdHJhbnNpdGlvbkluOiAnZmFkZScsIC8vICdlbGFzdGljJywgJ2ZhZGUnIG9yICdub25lJw0KICAgICAgICB0cmFuc2l0aW9uT3V0OiAnZmFkZScsIC8vICdlbGFzdGljJywgJ2ZhZGUnIG9yICdub25lJw0KDQogICAgICAgIHNwZWVkSW46IDMwMCwNCiAgICAgICAgc3BlZWRPdXQ6IDMwMCwNCg0KICAgICAgICBjaGFuZ2VTcGVlZDogMzAwLA0KICAgICAgICBjaGFuZ2VGYWRlOiAnZmFzdCcsDQoNCiAgICAgICAgZWFzaW5nSW46ICdzd2luZycsDQogICAgICAgIGVhc2luZ091dDogJ3N3aW5nJywNCg0KICAgICAgICBzaG93Q2xvc2VCdXR0b246IHRydWUsDQogICAgICAgIHNob3dOYXZBcnJvd3M6IHRydWUsDQogICAgICAgIGVuYWJsZUVzY2FwZUJ1dHRvbjogdHJ1ZSwNCg0KICAgICAgICBvblN0YXJ0OiBudWxsLA0KICAgICAgICBvbkNhbmNlbDogbnVsbCwNCiAgICAgICAgb25Db21wbGV0ZTogbnVsbCwNCiAgICAgICAgb25DbGVhbnVwOiBudWxsLA0KICAgICAgICBvbkNsb3NlZDogbnVsbA0KICAgIH07DQoNCiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7DQogICAgICAgIGZhbmN5Ym94X2luaXQoKTsNCiAgICB9KTsNCg0KfSkoalF1ZXJ5KTs=</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
    </HTTPResponse>
  </HTTPTask>
</HTTPSnapshot>